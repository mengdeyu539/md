<h1>Table of Contents<span class="tocSkip"></span></h1>
<div class="toc"><ul class="toc-item"><li><span><a href="#æ•°ç»„ä¹˜æ³•" data-toc-modified-id="æ•°ç»„ä¹˜æ³•-1"><span class="toc-item-num">1&nbsp;&nbsp;</span>æ•°ç»„ä¹˜æ³•</a></span><ul class="toc-item"><li><span><a href="#ç‚¹ç§¯/å†…ç§¯/æ•°é‡ç§¯/æ ‡é‡ç§¯" data-toc-modified-id="ç‚¹ç§¯/å†…ç§¯/æ•°é‡ç§¯/æ ‡é‡ç§¯-1.1"><span class="toc-item-num">1.1&nbsp;&nbsp;</span>ç‚¹ç§¯/å†…ç§¯/æ•°é‡ç§¯/æ ‡é‡ç§¯</a></span></li><li><span><a href="#å‰ç§¯/å¤–ç§¯/å‘é‡ç§¯" data-toc-modified-id="å‰ç§¯/å¤–ç§¯/å‘é‡ç§¯-1.2"><span class="toc-item-num">1.2&nbsp;&nbsp;</span>å‰ç§¯/å¤–ç§¯/å‘é‡ç§¯</a></span></li><li><span><a href="#å¼ é‡ç§¯/å¤–ç§¯" data-toc-modified-id="å¼ é‡ç§¯/å¤–ç§¯-1.3"><span class="toc-item-num">1.3&nbsp;&nbsp;</span>å¼ é‡ç§¯/å¤–ç§¯</a></span></li><li><span><a href="#çŸ©é˜µä¹˜æ³•" data-toc-modified-id="çŸ©é˜µä¹˜æ³•-1.4"><span class="toc-item-num">1.4&nbsp;&nbsp;</span>çŸ©é˜µä¹˜æ³•</a></span></li><li><span><a href="#å…‹ç½—å†…å…‹ç§¯" data-toc-modified-id="å…‹ç½—å†…å…‹ç§¯-1.5"><span class="toc-item-num">1.5&nbsp;&nbsp;</span>å…‹ç½—å†…å…‹ç§¯</a></span></li><li><span><a href="#å¤šçŸ©é˜µä¹˜æ³•" data-toc-modified-id="å¤šçŸ©é˜µä¹˜æ³•-1.6"><span class="toc-item-num">1.6&nbsp;&nbsp;</span>å¤šçŸ©é˜µä¹˜æ³•</a></span></li></ul></li><li><span><a href="#åŸºç¡€æ¦‚å¿µ" data-toc-modified-id="åŸºç¡€æ¦‚å¿µ-2"><span class="toc-item-num">2&nbsp;&nbsp;</span>åŸºç¡€æ¦‚å¿µ</a></span><ul class="toc-item"><li><span><a href="#èŒƒæ•°" data-toc-modified-id="èŒƒæ•°-2.1"><span class="toc-item-num">2.1&nbsp;&nbsp;</span>èŒƒæ•°</a></span></li><li><span><a href="#è¡Œåˆ—å¼ã€è¿¹" data-toc-modified-id="è¡Œåˆ—å¼ã€è¿¹-2.2"><span class="toc-item-num">2.2&nbsp;&nbsp;</span>è¡Œåˆ—å¼ã€è¿¹</a></span></li><li><span><a href="#ç‰¹å¾å€¼" data-toc-modified-id="ç‰¹å¾å€¼-2.3"><span class="toc-item-num">2.3&nbsp;&nbsp;</span>ç‰¹å¾å€¼</a></span></li></ul></li><li><span><a href="#çŸ©é˜µè¿ç®—" data-toc-modified-id="çŸ©é˜µè¿ç®—-3"><span class="toc-item-num">3&nbsp;&nbsp;</span>çŸ©é˜µè¿ç®—</a></span><ul class="toc-item"><li><span><a href="#çŸ©é˜µæ±‚è§£" data-toc-modified-id="çŸ©é˜µæ±‚è§£-3.1"><span class="toc-item-num">3.1&nbsp;&nbsp;</span>çŸ©é˜µæ±‚è§£</a></span></li><li><span><a href="#é€†çŸ©é˜µ" data-toc-modified-id="é€†çŸ©é˜µ-3.2"><span class="toc-item-num">3.2&nbsp;&nbsp;</span>é€†çŸ©é˜µ</a></span></li><li><span><a href="#çŸ©é˜µåˆ†è§£" data-toc-modified-id="çŸ©é˜µåˆ†è§£-3.3"><span class="toc-item-num">3.3&nbsp;&nbsp;</span>çŸ©é˜µåˆ†è§£</a></span></li></ul></li><li><span><a href="#Einsum" data-toc-modified-id="Einsum-4"><span class="toc-item-num">4&nbsp;&nbsp;</span>Einsum</a></span></li><li><span><a href="#Padding" data-toc-modified-id="Padding-5"><span class="toc-item-num">5&nbsp;&nbsp;</span>Padding</a></span></li><li><span><a href="#å·ç§¯" data-toc-modified-id="å·ç§¯-6"><span class="toc-item-num">6&nbsp;&nbsp;</span>å·ç§¯</a></span></li><li><span><a href="#æ©ç è¿ç®—" data-toc-modified-id="æ©ç è¿ç®—-7"><span class="toc-item-num">7&nbsp;&nbsp;</span>æ©ç è¿ç®—</a></span><ul class="toc-item"><li><span><a href="#ç®€ä»‹" data-toc-modified-id="ç®€ä»‹-7.1"><span class="toc-item-num">7.1&nbsp;&nbsp;</span>ç®€ä»‹</a></span></li><li><span><a href="#åˆ›å»º" data-toc-modified-id="åˆ›å»º-7.2"><span class="toc-item-num">7.2&nbsp;&nbsp;</span>åˆ›å»º</a></span></li><li><span><a href="#è·å–" data-toc-modified-id="è·å–-7.3"><span class="toc-item-num">7.3&nbsp;&nbsp;</span>è·å–</a></span></li><li><span><a href="#ä¿®æ”¹" data-toc-modified-id="ä¿®æ”¹-7.4"><span class="toc-item-num">7.4&nbsp;&nbsp;</span>ä¿®æ”¹</a></span></li><li><span><a href="#ç´¢å¼•åˆ‡ç‰‡" data-toc-modified-id="ç´¢å¼•åˆ‡ç‰‡-7.5"><span class="toc-item-num">7.5&nbsp;&nbsp;</span>ç´¢å¼•åˆ‡ç‰‡</a></span></li><li><span><a href="#ä»£æ•°è¿ç®—" data-toc-modified-id="ä»£æ•°è¿ç®—-7.6"><span class="toc-item-num">7.6&nbsp;&nbsp;</span>ä»£æ•°è¿ç®—</a></span></li><li><span><a href="#ä½¿ç”¨æ¡ˆä¾‹" data-toc-modified-id="ä½¿ç”¨æ¡ˆä¾‹-7.7"><span class="toc-item-num">7.7&nbsp;&nbsp;</span>ä½¿ç”¨æ¡ˆä¾‹</a></span></li></ul></li><li><span><a href="#å°ç»“" data-toc-modified-id="å°ç»“-8"><span class="toc-item-num">8&nbsp;&nbsp;</span>å°ç»“</a></span></li><li><span><a href="#å‚è€ƒ" data-toc-modified-id="å‚è€ƒ-9"><span class="toc-item-num">9&nbsp;&nbsp;</span>å‚è€ƒ</a></span></li></ul></div>


```python
import numpy as np
np.__version__
```




    '1.22.3'



æ–‡æ¡£é˜…è¯»è¯´æ˜ï¼š

- ğŸ§ è¡¨ç¤º Tip
- âš ï¸ è¡¨ç¤ºæ³¨æ„äº‹é¡¹

## æ•°ç»„ä¹˜æ³•

æ³¨æ„ï¼šä¸è¦å¤ªå…³æ³¨å®ƒä»¬å«ä»€ä¹ˆï¼Œçœ‹çœ‹å®ƒä»¬åšäº†ä»€ä¹ˆã€‚

### ç‚¹ç§¯/å†…ç§¯/æ•°é‡ç§¯/æ ‡é‡ç§¯

**ç‚¹ç§¯**

`np.dot`:

- å¦‚æœ a å’Œ b æ˜¯ä¸€ç»´çš„ï¼Œå°±æ˜¯å†…ç§¯ `np.inner`
- å¦‚æœ a å’Œ b æ˜¯äºŒç»´çš„ï¼Œæ˜¯çŸ©é˜µä¹˜æ³• `np.matmul or a @ b`
- å¦‚æœ a æˆ– b ä»»æ„ä¸€ä¸ªæ˜¯å¸¸é‡ `np.multiply or a * b`
- å¦‚æœ a æ˜¯ N ç»´ï¼Œb æ˜¯ä¸€ç»´ `sum product`
- å¦‚æœ a æ˜¯ N ç»´ï¼Œb æ˜¯ M ç»´ `dot(a, b)[i,j,k,m] = sum(a[i,j,:] * b[k,:,m])`

`np.vdot`: å¤šç»´è¾“å…¥ä¼šè¢«flattenåè®¡ç®—ç‚¹ç§¯ã€‚å¦å¤–åœ¨è®¡ç®—å¤æ•°æ—¶ä¸`np.dot`æœ‰æ‰€ä¸åŒã€‚



**å†…ç§¯**

`np.inner`: ä¸€ç»´æ•°ç»„å‘é‡çš„æ™®é€šå†…ç§¯ï¼ˆæ— å¤æ•°å…±è½­ï¼‰ï¼Œåœ¨æ›´é«˜ç»´åº¦ä¸Šï¼Œæ˜¯æœ€åä¸€ä¸ªè½´ä¸Šçš„sum productã€‚

- å¯¹ä¸€ç»´æ•°ç»„ï¼Œå°±æ˜¯å…ƒç´ ä¹˜ç§¯ä¹‹å’Œ `sum(a * b)
- å¦‚æœæœ‰ä¸€ä¸ªæ˜¯æ ‡é‡ï¼Œé‚£å°±æ˜¯ç›´æ¥ç›¸ä¹˜
- å¯¹å¤šç»´æ•°ç»„ï¼Œç­‰äº `np.tensordot(a, b, axes=(-1, -1))`ï¼Œå¯¹äºæŸä¸ªå…·ä½“çš„ç´¢å¼•ï¼Œå°±æ˜¯ç›¸ä¹˜ååœ¨æœ€åä¸€ä¸ªç»´åº¦ä¸Šæ±‚å’Œ `inner(a, b)[i0,...,ir-2,j0,...,js-2] = sum(a[i0,...,ir-2,:]*b[j0,...,js-2,:])`

[æ•°é‡ç§¯ - ç»´åŸºç™¾ç§‘ï¼Œè‡ªç”±çš„ç™¾ç§‘å…¨ä¹¦](https://zh.wikipedia.org/wiki/%E7%82%B9%E7%A7%AF)

aå’Œbéƒ½æ˜¯ä¸€ç»´ï¼š


```python
a = np.array([1, 2, 4])
b = np.array([4, 5, 6])
```


```python
np.dot(a, b), 1*4 + 2*5 + 4*6, np.inner(a, b), sum(a * b)
```




    (38, 38, 38, 38)




```python
np.vdot(a,b)
```




    38



aå’Œbéƒ½æ˜¯äºŒç»´ï¼š


```python
rng = np.random.default_rng(42)
a = rng.integers(0, 10, (3, 4))
b = rng.integers(0, 10, (3, 4))
```


```python
np.inner(a, b)
```




    array([[119,  71,  63],
           [126,  52,  98],
           [112,  86,  96]])




```python
np.tensordot(a, b, axes=(-1, -1))
```




    array([[119,  71,  63],
           [126,  52,  98],
           [112,  86,  96]])




```python
a @ b.T
```




    array([[119,  71,  63],
           [126,  52,  98],
           [112,  86,  96]])




```python
np.matmul(a, b.T)
```




    array([[119,  71,  63],
           [126,  52,  98],
           [112,  86,  96]])




```python
np.vdot(a, b), np.dot(a.flatten(), b.flatten())
```




    (267, 267)



aæˆ–bæ˜¯å¸¸é‡ï¼š


```python
a * 2
```




    array([[ 0, 14, 12,  8],
           [ 8, 16,  0, 12],
           [ 4,  0, 10, 18]])




```python
np.dot(a, 2)
```




    array([[ 0, 14, 12,  8],
           [ 8, 16,  0, 12],
           [ 4,  0, 10, 18]])




```python
np.multiply(a, 2)
```




    array([[ 0, 14, 12,  8],
           [ 8, 16,  0, 12],
           [ 4,  0, 10, 18]])




```python
np.inner(a, 2)
```




    array([[ 0, 14, 12,  8],
           [ 8, 16,  0, 12],
           [ 4,  0, 10, 18]])



aæ˜¯å¤šç»´bæ˜¯ä¸€ç»´ï¼š


```python
rng = np.random.default_rng(42)
a = rng.integers(0, 10, (2, 3, 4))
b = np.array([1, 2, 3, 4])
```


```python
np.dot(a, b)
```




    array([[48, 44, 53],
           [70, 47, 50]])




```python
# æœ€åä¸€ä¸ªç»´åº¦ä¹˜ç§¯å’Œ
np.inner(a, b)
```




    array([[48, 44, 53],
           [70, 47, 50]])




```python
np.tensordot(a, b, axes=(-1, -1))
```




    array([[48, 44, 53],
           [70, 47, 50]])




```python
np.sum(a*b, axis=-1)
```




    array([[48, 44, 53],
           [70, 47, 50]])




```python
a @ b
```




    array([[48, 44, 53],
           [70, 47, 50]])



aæ˜¯mç»´bæ˜¯nç»´ï¼š


```python
rng = np.random.default_rng(42)
a = rng.integers(0, 10, (2, 4, 3))
b = rng.integers(0, 10, (2, 3, 3))
```


```python
# a å’Œ b æœ€åä¸€ä¸ªç»´åº¦å¯ä»¥ä¸ä¸€æ ·ï¼Œä¹Ÿå°±æ˜¯æœ€åä¸€ä¸ªç»´åº¦æ˜¯è‡ªç”±çš„
dab = np.dot(a, b)
dab.shape
```




    (2, 4, 2, 3)




```python
# dot(a, b)[i,j,k,m] = sum(a[i,j,:] * b[k,:,m])
dab[1,2,1,0], sum(a[1,2,:] * b[1,:,0])
```




    (102, 102)




```python
# a å’Œ b æœ€åä¸€ä¸ªç»´åº¦å¿…é¡»ä¸€æ ·
iab = np.inner(a, b)
iab.shape
```




    (2, 4, 2, 3)




```python
# inner(a, b)[i0,...,ir-2,j0,...,js-2] = sum(a[i0,...,ir-2,:]*b[j0,...,js-2,:])
iab[1,2,1,0], sum(a[1,2,:] * b[1,0,:])
```




    (72, 72)




```python
np.alltrue(iab == np.tensordot(a, b, axes=(-1, -1)))
```




    True




```python
np.alltrue(iab == dab), np.any(iab == dab)
```




    (False, False)



### å‰ç§¯/å¤–ç§¯/å‘é‡ç§¯


\begin{aligned}\mathbf {u\times v} &={\begin{vmatrix}u_{2}&u_{3}\\v_{2}&v_{3}\end{vmatrix}}\mathbf {i} -{\begin{vmatrix}u_{1}&u_{3}\\v_{1}&v_{3}\end{vmatrix}}\mathbf {j} +{\begin{vmatrix}u_{1}&u_{2}\\v_{1}&v_{2}\end{vmatrix}}\mathbf {k} \\&=(u_{2}v_{3}-u_{3}v_{2})\mathbf {i} -(u_{1}v_{3}-u_{3}v_{1})\mathbf {j} +(u_{1}v_{2}-u_{2}v_{1})\mathbf {k} \end{aligned}

åªæ”¯æŒäºŒç»´æˆ–ä¸‰ç»´ï¼Œè¡¨ç¤ºä¸uå’Œvéƒ½å‚ç›´çš„å‘é‡ã€‚

[å‰ç§¯ - ç»´åŸºç™¾ç§‘ï¼Œè‡ªç”±çš„ç™¾ç§‘å…¨ä¹¦](https://zh.wikipedia.org/wiki/%E5%8F%89%E7%A7%AF)


```python
# äºŒç»´
a = [1, 1]
b = [-1, 1]
```


```python
# å‘é‡ç§¯åœ¨äºŒç»´ä¸­ä¸èµ·ä½œç”¨ï¼Œå› ä¸ºè¿”å›çš„å‘é‡åœ¨äºŒç»´ä¹‹å¤–
# é•¿åº¦å°±æ˜¯é¢ç§¯ï¼ˆæ ¹å·2Ã—æ ¹å·2ï¼‰
np.cross(a, b)
```




    array(2)




```python
# è¡Œå˜å¤šå¹¶ä¸ç­‰äºç»´åº¦å˜å¤š
rng = np.random.default_rng(42)
a = rng.integers(0, 10, (2, 2))
b = rng.integers(0, 10, (2, 2))
a, b
```




    (array([[0, 7],
            [6, 4]]),
     array([[4, 8],
            [0, 6]]))




```python
np.cross(a, b)
```




    array([-28,  36])




```python
np.cross([0,7], [4,8]), np.cross([6, 4], [0, 6])
```




    (array(-28), array(36))




```python
# ä¸‰ç»´
a = [1, 2, 4]
b = [4, 5, 6]
```


```python
2*6-4*5, -(1*6-4*4), 1*5-2*4
```




    (-8, 10, -3)




```python
# ä¸aå’Œbéƒ½å‚ç›´çš„å‘é‡
np.cross(a, b)
```




    array([-8, 10, -3])



è¿˜æœ‰å‡ ä¸ªå…³äºç»´åº¦çš„ä¸‰å‚æ•°ï¼Œç”¨äºæ”¹å˜æ•°ç»„çš„å®šä¹‰ï¼ˆæœ‰ç‚¹ç±»ä¼¼Cå’ŒF Styleï¼‰ã€‚


```python
# è¡Œå˜å¤šå¹¶ä¸ç­‰äºç»´åº¦å˜å¤š
rng = np.random.default_rng(42)
a = rng.integers(0, 10, (2, 3))
b = rng.integers(0, 10, (2, 3))
a, b
```




    (array([[0, 7, 6],
            [4, 4, 8]]),
     array([[0, 6, 2],
            [0, 5, 9]]))




```python
np.cross(a, b)
```




    array([[-22,   0,   0],
           [ -4, -36,  20]])




```python
np.cross([0,7,6], [0,6,2]), np.cross([4,4,8], [0,5,9])
```




    (array([-22,   0,   0]), array([ -4, -36,  20]))




```python
np.cross(a, b, axisc=0)
```




    array([[-22,  -4],
           [  0, -36],
           [  0,  20]])




```python
a.T,b.T
```




    (array([[0, 4],
            [7, 4],
            [6, 8]]),
     array([[0, 0],
            [6, 5],
            [2, 9]]))




```python
np.cross(a.T, b.T)
```




    array([ 0, 11, 38])




```python
np.cross(a, b, axisa=0, axisb=0)
```




    array([ 0, 11, 38])




```python
np.cross([0,4], [0,0]), np.cross([7,4],[6,5]), np.cross([6,8], [2,9])
```




    (array(0), array(11), array(38))




```python
# è¿™ä¸ªæ˜¯å®é™…è®¡ç®—æ—¶æ²¿ç€çš„ç»´åº¦ï¼Œå’Œä¸Šé¢çš„ä¸ä¸€æ ·
np.cross(a, b, axis=0)
```




    array([ 0, 11, 38])



### å¼ é‡ç§¯/å¤–ç§¯

- [å¼ é‡ç§¯ - ç»´åŸºç™¾ç§‘ï¼Œè‡ªç”±çš„ç™¾ç§‘å…¨ä¹¦](https://zh.wikipedia.org/wiki/%E5%BC%A0%E9%87%8F%E7%A7%AF)
- [å¤–ç§¯ - ç»´åŸºç™¾ç§‘ï¼Œè‡ªç”±çš„ç™¾ç§‘å…¨ä¹¦](https://zh.wikipedia.org/wiki/%E5%A4%96%E7%A7%AF)


```python
a = [1, 2, 4]
b = [4, 5, 6]
```


```python
np.outer(a, b)
```




    array([[ 4,  5,  6],
           [ 8, 10, 12],
           [16, 20, 24]])




```python
rng = np.random.default_rng(42)
a = rng.integers(0, 10, (2, 3, 4))
b = rng.integers(0, 10, (2, 3, 4))
```


```python
np.alltrue(
    np.outer(a,b) == a.ravel().reshape(24, 1) @ b.ravel().reshape(1, 24)
)
```




    True




```python
np.alltrue(np.outer(a, b) == np.tensordot(a.ravel(), b.ravel(), axes=((), ())))
```




    True



### çŸ©é˜µä¹˜æ³•

`np.dot`ä¸Šé¢å·²ç»æè¿‡äº†ï¼Œå…¶å®è¿˜æœ‰ä¸ª`np.matmul`å’Œå®ƒå¾ˆç±»ä¼¼ï¼Œä½†äºŒè€…æ˜¯æœ‰ä¸€äº›åŒºåˆ«çš„ã€‚

- `dot`ä¸æ˜¯é€šå‡½æ•°ï¼Œè€Œ`matmul`æ˜¯é€šå‡½æ•°ï¼Œä¹Ÿå°±æ„å‘³è¿™æœ‰é€šå‡½æ•°çš„ä¸€äº›é€šç”¨å‚æ•°
- `matmul`ä¸æ”¯æŒå‘é‡å’Œæ•°å­—ç›¸ä¹˜
- `matmul`çŸ©é˜µï¼ˆå¥½åƒå…ƒç´ ä¸€æ ·ï¼‰å †å åœ¨ä¸€èµ·å¹¿æ’­

å…³äº`np.matmul`ï¼š

- å¦‚æœéƒ½æ˜¯äºŒç»´ï¼Œå°±æ˜¯å¸¸è§„çš„çŸ©é˜µä¹˜æ³•
- å¦‚æœä»»æ„ä¸ªæ˜¯å¤šç»´ï¼ˆ>2ï¼‰ï¼Œåˆ™æŠŠå®ƒå½“æˆé©»ç•™åœ¨æœ€åä¸¤ä¸ªç´¢å¼•ä¸­çš„çŸ©é˜µå †æ ˆï¼Œå¹¶ç›¸åº”åœ°å¹¿æ’­
- å¦‚æœç¬¬ä¸€ä¸ªæ˜¯ä¸€ç»´ï¼Œåˆ™é€šè¿‡åœ¨å…¶ç»´åº¦å‰é¢åŠ ä¸Š 1 æ¥å°†å…¶æå‡ä¸ºçŸ©é˜µï¼ŒçŸ©é˜µä¹˜æ³•ååˆ é™¤å‰é¢é™„åŠ çš„ 1
- å¦‚æœç¬¬äºŒä¸ªæ˜¯ä¸€ç»´ï¼Œåˆ™åœ¨ç»´åº¦ä¸Šappend 1ï¼ŒçŸ©é˜µä¹˜æ³•åå†åˆ é™¤åé¢é™„åŠ çš„ 1

äºŒç»´çš„æƒ…å†µï¼š


```python
rng = np.random.default_rng(42)
a = rng.integers(0, 10, (2, 3))
b = rng.integers(0, 10, (3, 2))
a, b
```




    (array([[0, 7, 6],
            [4, 4, 8]]),
     array([[0, 6],
            [2, 0],
            [5, 9]]))




```python
np.matmul(a, b)
```




    array([[44, 54],
           [48, 96]])



å…¶ä¸­ä¸€ä¸ªæ˜¯ä¸€ç»´çš„æƒ…å†µï¼š


```python
rng = np.random.default_rng(42)
a = rng.integers(0, 10, (2, 3))
b = rng.integers(0, 10, (3,))
a, b
```




    (array([[0, 7, 6],
            [4, 4, 8]]),
     array([0, 6, 2]))




```python
np.matmul(a, b), (a @ np.stack((b, [1, 1, 1]), axis=1))[:,0]
```




    (array([54, 40]), array([54, 40]))




```python
np.matmul(b, a.T), (np.stack(([1, 1, 1], b), axis=0) @ a.T)[1,:]
```




    (array([54, 40]), array([54, 40]))



ä»»æ„ä¸€ä¸ªæ˜¯å¤šç»´ï¼š


```python
rng = np.random.default_rng(42)
a = rng.integers(0, 10, (2, 3, 4, 5))
b = rng.integers(0, 10, (2, 3, 5, 9))
```


```python
np.matmul(a, b).shape
```




    (2, 3, 4, 9)




```python
(a @ b).shape
```




    (2, 3, 4, 9)




```python
np.dot(a, b).shape
```




    (2, 3, 4, 2, 3, 9)




```python
np.alltrue(np.dot(a, b) == np.matmul(a, b))
```




    True



çœ‹ä¸ªç®€å•ç‚¹çš„ä¾‹å­ï¼š


```python
rng = np.random.default_rng(42)
a = rng.integers(0, 10, (2, 3, 2))
b = rng.integers(0, 10, (2, 2, 2))
```


```python
# 2x3x2
np.matmul(a, b)
```




    array([[[49, 49],
            [70, 70],
            [84, 84]],
    
           [[48, 24],
            [10,  2],
            [97, 41]]])




```python
a[0,:,:] @ b[0,:,:]
```




    array([[49, 49],
           [70, 70],
           [84, 84]])




```python
a[1,:,:] @ b[1,:,:]
```




    array([[48, 24],
           [10,  2],
           [97, 41]])




```python
# 2x3x2
np.matmul(a[0,:,:], b)
```




    array([[[49, 49],
            [70, 70],
            [84, 84]],
    
           [[56, 28],
            [62, 22],
            [84, 36]]])




```python
# 2x3x2
np.matmul(a[1,:,:], b)
```




    array([[[42, 42],
            [14, 14],
            [98, 98]],
    
           [[48, 24],
            [10,  2],
            [97, 41]]])



çœ‹çœ‹dotæ˜¯å’‹æ ·è¡¨ç°çš„ï¼š


```python
# 2x3x2x2
np.dot(a,b)
```




    array([[[[49, 49],
             [56, 28]],
    
            [[70, 70],
             [62, 22]],
    
            [[84, 84],
             [84, 36]]],
    
    
           [[[42, 42],
             [48, 24]],
    
            [[14, 14],
             [10,  2]],
    
            [[98, 98],
             [97, 41]]]])




```python
# 3x2x2
np.dot(a[0,:,:], b[:,:,:])
```




    array([[[49, 49],
            [56, 28]],
    
           [[70, 70],
            [62, 22]],
    
           [[84, 84],
            [84, 36]]])




```python
# 3x2x2
np.dot(a[1,:,:], b[:,:,:])
```




    array([[[42, 42],
            [48, 24]],
    
           [[14, 14],
            [10,  2]],
    
           [[98, 98],
            [97, 41]]])



### å…‹ç½—å†…å…‹ç§¯

>ç»´åŸºç™¾ç§‘ï¼šæ˜¯ä¸¤ä¸ªä»»æ„å¤§å°çš„çŸ©é˜µé—´çš„è¿ç®—ï¼Œè¡¨ç¤ºä¸ºâŠ—ã€‚å…‹ç½—å†…å…‹ç§¯æ˜¯å¤–ç§¯ä»å‘é‡åˆ°çŸ©é˜µçš„æ¨å¹¿ï¼Œä¹Ÿæ˜¯å¼ é‡ç§¯åœ¨æ ‡å‡†åŸºä¸‹çš„çŸ©é˜µè¡¨ç¤ºã€‚

[å…‹ç½—å†…å…‹ç§¯ - ç»´åŸºç™¾ç§‘ï¼Œè‡ªç”±çš„ç™¾ç§‘å…¨ä¹¦](https://zh.m.wikipedia.org/zh-hans/%E5%85%8B%E7%BD%97%E5%86%85%E5%85%8B%E7%A7%AF)

$$
A\otimes B={\begin{bmatrix}a_{{11}}B&\cdots &a_{{1n}}B\\\vdots &\ddots &\vdots \\a_{{m1}}B&\cdots &a_{{mn}}B\end{bmatrix}}.
$$

$$
{\begin{bmatrix}1&2\\3&1\\\end{bmatrix}}\otimes {\begin{bmatrix}0&3\\2&1\\\end{bmatrix}}={\begin{bmatrix}1\cdot 0&1\cdot 3&2\cdot 0&2\cdot 3\\1\cdot 2&1\cdot 1&2\cdot 2&2\cdot 1\\3\cdot 0&3\cdot 3&1\cdot 0&1\cdot 3\\3\cdot 2&3\cdot 1&1\cdot 2&1\cdot 1\\\end{bmatrix}}={\begin{bmatrix}0&3&0&6\\2&1&4&2\\0&9&0&3\\6&3&2&1\end{bmatrix}}.
$$


```python
np.kron([1,2,3], [1, 10, 100])
```




    array([  1,  10, 100,   2,  20, 200,   3,  30, 300])




```python
np.kron([1, 10, 100], [1,2,3])
```




    array([  1,   2,   3,  10,  20,  30, 100, 200, 300])




```python
a = np.array([[1,2],[3,1]])
b = np.array([[0,3],[2,1]])
```


```python
np.kron(a,b)
```




    array([[0, 3, 0, 6],
           [2, 1, 4, 2],
           [0, 9, 0, 3],
           [6, 3, 2, 1]])




```python
a = np.ones((2,5,2,5))
b = np.ones((2,3,4))
np.kron(a,b).shape
```




    (2, 10, 6, 20)



### å¤šçŸ©é˜µä¹˜æ³•

`linalg.multi_dot`é“¾å¼è°ƒç”¨`np.dot`ï¼Œè‡ªåŠ¨é€‰æ‹©æœ€å¿«çš„é¡ºåºã€‚

- å¦‚æœç¬¬ä¸€ä¸ªæ•°ç»„æ˜¯ä¸€ç»´ï¼Œåˆ™è¢«å½“åšè¡Œå‘é‡
- å¦‚æœæœ€åä¸€ä¸ªæ•°ç»„æ˜¯ä¸€ç»´ï¼Œåˆ™è¢«å½“åšåˆ—å‘é‡
- å¦‚æœè¾“å…¥çš„å‘é‡è¶…è¿‡ä¸¤ä¸ªï¼Œåˆ™å…¶ä»–å‘é‡å¿…é¡»æ˜¯äºŒç»´


```python
a = np.ones((2, 4))
b = np.ones((4, 3))
c = np.ones((3, 5))
```


```python
np.linalg.multi_dot((a,b,c)).shape
```




    (2, 5)



ä¸åŒçš„é¡ºåºæ€§èƒ½ä¸åŒï¼Œæ¯”å¦‚ï¼š

`A_{10x100}, B_{100x5}, C_{5x50}`


`cost((AB)C) = 10*100*5 + 10*5*50   = 5000 + 2500   = 7500`
`cost(A(BC)) = 10*100*50 + 100*5*50 = 50000 + 25000 = 75000`


```python
rng = np.random.default_rng(42)
a = rng.integers(0, 10, (10, 100))
b = rng.integers(0, 10, (100, 5))
c = rng.integers(0, 10, (5, 50))
```


```python
%timeit a.dot(b).dot(c).shape
```

    8.74 Âµs Â± 745 ns per loop (mean Â± std. dev. of 7 runs, 100000 loops each)
    


```python
%timeit a.dot(b.dot(c)).shape
```

    66 Âµs Â± 4.96 Âµs per loop (mean Â± std. dev. of 7 runs, 10000 loops each)
    


```python
%timeit np.linalg.multi_dot((a, b, c)).shape
```

    13.6 Âµs Â± 335 ns per loop (mean Â± std. dev. of 7 runs, 100000 loops each)
    

å¦‚æœé¦–å°¾æ˜¯ä¸€ç»´ï¼š


```python
a = np.ones((3))
b = np.ones((3, 5))
c = np.ones((5, 8))
d = np.ones(8)
```


```python
a.dot(b).dot(c).shape
```




    (8,)




```python
# a=1x3
np.linalg.multi_dot((a, b, c)).shape
```




    (8,)




```python
# d=8x1
np.linalg.multi_dot((b, c, d)).shape
```




    (3,)




```python
b.dot(c).dot(d).shape
```




    (3,)



## åŸºç¡€æ¦‚å¿µ

ä»‹ç»çº¿æ€§ä»£æ•°å‡ ä¸ªå¸¸ç”¨çš„APIï¼Œä¸æ¶‰åŠæ•°å­¦çŸ¥è¯†ã€‚


```python
from numpy import linalg as LA
```

### èŒƒæ•°

å…±åŒ…æ‹¬ï¼š

```
=====  ============================  ==========================
ord    norm for matrices             norm for vectors
=====  ============================  ==========================
None   Frobenius norm                2-norm
'fro'  Frobenius norm                --
'nuc'  nuclear norm                  --
inf    max(sum(abs(x), axis=1))      max(abs(x))
-inf   min(sum(abs(x), axis=1))      min(abs(x))
0      --                            sum(x != 0)
1      max(sum(abs(x), axis=0))      as below
-1     min(sum(abs(x), axis=0))      as below
2      2-norm (largest sing. value)  as below
-2     smallest singular value       as below
other  --                            sum(abs(x)**ord)**(1./ord)
=====  ============================  ==========================
```

- [Matrix norm - Wikipedia](https://en.wikipedia.org/wiki/Matrix_norm)


```python
a = np.arange(6).reshape(2, 3)
a
```




    array([[0, 1, 2],
           [3, 4, 5]])




```python
LA.norm(a)
```




    7.416198487095663




```python
# FèŒƒæ•°
LA.norm(a, "fro"), np.sqrt(np.sum(a**2))
```




    (7.416198487095663, 7.416198487095663)




```python
# æ ¸èŒƒæ•°
LA.norm(a, "nuc"), np.sum(LA.svd(a)[1])
```




    (8.348469228349535, 8.348469228349535)




```python
# inf
LA.norm(a, np.inf), np.max(np.sum(abs(a), axis=1))
```




    (12.0, 12)




```python
# -inf
LA.norm(a, -np.inf), np.min(np.sum(abs(a), axis=1))
```




    (3.0, 3)




```python
# 1
LA.norm(a, 1), np.max(np.sum(abs(a), axis=0))
```




    (7.0, 7)




```python
# -1
LA.norm(a, -1), np.min(np.sum(abs(a), axis=0))
```




    (3.0, 3)




```python
# 2
LA.norm(a, 2), np.max(LA.svd(a)[1])
```




    (7.3484692283495345, 7.3484692283495345)




```python
# -2
LA.norm(a, -2), np.min(LA.svd(a)[1])
```




    (0.9999999999999998, 0.9999999999999998)



### è¡Œåˆ—å¼ã€è¿¹


```python
a = np.array(([1,5],[3,4]))
a
```




    array([[1, 5],
           [3, 4]])




```python
LA.det(a), 1*4-5*3
```




    (-11.000000000000002, -11)




```python
a[0,0] + a[1,1]
```




    5




```python
# äºŒç»´
np.trace(a)
```




    5




```python
a = np.arange(8).reshape((2,2,2))
a
```




    array([[[0, 1],
            [2, 3]],
    
           [[4, 5],
            [6, 7]]])




```python
a[0,0] + a[1,1]
```




    array([6, 8])




```python
np.trace(a)
```




    array([6, 8])



### ç‰¹å¾å€¼

`eig`è®¡ç®—ä¸€ä¸ªæ–¹é˜µçš„ç‰¹å¾å€¼å’Œå³ç‰¹å¾å‘é‡ï¼Œ`eigvals`ä¸ä¹‹çš„åŒºåˆ«æ˜¯ä¸è¿”å›ç‰¹å¾å‘é‡ã€‚


```python
a = np.diag([1,2,3])
w, v = LA.eig(a)
```


```python
w
```




    array([1., 2., 3.])




```python
v
```




    array([[1., 0., 0.],
           [0., 1., 0.],
           [0., 0., 1.]])




```python
LA.eigvals(a)
```




    array([1., 2., 3.])




```python
a @ v == w * v
```




    array([[ True,  True,  True],
           [ True,  True,  True],
           [ True,  True,  True]])




```python
rng = np.random.default_rng(42)
a = rng.integers(0, 10, (3, 3))
a
```




    array([[0, 7, 6],
           [4, 4, 8],
           [0, 6, 2]])




```python
w, v = LA.eig(a)
```


```python
np.allclose(a @ v, w * v)
```




    True




```python
LA.eigvals(a) == w
```




    array([ True,  True,  True])



`eigh`è®¡ç®—åŸƒå°”ç±³ç‰¹çŸ©é˜µæˆ–å®å¯¹ç§°çŸ©é˜µçš„ç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡ï¼Œ`eigvalsh`ä¸ä¹‹çš„åŒºåˆ«æ˜¯åè€…ä¸è¿”å›ç‰¹å¾å‘é‡ã€‚


- [åŸƒå°”ç±³ç‰¹çŸ©é˜µ - ç»´åŸºç™¾ç§‘ï¼Œè‡ªç”±çš„ç™¾ç§‘å…¨ä¹¦](https://zh.wikipedia.org/wiki/%E5%9F%83%E5%B0%94%E7%B1%B3%E7%89%B9%E7%9F%A9%E9%98%B5)
- [å°ç¨±çŸ©é™£ - ç»´åŸºç™¾ç§‘ï¼Œè‡ªç”±çš„ç™¾ç§‘å…¨ä¹¦](https://zh.wikipedia.org/zh/%E5%B0%8D%E7%A8%B1%E7%9F%A9%E9%99%A3)


ä»¥å®å¯¹ç§°çŸ©é˜µä¸ºä¾‹ã€‚


```python
a = np.array([
    [1, 2, 3],
    [2, 4, -5],
    [3, -5, 6]
])
```


```python
LA.eigh(a)
```




    (array([-3.07730361,  3.84139016, 10.23591345]),
     array([[-0.65271955,  0.74655097,  0.12891408],
            [ 0.55145509,  0.58486128, -0.59483995],
            [ 0.5194752 ,  0.31717334,  0.79343972]]))




```python
LA.eigvalsh(a)
```




    array([-3.07730361,  3.84139016, 10.23591345])




```python
LA.eig(a)
```




    (array([-3.07730361,  3.84139016, 10.23591345]),
     array([[-0.65271955,  0.74655097,  0.12891408],
            [ 0.55145509,  0.58486128, -0.59483995],
            [ 0.5194752 ,  0.31717334,  0.79343972]]))



## çŸ©é˜µè¿ç®—

### çŸ©é˜µæ±‚è§£

`solve`å¯ç›´æ¥æ±‚è§£ï¼š


```python
x = np.array([[1, 2], [3, 5]])
y = np.array([1, 2])
w = LA.solve(x, y)
```


```python
np.allclose(x.dot(w), y)
```




    True



`tensorsolve`æ›´åŠ é€šç”¨ä¸€äº›ï¼š


```python
LA.tensorsolve(x, y)
```




    array([-1.,  1.])




```python
rng = np.random.default_rng(42)
x = rng.integers(0, 10, (6, 4, 2, 3, 4))
y = rng.integers(0, 10, (6, 4))
```


```python
LA.tensorsolve(x, y).shape
```




    (2, 3, 4)




```python
LA.solve(x,y)
```


    ---------------------------------------------------------------------------

    LinAlgError                               Traceback (most recent call last)

    <ipython-input-1256-9be96e929103> in <module>
    ----> 1 LA.solve(x,y)
    

    /usr/local/lib/python3.8/site-packages/numpy/core/overrides.py in solve(*args, **kwargs)
    

    /usr/local/lib/python3.8/site-packages/numpy/linalg/linalg.py in solve(a, b)
        378     a, _ = _makearray(a)
        379     _assert_stacked_2d(a)
    --> 380     _assert_stacked_square(a)
        381     b, wrap = _makearray(b)
        382     t, result_t = _commonType(a, b)
    

    /usr/local/lib/python3.8/site-packages/numpy/linalg/linalg.py in _assert_stacked_square(*arrays)
        201         m, n = a.shape[-2:]
        202         if m != n:
    --> 203             raise LinAlgError('Last 2 dimensions of the array must be square')
        204 
        205 def _assert_finite(*arrays):
    

    LinAlgError: Last 2 dimensions of the array must be square


å¯ä»¥ä½¿ç”¨æœ€å°äºŒä¹˜æ³•è¿‘ä¼¼æ±‚è§£ï¼š


```python
from sklearn.datasets import load_iris
from sklearn.model_selection import train_test_split
```


```python
data = load_iris()
```


```python
x = data["data"]
y = data["target"]
```


```python
x_train, x_test, y_train, y_test = \
train_test_split(x, y, test_size=0.2)
```


```python
w = LA.lstsq(x_train, y_train, rcond=None)[0]
```


```python
# ç²¾å‡†ç‡
np.sum(
    np.abs(x_test.dot(w)).round()==y_test
)/len(y_test)
```




    1.0



### é€†çŸ©é˜µ

`inv`å¯ç”¨äºæ±‚çŸ©é˜µé€†ï¼š


```python
a = np.arange(1, 5).reshape(2, 2)
a
```




    array([[1, 2],
           [3, 4]])




```python
inva = LA.inv(a)
```


```python
np.allclose(inva.dot(a), np.eye(2))
```




    True



ä½¿ç”¨å¥‡å¼‚å€¼åˆ†è§£è®¡ç®—çŸ©é˜µä¼ªé€†ã€‚


```python
rng = np.random.default_rng(42)
a = rng.integers(0, 10, (2, 3))
a
```




    array([[0, 7, 6],
           [4, 4, 8]])




```python
inva = LA.pinv(a)
inva
```




    array([[-0.12751678,  0.14261745],
           [ 0.15436242, -0.08053691],
           [-0.01342282,  0.09395973]])




```python
np.allclose(a.dot(inva), np.eye(2))
```




    True




```python
np.allclose(a.dot(inva).dot(a), a)
```




    True




```python
np.allclose(a.dot(inva.dot(a)), a)
```




    True




```python
np.allclose(inva.dot(a.dot(inva)), inva)
```




    True



`tensorinv`é€‚ç”¨äºé«˜ç»´æ•°ç»„æ±‚é€†ï¼š


```python
rng = np.random.default_rng(42)
a = rng.integers(0, 10, (4, 6, 8, 3))
```


```python
ainv = np.linalg.tensorinv(a, ind=2)
```


```python
np.tensordot(a, ainv).shape
```




    (4, 6, 4, 6)




```python
eye = np.eye(4*6)
eye.shape = (4, 6, 4, 6)
```


```python
np.allclose(np.tensordot(a, ainv), eye)
```




    True



### çŸ©é˜µåˆ†è§£

`cholesky`åˆ†è§£æ˜¯æŠŠä¸€ä¸ªå¯¹ç§°æ­£å®šçš„çŸ©é˜µè¡¨ç¤ºæˆä¸€ä¸ªä¸‹ä¸‰è§’çŸ©é˜µLå’Œå…¶è½¬ç½®çš„ä¹˜ç§¯çš„åˆ†è§£ã€‚è¦æ±‚æ‰€æœ‰çš„ç‰¹å¾å€¼å¿…é¡»å¤§äºé›¶ã€‚


[ç§‘åˆ—æ–¯åŸºåˆ†è§£ - ç»´åŸºç™¾ç§‘ï¼Œè‡ªç”±çš„ç™¾ç§‘å…¨ä¹¦](https://zh.wikipedia.org/zh-sg/%E7%A7%91%E5%88%97%E6%96%AF%E5%9F%BA%E5%88%86%E8%A7%A3)


```python
a = np.array([
    [4, 12, -16],
    [12, 37, -43],
    [-16, -43, 98]
])
```


```python
ca = LA.cholesky(a)
ca
```




    array([[ 2.,  0.,  0.],
           [ 6.,  1.,  0.],
           [-8.,  5.,  3.]])




```python
np.array_equal(ca.dot(ca.T), a)
```




    True



`qr`åˆ†è§£å°†çŸ©é˜µåˆ†è§£æˆä¸€ä¸ªæ­£äº¤çŸ©é˜µå’Œä¸€ä¸ªä¸Šä¸‰è§’çŸ©é˜µçš„ç§¯ã€‚


[QR åˆ†è§£ - ç»´åŸºç™¾ç§‘ï¼Œè‡ªç”±çš„ç™¾ç§‘å…¨ä¹¦](https://zh.wikipedia.org/zh-hans/QR%E5%88%86%E8%A7%A3)


```python
rng = np.random.default_rng(42)
a = rng.integers(0, 10, (4, 5))
a
```




    array([[0, 7, 6, 4, 4],
           [8, 0, 6, 2, 0],
           [5, 9, 7, 7, 7],
           [7, 5, 1, 8, 4]])




```python
# qæ˜¯æ­£äº¤çŸ©é˜µï¼Œræ˜¯ä¸Šä¸‰è§’çŸ©é˜µ
q, r = LA.qr(a)
```


```python
q.shape, r.shape
```




    ((4, 4), (4, 5))




```python
np.allclose(q.dot(r), a)
```




    True




```python
# è½¬ç½®=é€†
np.allclose(LA.inv(q), q.T)
```




    True



`svd`åˆ†è§£å°†çŸ©é˜µåˆ†è§£ä¸ºä¸€ä¸ªé…‰çŸ©é˜µ`U`ã€ä¸€ä¸ªéè´Ÿå®å¯¹è§’çŸ©é˜µ`Î£`å’Œä¸€ä¸ªå…±è½­è½¬ç½®çŸ©é˜µ`V*`çš„ä¹˜ç§¯ã€‚Î£å¯¹è§’çº¿ä¸Šçš„å…ƒç´ ä¸ºå¥‡å¼‚å€¼ã€‚

`M = UÎ£V*`


[å¥‡å¼‚å€¼åˆ†è§£ - ç»´åŸºç™¾ç§‘ï¼Œè‡ªç”±çš„ç™¾ç§‘å…¨ä¹¦](https://zh.wikipedia.org/zh-hans/%E5%A5%87%E5%BC%82%E5%80%BC%E5%88%86%E8%A7%A3)


```python
a
```




    array([[0, 7, 6, 4, 4],
           [8, 0, 6, 2, 0],
           [5, 9, 7, 7, 7],
           [7, 5, 1, 8, 4]])




```python
u, s, vh = LA.svd(a)
```


```python
u.shape, s.shape, vh.shape
```




    ((4, 4), (4,), (5, 5))




```python
xgm = np.insert(np.diag(s), s.shape[0], 0, axis=1)
xgm.shape
```




    (4, 5)




```python
np.allclose(u.dot(xgm).dot(vh), a)
```




    True



## Einsum

ä½¿ç”¨`einsum`å¯ä»¥è®©å¾ˆå¤šå¸¸è§çš„æ•°ç»„è¿ç®—ä»¥ç®€æ´çš„æ–¹å¼è¡¨ç¤ºã€‚

ä¸‹æ ‡å­—ç¬¦ä¸²æ˜¯ä¸€ä¸ªé€—å·åˆ†éš”çš„ä¸‹æ ‡æ ‡ç­¾åˆ—è¡¨ï¼Œæ¯ä¸ªæ ‡ç­¾æŒ‡çš„æ˜¯ç›¸åº”æ“ä½œçš„ä¸€ä¸ªç»´åº¦ã€‚
- æ ‡ç­¾é‡å¤æ—¶ä¼šè¢«æ±‚å’Œ`np.einsum("i,i", a, b)`ï¼Œç­‰ä»·äº`np.inner(a,b)`ã€‚
- å¦‚æœåªå‡ºç°ä¸€æ¬¡`np.einsum("i", a)`ï¼Œè¿”å›è‡ªå·±çš„viewã€‚
- é‡å¤ä¸‹æ ‡æ ‡ç­¾å–å¯¹è§’çº¿`np.einsum("ii", a)`ï¼Œç­‰ä»·äº`np.trace(a)`


åœ¨éšå¼æ¨¡å¼ä¸‹ï¼Œä¸‹æ ‡å¾ˆé‡è¦ï¼Œè¾“å‡ºçš„è½´ä¼šæŒ‰å­—æ¯é‡æ–°æ’åºã€‚æ¯”å¦‚ï¼š
- `np.einsum("ij",a)`ä¸ä¼šå½±å“äºŒç»´æ•°ç»„ï¼Œä½†`np.einsum("ji",a)`åˆ™è¿”å›è½¬ç½®ã€‚
- `np.einsum("ij,jk", a, b)`ä¼šè¿”å›çŸ©é˜µä¹˜æ³•ï¼Œè€Œ`np.einsum("ij,jh", a, b)`åˆ™è¿”å›ä¹˜æ³•çš„è½¬ç½®ã€‚


åœ¨æ˜¾å¼æ¨¡å¼ä¸‹ï¼Œå¯ä»¥é€šè¿‡æŒ‡å®šè¾“å‡ºä¸‹æ ‡æ ‡ç­¾ç›´æ¥æ§åˆ¶è¾“å‡ºã€‚æ­¤æ—¶éœ€è¦`->`æ ‡è¯†ç¬¦ã€‚
- `np.einsum("i->", a)`ç±»ä¼¼äº`np.sum(a, axis=-1)`ã€‚
- `np.einsum("ii->i", a)`ç±»ä¼¼äº`np.diag(a)`ã€‚
- `np.einsum("ij,jh->ih", a, b)`è¿”å›ä¹˜æ³•ç»“æœï¼Œè€Œä¸æ˜¯ç»“æœçš„è½¬ç½®ã€‚

`einsum`é»˜è®¤ä¸æ”¯æŒå¹¿æ’­ï¼Œè¦å¯ç”¨éœ€ä½¿ç”¨ï¼ˆåœ¨å·¦ä¾§æ·»åŠ ï¼‰çœç•¥å·ã€‚
- `np.einsum("..ii->...i", a)`
- è·Ÿè¸ªç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªç»´åº¦ï¼š`np.einsum("i...i", a)`
- ç”¨æœ€å·¦è¾¹çš„è½´çŸ©é˜µä¹˜æ³•ï¼š`np.einsum("ij...,jk...->ik...", a, b)`


```python
a = np.arange(3)
b = np.arange(9).reshape(3, 3)
c = np.arange(6).reshape(2,3)
d = np.arange(6).reshape(3,2)
e = np.arange(60).reshape(3,4,5)
f = np.arange(24).reshape(4,3,2)
g = np.arange(30).reshape(3,5,2)
```

ä¸€ä¸ªæ ‡ç­¾ï¼š


```python
# è¿”å›è‡ªå·±çš„view
np.einsum("i", a)
```




    array([0, 1, 2])




```python
# å¹¿æ’­
np.einsum("...i", b)
```




    array([[0, 1, 2],
           [3, 4, 5],
           [6, 7, 8]])




```python
# å†…ç§¯
np.einsum("i,i", a,a), np.inner(a, a)
```




    (5, 5)




```python
# è¿¹
np.einsum("ii", b), np.trace(b)
```




    (12, 12)



éšå¼æ¨¡å¼ï¼š


```python
# ä¸å½±å“ç»“æœ
np.einsum("ij", c)
```




    array([[0, 1, 2],
           [3, 4, 5]])




```python
# è¿”å›è½¬ç½®
np.einsum("ji", c)
```




    array([[0, 3],
           [1, 4],
           [2, 5]])




```python
# å¤–ç§¯
np.einsum("i,j", a,a), np.outer(a, a)
```




    (array([[0, 0, 0],
            [0, 1, 2],
            [0, 2, 4]]),
     array([[0, 0, 0],
            [0, 1, 2],
            [0, 2, 4]]))




```python
# çŸ©é˜µä¹˜æ³•
np.einsum("ij,jk", c, d)
```




    array([[10, 13],
           [28, 40]])




```python
# håœ¨iä¹‹å‰ï¼Œè¿”å›è½¬ç½®
np.einsum("ij,jh", c, d)
```




    array([[10, 28],
           [13, 40]])




```python
np.einsum("ij,j", c,a), np.dot(c,a)
```




    (array([ 5, 14]), array([ 5, 14]))



æ˜¾å¼æ¨¡å¼ï¼š


```python
# æ±‚å’Œ
np.einsum("i->", a)
```




    10




```python
# np.sum(b, axis=1)
np.einsum("ij->i", b), np.sum(b, axis=1)
```




    (array([ 3, 12, 21]), array([ 3, 12, 21]))




```python
# æ±‚å’Œ
np.einsum("ij->i", c), np.sum(c, axis=1)
```




    (array([ 3, 12]), array([ 3, 12]))




```python
# np.sum(d, axis=0)
np.einsum("ij->j", d), np.sum(d, axis=0)
```




    (array([6, 9]), array([6, 9]))




```python
# å…ƒç´ ç›¸ä¹˜
np.einsum("i,i->i", a, a), a*a
```




    (array([0, 1, 4]), array([0, 1, 4]))




```python
np.einsum("i,j->", a, a), np.outer(a,a).sum()
```




    (9, 9)




```python
# æ˜¾å¼ï¼Œè½¬ç½®
np.einsum("ij->ji", c)
```




    array([[0, 3],
           [1, 4],
           [2, 5]])




```python
# è¿”å›diag
np.einsum("ii->i", b)
```




    array([0, 4, 8])




```python
# å…ƒç´ ç›¸ä¹˜
np.einsum("ij,ij->ij", c, c)
```




    array([[ 0,  1,  4],
           [ 9, 16, 25]])




```python
# çŸ©é˜µä¹˜æ³•ï¼Œå› ä¸ºæ˜¾å¼æŒ‡å®šï¼Œä¸ä¼šè½¬ç½®
np.einsum("ij,jh->ih", c,d)
```




    array([[10, 13],
           [28, 40]])




```python
# æ±‚å’Œ
np.einsum("ij,jh->i", c, d)
```




    array([23, 68])




```python
np.einsum("ij,jh->h", c, d)
```




    array([38, 53])




```python
# å¤šç»´
# e=(3,4,5), f=(4,3,2)
np.einsum("ijk,jil->kl", e, f).shape
```




    (5, 2)




```python
np.einsum("ijk,ikh->ijh", e, g).shape
```




    (3, 4, 2)




```python
np.array_equal(
    np.einsum("ijk,ikh->ijh", e, g), 
    np.matmul(e,g)
)
```




    True




```python
np.einsum("ij,kl -> ijkl", c, d).shape
```




    (2, 3, 3, 2)




```python
np.array_equal(
    np.einsum("ij,kl->ijkl", c, d),
    c[:,:,None,None] * d
)
```




    True




```python
np.einsum("ij,jk->ijk", c, d).shape
```




    (2, 3, 2)




```python
np.array_equal(np.einsum("ij,jk->ijk", c, d), c[:,:,None]*d)
```




    True



å¹¿æ’­ï¼š


```python
# çŸ©é˜µä¹˜æ³•
# c=(2,3), a=(3,)
np.einsum("...j,j", c, a)
```




    array([ 5, 14])




```python
# a=(3,), c=(2,3)
np.einsum("j,...j", a, c)
```




    array([ 5, 14])




```python
# a=(3,), d=(3, 2)
np.einsum("j,j...", a, d)
```




    array([10, 13])




```python
# å»¶ç»­ä¸Šé¢çš„ä¹˜æ³•ï¼Œæ˜¾å¼
np.einsum("ij,j...->i...", c, d)
```




    array([[10, 13],
           [28, 40]])




```python
# éšå¼
np.einsum("...j,ji", c, d)
```




    array([[10, 13],
           [28, 40]])



## Padding

Paddingæ“ä½œï¼Œå‚æ•°å¦‚ä¸‹ï¼š

- æ•°ç»„
- pad_widthï¼šåºåˆ—ã€æ•´æ•°æˆ–æ•°ç»„ï¼Œæ¯ä¸ªè½´è¾¹ç¼˜æ‰©å±•çš„æ•°é‡ã€‚
- æ¨¡å¼ï¼šé»˜è®¤constantã€‚è¿˜åŒ…æ‹¬ï¼šedge, linear_ramp, maximum, mean, median, minimum, reflect, symmetric, wrap, emptyã€‚
- stat_lengthï¼šåºåˆ—ã€æ•´æ•°æˆ–æ•°ç»„ï¼Œæ¨¡å¼æ˜¯`maximum`, `minimum`, `mean`, `median`\æ—¶ï¼Œç”¨æ¥è®¡ç®—æ¯ä¸ªè½´è¾¹ç¼˜çš„å€¼ï¼Œé»˜è®¤Noneã€‚
- constant_valuesï¼šåºåˆ—æˆ–æ ‡é‡ï¼Œpaddingçš„å€¼ï¼Œé»˜è®¤0ã€‚
- end_valuesï¼šè™šåˆ—æˆ–æ ‡é‡ï¼Œæ¨¡å¼æ˜¯`linear_ramp`æ—¶ä½¿ç”¨ï¼Œç”¨äºç»“æŸå€¼ï¼Œç»å½¢æˆå¡«å……æ•°ç»„çš„è¾¹ç¼˜ï¼Œé»˜è®¤0ã€‚
- reflect_typeï¼šæ¨¡å¼æ˜¯`reflect`å’Œ`symmetric`æ—¶ä½¿ç”¨ï¼Œé»˜è®¤ä½¿ç”¨`even`é£æ ¼ï¼Œè¾¹ç¼˜å€¼å‘¨å›´ä¸æ”¹å˜åå°„ï¼Œ`odd`æ¨¡å¼ï¼Œæ•°ç»„çš„æ‹“å±•éƒ¨åˆ†æ˜¯é€šè¿‡ä»è¾¹ç¼˜å€¼çš„ä¸¤å€ä¸­å‡å»åå°„å€¼æ¥åˆ›å»ºçš„ã€‚

é¦–å…ˆçœ‹pad_widthå‚æ•°ï¼š


```python
# tuple
np.pad(
    [1,2,3,4,5], 
    (2,3),  # ç­‰äº((2,3),), ((2,3))
    "constant", 
    constant_values=(4, 6)
)
```




    array([4, 4, 1, 2, 3, 4, 5, 6, 6, 6])




```python
np.pad(
    [1,2,3,4,5], 
    2, # ç­‰äº(2), (2, )
    "constant", 
    constant_values=(4, 6)
)
```




    array([4, 4, 1, 2, 3, 4, 5, 6, 6])




```python
# åˆ†åˆ«å·¦ä¸Šï¼Œå³ä¸‹
np.pad(
    [[1,2,3],[4,5,6]],
    (1, 2)
)
```




    array([[0, 0, 0, 0, 0, 0],
           [0, 1, 2, 3, 0, 0],
           [0, 4, 5, 6, 0, 0],
           [0, 0, 0, 0, 0, 0],
           [0, 0, 0, 0, 0, 0]])




```python
# è¡Œï¼ˆ1,2ï¼‰
# åˆ—ï¼ˆ2,1ï¼‰
np.pad(
    [[1,2,3],[4,5,6]],
    ((1, 2), (2, 1))
)
```




    array([[0, 0, 0, 0, 0, 0],
           [0, 0, 1, 2, 3, 0],
           [0, 0, 4, 5, 6, 0],
           [0, 0, 0, 0, 0, 0],
           [0, 0, 0, 0, 0, 0]])




```python
np.pad(
    [[1,2,3],[4,5,6]],
    1
)
```




    array([[0, 0, 0, 0, 0],
           [0, 1, 2, 3, 0],
           [0, 4, 5, 6, 0],
           [0, 0, 0, 0, 0]])



æ¥ä¸‹æ¥çœ‹ä¸‹ä¸åŒæ¨¡å¼ï¼Œé¡ºå¸¦äº†è§£ä¸åŒæ¨¡å¼å¯¹åº”çš„é¢å¤–å‚æ•°ã€‚ç®€å•èµ·è§ï¼Œ`pad_width`æˆ‘ä»¬ç»Ÿä¸€ä½¿ç”¨æ•´æ•°ã€‚


```python
a = np.arange(1, 7).reshape(3, 2)
a
```




    array([[1, 2],
           [3, 4],
           [5, 6]])




```python
# edge
np.pad(a, 1, "edge")
```




    array([[1, 1, 2, 2],
           [1, 1, 2, 2],
           [3, 3, 4, 4],
           [5, 5, 6, 6],
           [5, 5, 6, 6]])




```python
# linear_ramp
# éœ€è¦é¢å¤–å‚æ•°ï¼šend_valuesï¼Œé»˜è®¤0
np.pad(a, 1, "linear_ramp")
```




    array([[0, 0, 0, 0],
           [0, 1, 2, 0],
           [0, 3, 4, 0],
           [0, 5, 6, 0],
           [0, 0, 0, 0]])




```python
np.pad(a, 1, "linear_ramp", end_values=(1, ))
```




    array([[1, 1, 1, 1],
           [1, 1, 2, 1],
           [1, 3, 4, 1],
           [1, 5, 6, 1],
           [1, 1, 1, 1]])




```python
np.pad(a, 1, "linear_ramp", end_values=(1, 2), )
```




    array([[1, 1, 1, 2],
           [1, 1, 2, 2],
           [1, 3, 4, 2],
           [1, 5, 6, 2],
           [1, 2, 2, 2]])




```python
# è¡Œï¼ˆ1,2ï¼‰
# åˆ—ï¼ˆ3,4ï¼‰
np.pad(a, 1, "linear_ramp", end_values=((1, 2), (3, 4)))
```




    array([[3, 1, 1, 4],
           [3, 1, 2, 4],
           [3, 3, 4, 4],
           [3, 5, 6, 4],
           [3, 2, 2, 4]])




```python
# å’Œè¿™ä¸ªç­‰ä»·
np.pad(
    a,
    1,
    "constant", 
    constant_values=((1, 2), (3,4))
)
```




    array([[3, 1, 1, 4],
           [3, 1, 2, 4],
           [3, 3, 4, 4],
           [3, 5, 6, 4],
           [3, 2, 2, 4]])




```python
# maximum, minmum, mean, median
# éœ€è¦é¢å¤–å‚æ•°stat_lengthï¼Œé»˜è®¤Noneï¼Œä½¿ç”¨è¯¥è½´æ‰€æœ‰å€¼
np.pad(a, 1, "maximum")
```




    array([[6, 5, 6, 6],
           [2, 1, 2, 2],
           [4, 3, 4, 4],
           [6, 5, 6, 6],
           [6, 5, 6, 6]])




```python
# åªå–2ä¸ª
np.pad(a, 1, "maximum", stat_length=2)
```




    array([[4, 3, 4, 4],
           [2, 1, 2, 2],
           [4, 3, 4, 4],
           [6, 5, 6, 6],
           [6, 5, 6, 6]])




```python
# åˆ†åˆ«å–ï¼Œå·¦ä¸Š2ï¼Œå³ä¸‹1
np.pad(a, 1, "maximum", stat_length=((2, 1), ))
```




    array([[4, 3, 4, 4],
           [2, 1, 2, 2],
           [4, 3, 4, 4],
           [6, 5, 6, 6],
           [6, 5, 6, 6]])




```python
# å„è‡ªåˆ†åˆ«æŒ‡å®š
# è¡Œï¼ˆ2,1ï¼‰
# åˆ—ï¼ˆ1,2ï¼‰
np.pad(a, 1, "maximum", stat_length=((2, 1), (1, 2)))
```




    array([[3, 3, 4, 4],
           [1, 1, 2, 2],
           [3, 3, 4, 4],
           [5, 5, 6, 6],
           [5, 5, 6, 6]])




```python
b = a.astype(np.float16)
```


```python
# meanå’Œmedianç±»ä¼¼
# è¡Œï¼ˆ2,1ï¼‰
# åˆ—ï¼ˆ1,2ï¼‰
np.pad(b, 1, "mean", stat_length=((2, 1), (1, 2)))
```




    array([[2. , 2. , 3. , 2.5],
           [1. , 1. , 2. , 1.5],
           [3. , 3. , 4. , 3.5],
           [5. , 5. , 6. , 5.5],
           [5. , 5. , 6. , 5.5]], dtype=float16)




```python
a = [1,2,3,4,5]
```


```python
# reflect, symmetric
# éœ€è¦é¢å¤–å‚æ•°reflect_typeï¼Œé»˜è®¤even
# é¦–æœ«æ˜¯å¯¹ç§°è½´
np.pad(a, 3, "reflect")
```




    array([4, 3, 2, 1, 2, 3, 4, 5, 4, 3, 2])




```python
# é¦–æœ«æ˜¯å¯¹ç§°è½´
np.pad(a, 3, "reflect", reflect_type="odd")
```




    array([-2, -1,  0,  1,  2,  3,  4,  5,  6,  7,  8])




```python
# è¾¹ç¼˜æ˜¯å¯¹ç§°è½´
np.pad(a, 3, "symmetric")
```




    array([3, 2, 1, 1, 2, 3, 4, 5, 5, 4, 3])




```python
# è¾¹ç¼˜æ˜¯å¯¹ç§°è½´
np.pad(a, 3, "symmetric", reflect_type="odd")
```




    array([-1,  0,  1,  1,  2,  3,  4,  5,  5,  6,  7])




```python
# wrap
# é¦–å°¾äº’æ¢
np.pad(a, 2, "wrap")
```




    array([4, 5, 1, 2, 3, 4, 5, 1, 2])




```python
# empty
# æœªå®šä¹‰å€¼æ‰©å±•
np.pad(a, 1, "empty")
```




    array([              0,               1,               2,               3,
                         4,               5, 123145302310976])



## å·ç§¯

å·ç§¯å‡½æ•°ï¼ˆä¸€ç»´ï¼‰éµå¾ªä»¥ä¸‹è§„åˆ™ï¼š

$$
(a * v)[n] = \sum_{m = -\infty}^{\infty} a[m] v[n - m]
$$


```python
np.convolve([1, 2, 3], [0, 1, 0.5], "valid"), 0.5*1+1*2+0*3
```




    (array([2.5]), 2.5)




```python
np.convolve([1, 2, 3], [0, 1, 0.5], "same")
```




    array([1. , 2.5, 4. ])




```python
np.convolve([0, 1, 2, 3, 0], [0, 1, 0.5], "valid") 
```




    array([1. , 2.5, 4. ])




```python
# é»˜è®¤ full
np.convolve([1, 2, 3], [0, 1, 0.5])
```




    array([0. , 1. , 2.5, 4. , 1.5])




```python
np.convolve([0, 0, 1, 2, 3, 0, 0], [0, 1, 0.5], "valid")
```




    array([0. , 1. , 2.5, 4. , 1.5])



## æ©ç è¿ç®—

ä½¿ç”¨NumPyçš„`ma`æ¨¡å—ï¼Œå…¶å¾ˆå¤šåŠŸèƒ½å’ŒNumPyä¸€æ ·ï¼Œæˆ‘ä»¬ä¸»è¦ä»‹ç»ä¸MASKç›¸å…³çš„åŠŸèƒ½ã€‚

æœ¬æ¨¡å—ä¸»è¦ç”¨äºå¤„ç†ä¸å®Œæ•´æ•°æ®æˆ–åŒ…å«æ— æ•ˆæ•°æ®ï¼Œæˆ–éœ€è¦äººä¸ºè¦†ç›–æ‰ä¸€éƒ¨åˆ†æ•°æ®çš„æƒ…å†µã€‚

ä¸€ä¸ªmaskæ•°ç»„æ˜¯ä¸€ä¸ªndarrayå’Œä¸€ä¸ªmaskçš„ç»„åˆã€‚maskæ—¢å¯ä»¥æ˜¯`nomask`ï¼Œè¡¨ç¤ºç›¸å…³è”æ•°ç»„å¯¹åº”çš„å€¼æ˜¯æ— æ•ˆçš„ï¼›è¦ä¹ˆæ˜¯ä¸€ä¸ªå¸ƒå°”æ•°ç»„ï¼Œä¸ºFalseæ—¶ï¼Œå…³è”æ•°ç»„å¯¹åº”ä½ç½®å€¼æœ‰æ•ˆï¼ˆæœªé®æ©ï¼‰ï¼Œä¸ºTrueæ—¶æ— æ•ˆï¼ˆè¢«é®æ©ï¼‰ã€‚


[Masked arrays â€” NumPy v1.23.dev0 Manual](https://numpy.org/devdocs/reference/maskedarray.html)


```python
import numpy.ma as ma
```

### ç®€ä»‹


```python
x = np.array([1, 2, 3, -1, 5])
```


```python
mx = ma.masked_array(x, mask=[0,0,0,1,0])
mx
```




    masked_array(data=[1, 2, 3, --, 5],
                 mask=[False, False, False,  True, False],
           fill_value=999999)




```python
mx.mean(), (1+2+3+5)/4
```




    (2.75, 2.75)



ä¹Ÿå¯ä»¥æŒ‡å®šmaskçš„å€¼ï¼Œè¿™é‡Œä¸¤ä¸ªé˜ˆå€¼rtolå’Œatolï¼Œé»˜è®¤å€¼å’Œ`np.allclose`ä¸€æ ·ï¼Œè¡¨ç¤ºåœ¨è¯¥èŒƒå›´å†…çš„å€¼éƒ½è¢«maskã€‚


```python
# maskæ‰1.1
ma.masked_values([1, 1.1, 1.1+1e-8, 2, 3, 4], 1.1)
```




    masked_array(data=[1.0, --, --, 2.0, 3.0, 4.0],
                 mask=[False,  True,  True, False, False, False],
           fill_value=1.1)




```python
# æ•´æ•°æ—¶å®Œå…¨ç›¸ç­‰æ‰ç®—
ma.masked_values([1, 2, 3, 4], 2, rtol=1, atol=2)
```




    masked_array(data=[1, --, 3, 4],
                 mask=[False,  True, False, False],
           fill_value=2)




```python
# å°æ•°æ—¶æŒ‰np.isclose`
# abs(a-b) < atol + rtol * abs(b)
# ä»¥4ä¸ºä¾‹ï¼Œ4-2 < 1.5+1*2
ma.masked_values([1., 2., 3., 4.], 2, rtol=1, atol=1.5)
```




    masked_array(data=[--, --, --, --],
                 mask=[ True,  True,  True,  True],
           fill_value=2.0,
                dtype=float64)




```python
(np.isclose(4, 2, rtol=1, atol=1.5), 
 np.allclose(4,2,rtol=1, atol=1.5))
```




    (True, True)



### åˆ›å»º

æœ‰å¤šç§æ–¹æ³•å¯ä»¥æ„é€ maskæ•°ç»„ï¼š

- ç›´æ¥è°ƒç”¨`MaskedArray`ç±»ï¼šéœ€è¦æŒ‡å®šæ•°æ®æ•°ç»„å’ŒMaskæ•°ç»„ã€‚
- ä½¿ç”¨æ„é€ å™¨ï¼š`array`å’Œ`masked_array`ï¼Œåè€…æ˜¯`MaskedArray`çš„aliasï¼Œå‰è€…åœ¨å‚æ•°ä¸Šç•¥æœ‰ä¸åŒã€‚
- å¯¹å·²æœ‰æ•°ç»„é€šè¿‡`view`è½¬ä¸ºmaskæ•°ç»„ã€‚
- å…¶ä»–ä¸€äº›å†…ç½®çš„å‡½æ•°ï¼Œæ¯”å¦‚ä¸Šé¢æåˆ°çš„`masked_values`ï¼Œè¿˜æœ‰æ¯”å¦‚ä¸ç»™å®švalueå®Œå…¨ç›¸ç­‰çš„ä¼šè¢«maskçš„`masked_object`ï¼Œæ ¹æ®æ¡ä»¶maskçš„`masked_where`ç­‰ã€‚æ›´å¤šå¯å‚è€ƒä¸‹é¢çš„æ–‡æ¡£ã€‚

[The numpy.ma module â€” NumPy v1.23.dev0 Manual](https://numpy.org/devdocs/reference/maskedarray.generic.html#constructing-masked-arrays)


```python
a = np.arange(6).reshape(2, 3)
mask = [[False, True, False],[False, False, True]]
```


```python
# ç›´æ¥è°ƒç”¨ç±»
ma.MaskedArray(a, mask=mask)
```




    masked_array(
      data=[[0, --, 2],
            [3, 4, --]],
      mask=[[False,  True, False],
            [False, False,  True]],
      fill_value=999999)




```python
# ä½¿ç”¨æ„é€ å™¨
ma.array(a, mask=mask)
```




    masked_array(
      data=[[0, --, 2],
            [3, 4, --]],
      mask=[[False,  True, False],
            [False, False,  True]],
      fill_value=999999)




```python
# ç±»çš„alias
ma.masked_array(a, mask)
```




    masked_array(
      data=[[0, --, 2],
            [3, 4, --]],
      mask=[[False,  True, False],
            [False, False,  True]],
      fill_value=999999)




```python
# view
a.view(ma.MaskedArray)
```




    masked_array(
      data=[[0, 1, 2],
            [3, 4, 5]],
      mask=False,
      fill_value=999999)




```python
# masked_objectä¸€èˆ¬ç”¨äºå¯¹è±¡
ma.masked_object(a, 3)
```




    masked_array(
      data=[[0, 1, 2],
            [--, 4, 5]],
      mask=[[False, False, False],
            [ True, False, False]],
      fill_value=3)




```python
ma.masked_object(
    np.array(["a", "b", "c"], dtype=object), 
    "b"
)
```




    masked_array(data=['a', --, 'c'],
                 mask=[False,  True, False],
           fill_value='b',
                dtype=object)




```python
# æœ‰æ¡ä»¶çš„
ma.masked_where(a>3, a)
```




    masked_array(
      data=[[0, 1, 2],
            [3, --, --]],
      mask=[[False, False, False],
            [False,  True,  True]],
      fill_value=999999)



### è·å–


```python
a
```




    array([[0, 1, 2],
           [3, 4, 5]])




```python
m = ma.masked_where(a%2==0, a)
m
```




    masked_array(
      data=[[--, 1, --],
            [3, --, 5]],
      mask=[[ True, False,  True],
            [False,  True, False]],
      fill_value=999999)




```python
m.data
```




    array([[0, 1, 2],
           [3, 4, 5]])




```python
m.mask
```




    array([[ True, False,  True],
           [False,  True, False]])




```python
a[m.mask]
```




    array([0, 2, 4])




```python
a[~m.mask]
```




    array([1, 3, 5])




```python
cm = m.compressed()
cm
```




    array([1, 3, 5])




```python
cm.data.obj
```




    array([1, 3, 5])



### ä¿®æ”¹

maskä¸€ä¸ªæˆ–å¤šä¸ªå€¼å¯ä»¥ç›´æ¥æŒ‡å®šã€‚

é¦–å…ˆæ˜¯maskæ“ä½œï¼š


```python
a = np.arange(6).reshape(2, 3)
# ç¬¬0è¡Œç¬¬2åˆ—ï¼Œç¬¬1è¡Œç¬¬1åˆ—
a[(0,1),(2,1)] = ma.masked
a
```




    array([[0, 1, 0],
           [3, 0, 5]])




```python
a = np.arange(6).reshape(2, 3)
# ç¬¬1åˆ—
a[:,1] = ma.masked
a
```




    array([[0, 0, 2],
           [3, 0, 5]])




```python
a = np.arange(6).reshape(2, 3)
# ç¬¬1åˆ—ä»¥åçš„
a[:,1:] = ma.masked
a
```




    array([[0, 0, 0],
           [3, 0, 0]])




```python
a = ma.arange(6).reshape(2, 3)
a.mask = [1,0,1]
a
```




    masked_array(
      data=[[--, 1, --],
            [--, 4, --]],
      mask=[[ True, False,  True],
            [ True, False,  True]],
      fill_value=999999)




```python
ma.arange(6).reshape(2,3)
```




    masked_array(
      data=[[0, 1, 2],
            [3, 4, 5]],
      mask=False,
      fill_value=999999)



å–æ¶ˆMaskï¼Œåªéœ€è¦ç»™å¯¹åº”ä½ç½®ä¸€ä¸ªæœ‰æ•ˆå€¼å³å¯ã€‚


```python
a = np.arange(6).reshape(2, 3)
mask = [[False, True, False],[False, False, True]]
```


```python
x = ma.array(a, mask=mask)
x
```




    masked_array(
      data=[[0, --, 2],
            [3, 4, --]],
      mask=[[False,  True, False],
            [False, False,  True]],
      fill_value=999999)




```python
x[0,1] = -1
x
```




    masked_array(
      data=[[0, -1, 2],
            [3, 4, --]],
      mask=[[False, False, False],
            [False, False,  True]],
      fill_value=999999)



å¦‚æœæ˜¯hardmaskï¼ˆmaskçš„å€¼ä¸èƒ½unmaskï¼‰ï¼Œåˆ™éœ€è¦å…ˆsoftï¼š


```python
x = ma.array(a, mask=mask, hard_mask=True)
x
```




    masked_array(
      data=[[0, --, 2],
            [3, 4, --]],
      mask=[[False,  True, False],
            [False, False,  True]],
      fill_value=999999)




```python
# çœ‹ï¼Œæ²¡å•¥ç”¨
x[0,1] = -1
x
```




    masked_array(
      data=[[0, --, 2],
            [3, 4, --]],
      mask=[[False,  True, False],
            [False, False,  True]],
      fill_value=999999)




```python
# æˆåŠŸ
x.soften_mask()
x[0,1] = -1
x
```




    masked_array(
      data=[[0, -1, 2],
            [3, 4, --]],
      mask=[[False, False, False],
            [False, False,  True]],
      fill_value=999999)




```python
# å†è½¬æˆhard
x.harden_mask()
```




    masked_array(
      data=[[0, -1, 2],
            [3, 4, --]],
      mask=[[False, False, False],
            [False, False,  True]],
      fill_value=999999)




```python
x
```




    masked_array(
      data=[[0, -1, 2],
            [3, 4, --]],
      mask=[[False, False, False],
            [False, False,  True]],
      fill_value=999999)




```python
# hardåå°±ä¸èƒ½åœ¨unmaskäº†
x[1,2] = -2
x
```




    masked_array(
      data=[[0, -1, 2],
            [3, 4, --]],
      mask=[[False, False, False],
            [False, False,  True]],
      fill_value=999999)



å¦‚æœæƒ³è¦unmaskæ‰æ‰€æœ‰çš„ï¼Œç›´æ¥ç”¨`nomask`ï¼š


```python
a = np.arange(6).reshape(2, 3)
mask = [[False, True, False],[False, False, True]]
x = ma.array(a, mask=mask)
x
```




    masked_array(
      data=[[0, --, 2],
            [3, 4, --]],
      mask=[[False,  True, False],
            [False, False,  True]],
      fill_value=999999)




```python
# æ³¨æ„ï¼Œhardåæ˜¯ä¸å¯ä»¥çš„
x.mask = ma.nomask
x
```




    masked_array(
      data=[[0, 1, 2],
            [3, 4, 5]],
      mask=[[False, False, False],
            [False, False, False]],
      fill_value=999999)



### ç´¢å¼•åˆ‡ç‰‡

å› ä¸ºæ˜¯`ndarray`çš„å­ç±»ï¼Œæ‰€ä»¥å’Œ`array`æ˜¯ç±»ä¼¼çš„ï¼Œå½“å‰ï¼Œå¾ˆå¤šå…¶ä»–æ–¹é¢ä¹Ÿæ˜¯é€šç”¨çš„ã€‚


```python
a = np.arange(6).reshape(2, 3)
mask = [[False, True, False],[False, False, True]]
x = ma.array(a, mask=mask)
x
```




    masked_array(
      data=[[0, --, 2],
            [3, 4, --]],
      mask=[[False,  True, False],
            [False, False,  True]],
      fill_value=999999)




```python
x[0]
```




    masked_array(data=[0, --, 2],
                 mask=[False,  True, False],
           fill_value=999999)




```python
x[0,0]
```




    0




```python
x[0,1]
```




    masked




```python
x[:,-1]
```




    masked_array(data=[2, --],
                 mask=[False,  True],
           fill_value=999999)




```python
x[:1]
```




    masked_array(data=[[0, --, 2]],
                 mask=[[False,  True, False]],
           fill_value=999999)



### ä»£æ•°è¿ç®—

`ma`æ¨¡å—æœ‰å¤§å¤šæ•°é€šå‡½æ•°çš„ç‰¹å®šæ—¶é™ï¼Œä½ç½®è¢«maskæˆ–å€¼è®¡ç®—æ— æ•ˆæ—¶ï¼Œéƒ½ä¼šç›´æ¥å˜æˆmaskã€‚

`ma`ä¹Ÿæ”¯æŒæ ‡å‡†çš„é€šå‡½æ•°ï¼Œè¾“å…¥maskæ•°ç»„ï¼Œè¾“å‡ºå¯¹åº”ä½ç½®ä¾ç„¶ä¹Ÿæ˜¯maskçš„ã€‚


```python
ma.log([-1, 0, 1, 2])
```




    masked_array(data=[--, --, 0.0, 0.6931471805599453],
                 mask=[ True,  True, False, False],
           fill_value=1e+20)




```python
x
```




    masked_array(
      data=[[0, --, 2],
            [3, 4, --]],
      mask=[[False,  True, False],
            [False, False,  True]],
      fill_value=999999)




```python
np.log(x)
```

    <ipython-input-581-de666c833898>:1: RuntimeWarning: divide by zero encountered in log
      np.log(x)
    




    masked_array(
      data=[[--, --, 0.6931471805599453],
            [1.0986122886681098, 1.3862943611198906, --]],
      mask=[[ True,  True, False],
            [False, False,  True]],
      fill_value=999999)




```python
np.exp(x)
```




    masked_array(
      data=[[1.0, --, 7.38905609893065],
            [20.085536923187668, 54.598150033144236, --]],
      mask=[[False,  True, False],
            [False, False,  True]],
      fill_value=999999)



### ä½¿ç”¨æ¡ˆä¾‹

ä¸€èˆ¬ç”¨äºç¼ºå¤±å€¼æˆ–å¼‚å¸¸å€¼çš„å¤„ç†ã€‚


```python
# å‡è®¾a[0,2]è¿™ä¸ªå€¼æ˜¯ç¼ºå¤±å€¼
a[0,2] = -9999
x = ma.masked_values(a, -9999)
x
```




    masked_array(
      data=[[0, 1, --],
            [3, 4, 5]],
      mask=[[False, False,  True],
            [False, False, False]],
      fill_value=-9999)




```python
x.mean(), 13/5
```




    (2.6, 2.6)




```python
x - x.mean()
```




    masked_array(
      data=[[-2.6, -1.6, --],
            [0.3999999999999999, 1.4, 2.4]],
      mask=[[False, False,  True],
            [False, False, False]],
      fill_value=-9999)




```python
x.anom()
```




    masked_array(
      data=[[-2.6, -1.6, --],
            [0.3999999999999999, 1.4, 2.4]],
      mask=[[False, False,  True],
            [False, False, False]],
      fill_value=-9999)




```python
x.anom(axis=0)
```




    masked_array(
      data=[[-1.5, -1.5, --],
            [1.5, 1.5, 0.0]],
      mask=[[False, False,  True],
            [False, False, False]],
      fill_value=-9999)




```python
x - x.mean(axis=0)
```




    masked_array(
      data=[[-1.5, -1.5, --],
            [1.5, 1.5, 0.0]],
      mask=[[False, False,  True],
            [False, False, False]],
      fill_value=-9999)



å¡«å……ç¼ºå¤±å€¼ï¼š


```python
x.filled(x.mean())
```




    array([[0, 1, 2],
           [3, 4, 5]])




```python
x
```




    masked_array(
      data=[[0, 1, --],
            [3, 4, 5]],
      mask=[[False, False,  True],
            [False, False, False]],
      fill_value=-9999)



ä¸¤ä¸ªmaskæ‰çš„æ•°ç»„ä¹Ÿå¯ä»¥è®¡ç®—ï¼š


```python
a = np.arange(6).reshape(2, 3)
mask1 = [[False, True, False],[False, False, True]]
mask2 = [[False, False, True],[False, False, True]]
x1 = ma.array(a, mask=mask1)
x2 = ma.array(a, mask=mask2)
x1, x2
```




    (masked_array(
       data=[[0, --, 2],
             [3, 4, --]],
       mask=[[False,  True, False],
             [False, False,  True]],
       fill_value=999999),
     masked_array(
       data=[[0, 1, --],
             [3, 4, --]],
       mask=[[False, False,  True],
             [False, False,  True]],
       fill_value=999999))




```python
x1+x2
```




    masked_array(
      data=[[0, --, --],
            [6, 8, --]],
      mask=[[False,  True,  True],
            [False, False,  True]],
      fill_value=999999)




```python
# 0/0æ— æ•ˆï¼Œç›´æ¥å˜æˆmask
np.sqrt(x1/x2)
```




    masked_array(
      data=[[--, --, --],
            [1.0, 1.0, --]],
      mask=[[ True,  True,  True],
            [False, False,  True]],
      fill_value=999999)



å¯ä»¥æ ¹æ®æ¡ä»¶å¤„ç†æ•°ç»„ï¼š


```python
a = np.arange(6).reshape(2, 3)
a
```




    array([[0, 1, 2],
           [3, 4, 5]])




```python
# åœ¨ç»™å®šèŒƒå›´ä¹‹å¤–çš„å°±ç»™maskæ‰
m = ma.masked_outside(a, 1, 4)
m
```




    masked_array(
      data=[[--, 1, 2],
            [3, 4, --]],
      mask=[[ True, False, False],
            [False, False,  True]],
      fill_value=999999)




```python
m.mean(), (1+2+3+4)/4
```




    (2.5, 2.5)




```python
# 3åˆ°5ä¹‹é—´çš„éƒ½ç»™maskæ‰
m = ma.masked_inside(a, 3, 5)
m
```




    masked_array(
      data=[[0, 1, 2],
            [--, --, --]],
      mask=[[False, False, False],
            [ True,  True,  True]],
      fill_value=999999)




```python
m = ma.masked_greater(a, 2)
m
```




    masked_array(
      data=[[0, 1, 2],
            [--, --, --]],
      mask=[[False, False, False],
            [ True,  True,  True]],
      fill_value=999999)



## å°ç»“



## å‚è€ƒ

- [python - Understanding NumPy's einsum - Stack Overflow](https://stackoverflow.com/questions/26089893/understanding-numpys-einsum)
- [Tim RocktÃ¤schel](https://rockt.github.io/2018/04/30/einsum)


```python

```
