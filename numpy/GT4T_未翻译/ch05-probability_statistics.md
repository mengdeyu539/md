<h1>Table of Contents<span class="tocSkip"></span></h1>
<div class="toc"><ul class="toc-item"><li><span><a href="#åŸºæœ¬æŒ‡æ ‡" data-toc-modified-id="åŸºæœ¬æŒ‡æ ‡-1"><span class="toc-item-num">1&nbsp;&nbsp;</span>åŸºæœ¬æŒ‡æ ‡</a></span></li><li><span><a href="#ç›¸å…³æ€§" data-toc-modified-id="ç›¸å…³æ€§-2"><span class="toc-item-num">2&nbsp;&nbsp;</span>ç›¸å…³æ€§</a></span></li><li><span><a href="#æŸ±çŠ¶å›¾" data-toc-modified-id="æŸ±çŠ¶å›¾-3"><span class="toc-item-num">3&nbsp;&nbsp;</span>æŸ±çŠ¶å›¾</a></span></li><li><span><a href="#è®¡æ•°" data-toc-modified-id="è®¡æ•°-4"><span class="toc-item-num">4&nbsp;&nbsp;</span>è®¡æ•°</a></span></li><li><span><a href="#éšæœºç”Ÿæˆå™¨" data-toc-modified-id="éšæœºç”Ÿæˆå™¨-5"><span class="toc-item-num">5&nbsp;&nbsp;</span>éšæœºç”Ÿæˆå™¨</a></span><ul class="toc-item"><li><span><a href="#Generator" data-toc-modified-id="Generator-5.1"><span class="toc-item-num">5.1&nbsp;&nbsp;</span>Generator</a></span></li><li><span><a href="#å¹¶è¡Œ" data-toc-modified-id="å¹¶è¡Œ-5.2"><span class="toc-item-num">5.2&nbsp;&nbsp;</span>å¹¶è¡Œ</a></span></li><li><span><a href="#å¤šçº¿ç¨‹" data-toc-modified-id="å¤šçº¿ç¨‹-5.3"><span class="toc-item-num">5.3&nbsp;&nbsp;</span>å¤šçº¿ç¨‹</a></span></li><li><span><a href="#æ€§èƒ½" data-toc-modified-id="æ€§èƒ½-5.4"><span class="toc-item-num">5.4&nbsp;&nbsp;</span>æ€§èƒ½</a></span></li><li><span><a href="#æ•´æ•°éšæœºåºåˆ—" data-toc-modified-id="æ•´æ•°éšæœºåºåˆ—-5.5"><span class="toc-item-num">5.5&nbsp;&nbsp;</span>æ•´æ•°éšæœºåºåˆ—</a></span></li><li><span><a href="#å‡åŒ€éšæœºåºåˆ—" data-toc-modified-id="å‡åŒ€éšæœºåºåˆ—-5.6"><span class="toc-item-num">5.6&nbsp;&nbsp;</span>å‡åŒ€éšæœºåºåˆ—</a></span></li><li><span><a href="#éšæœºé‡‡æ ·" data-toc-modified-id="éšæœºé‡‡æ ·-5.7"><span class="toc-item-num">5.7&nbsp;&nbsp;</span>éšæœºé‡‡æ ·</a></span></li></ul></li><li><span><a href="#éšæœºæ’åˆ—" data-toc-modified-id="éšæœºæ’åˆ—-6"><span class="toc-item-num">6&nbsp;&nbsp;</span>éšæœºæ’åˆ—</a></span></li><li><span><a href="#éšæœºåˆ†å¸ƒ" data-toc-modified-id="éšæœºåˆ†å¸ƒ-7"><span class="toc-item-num">7&nbsp;&nbsp;</span>éšæœºåˆ†å¸ƒ</a></span><ul class="toc-item"><li><span><a href="#é«˜æ–¯ç›¸å…³" data-toc-modified-id="é«˜æ–¯ç›¸å…³-7.1"><span class="toc-item-num">7.1&nbsp;&nbsp;</span>é«˜æ–¯ç›¸å…³</a></span></li><li><span><a href="#ç¦»æ•£åˆ†å¸ƒ" data-toc-modified-id="ç¦»æ•£åˆ†å¸ƒ-7.2"><span class="toc-item-num">7.2&nbsp;&nbsp;</span>ç¦»æ•£åˆ†å¸ƒ</a></span></li><li><span><a href="#æŒ‡å¯¹æ•°ç›¸å…³" data-toc-modified-id="æŒ‡å¯¹æ•°ç›¸å…³-7.3"><span class="toc-item-num">7.3&nbsp;&nbsp;</span>æŒ‡å¯¹æ•°ç›¸å…³</a></span></li><li><span><a href="#æ£€éªŒç›¸å…³" data-toc-modified-id="æ£€éªŒç›¸å…³-7.4"><span class="toc-item-num">7.4&nbsp;&nbsp;</span>æ£€éªŒç›¸å…³</a></span></li></ul></li><li><span><a href="#å°ç»“" data-toc-modified-id="å°ç»“-8"><span class="toc-item-num">8&nbsp;&nbsp;</span>å°ç»“</a></span></li><li><span><a href="#å‚è€ƒ" data-toc-modified-id="å‚è€ƒ-9"><span class="toc-item-num">9&nbsp;&nbsp;</span>å‚è€ƒ</a></span></li></ul></div>


```python
import numpy as np
np.__version__
```




    '1.22.3'



æ–‡æ¡£é˜…è¯»è¯´æ˜ï¼š

- ğŸ§ è¡¨ç¤º Tip
- âš ï¸ è¡¨ç¤ºæ³¨æ„äº‹é¡¹

æœ‰ä¸€éƒ¨åˆ†å¸¸ç”¨çš„åŸºç¡€APIåœ¨ã€Šä»å°ç™½åˆ°å…¥é—¨ã€‹ä¸­å·²ç»åšäº†ä»‹ç»ï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ã€‚

## åŸºæœ¬æŒ‡æ ‡

ä¸»è¦æ˜¯å‡å€¼ã€ä¸­ä½ã€æ–¹å·®å’Œæ ‡å‡†å·®â€”â€”æ”¯æŒéå€¼ï¼ˆNaNï¼‰çš„æƒ…å†µã€‚


```python
a = np.array([
    [1, 2, 3, 4],
    [5, np.nan, np.nan, 6],
    [7, 8, np.nan, 9]
])
a
```




    array([[ 1.,  2.,  3.,  4.],
           [ 5., nan, nan,  6.],
           [ 7.,  8., nan,  9.]])



å‡å€¼ï¼š


```python
np.average(a)
```




    nan




```python
np.nanmean(a)
```




    5.0




```python
np.mean(a, axis=0)
```




    array([4.33333333,        nan,        nan, 6.33333333])




```python
np.nanmean(a, axis=0), 13/3, 10/2, 3/1, 19/3
```




    (array([4.33333333, 5.        , 3.        , 6.33333333]),
     4.333333333333333,
     5.0,
     3.0,
     6.333333333333333)



ä¸­ä½ï¼š


```python
np.median(a)
```




    nan




```python
np.nanmedian(a)
```




    5.0



æ ‡å‡†å·®ï¼š


```python
np.nanstd(a)
```




    2.581988897471611




```python
np.nanvar(a, axis=1)
```




    array([1.25      , 0.25      , 0.66666667])



åˆ†ä½æ•°ï¼š


```python
a
```




    array([[ 1.,  2.,  3.,  4.],
           [ 5., nan, nan,  6.],
           [ 7.,  8., nan,  9.]])




```python
np.percentile(a, 25)
```




    nan




```python
# ç™¾åˆ†ä½
np.nanpercentile(a, 25)
```




    3.0




```python
# åˆ†ä½æ•°
np.nanquantile(a, 0.25)
```




    3.0




```python
a = np.arange(12).reshape(3, 4)
a
```




    array([[ 0,  1,  2,  3],
           [ 4,  5,  6,  7],
           [ 8,  9, 10, 11]])




```python
# æå€¼
np.ptp(a)
```




    11




```python
np.ptp(a, axis=0)
```




    array([8, 8, 8, 8])




```python
np.ptp(a, axis=1)
```




    array([3, 3, 3])



## ç›¸å…³æ€§

`correlate`è®¡ç®—ä¸¤ä¸ªä¸€ç»´æ•°ç»„çš„äº’ç›¸å…³æ€§ï¼Œå‚æ•°ï¼š

- æ•°ç»„ï¼šaï¼Œv
- modeï¼švalidã€sameæˆ–fullï¼Œé»˜è®¤validï¼Œä¸ch04çš„ã€Šå·ç§¯ã€‹ä¸­çš„modeå«ä¹‰ç›¸åŒã€‚


```python
a = np.array([1,2,3])
b = np.array([4,5,6])
```


```python
np.correlate(a, b), np.sum(a * np.conj(b))
```




    (array([32]), 32)




```python
np.correlate(a, b, "same")
```




    array([17, 32, 23])




```python
(
    np.sum(np.array([0,1,2])*np.array([4,5,6])),
    np.sum(np.array([1,2,3])*np.array([4,5,6])),
    np.sum(np.array([2,3,0])*np.array([4,5,6])),
)
```




    (17, 32, 23)




```python
np.correlate(a, b, "full")
```




    array([ 6, 17, 32, 23, 12])




```python
(
    np.sum(np.array([0,0,1])*np.array([4,5,6])),
    np.sum(np.array([0,1,2])*np.array([4,5,6])),
    np.sum(np.array([1,2,3])*np.array([4,5,6])),
    np.sum(np.array([2,3,0])*np.array([4,5,6])),
    np.sum(np.array([3,0,0])*np.array([4,5,6])),
)
```




    (6, 17, 32, 23, 12)



`corrcoef`æ˜¯çš®å°”é€Šç›¸å…³ç³»æ•°ï¼Œå‚æ•°ï¼š

- æ•°ç»„
- rowvarï¼šé»˜è®¤Trueã€‚ä¸ºTrueæ—¶ï¼Œæ¯ä¸€è¡Œè¡¨ç¤ºä¸€ä¸ªå˜é‡ï¼Œä¸ºFalseæ—¶ï¼Œæ¯ä¸€åˆ—è¡¨ç¤ºä¸€ä¸ªå˜é‡ã€‚

å…¬å¼ï¼š

$$
R_{ij} = \frac{ C_{ij} } { \sqrt{ C_{ii} * C_{jj} } }
$$


```python
a * b /np.sqrt((a*a) * (b*b))
```




    array([1., 1., 1.])




```python
np.corrcoef(a,b)
```




    array([[1., 1.],
           [1., 1.]])



`cov`æ˜¯åæ–¹å·®çŸ©é˜µï¼Œå‚æ•°åŒ…æ‹¬ï¼š

- æ•°ç»„
- rowvarï¼šå¸ƒå°”å€¼ï¼ŒåŒ`corrcoef`ã€‚
- biasï¼šå¸ƒå°”å€¼ï¼Œé»˜è®¤Falseï¼Œå½’ä¸€å€¼ä¸ºN-1ï¼ŒNä¸ºè§‚æµ‹æ•°é‡ï¼›ä¸ºTrueæ—¶ï¼Œå½’ä¸€å€¼ä¸ºNã€‚ä¼šè¢«ddofè¦†ç›–ã€‚
- ddofï¼š`int`ï¼Œå¯å–1æˆ–0ï¼Œä¸º1æ—¶è¡¨ç¤ºä½¿ç”¨N-1ï¼ˆä¸ç®¡åé¢ä¸¤ä¸ªweightsæ€ä¹ˆè®¾ç½®ï¼‰ï¼Œä¸º0æ—¶ä½¿ç”¨Nã€‚
- fweightsï¼šé¢‘ç‡æƒé‡ï¼Œè¡¨ç¤ºæ¯ä¸ªè§‚æµ‹å€¼é‡å¤çš„æ¬¡æ•°ã€‚
- aweightsï¼šè§‚æµ‹å‘é‡æƒé‡ï¼Œé‡è¦çš„ç›¸å¯¹æƒé‡è¾ƒå¤§ï¼Œä¸é‡è¦çš„è¾ƒå°ï¼Œå¦‚æœddof=0ï¼Œå¯ç”¨äºå°†æ¦‚ç‡åˆ†é…ç»™è§‚å¯Ÿå‘é‡ã€‚


å…¬å¼ï¼š
$$
\operatorname{cov}_{x, y}=\frac{\sum\left(x_{i}-\bar{x}\right)\left(y_{i}-\bar{y}\right)}{N-1}
$$

å…¶ä¸­uå’Œvåˆ†åˆ«æ˜¯Xå’ŒYçš„æœŸæœ›ã€‚

è¿”å›çš„çŸ©é˜µä¸­ï¼Œ`c[i][j]` æ˜¯`x[i]`å’Œ`x[j]`çš„åæ–¹å·®ï¼Œ`c[i][i]`åˆ™æ˜¯`x{i]`çš„æ–¹å·®ã€‚


```python
np.cov(a,b)
```




    array([[1., 1.],
           [1., 1.]])




```python
np.sum((a-np.average(a)) * (b-np.average(b)))/2
```




    1.0




```python
x = np.array([[0, 2], [1, 1], [2, 0]]).T
x
```




    array([[0, 1, 2],
           [2, 1, 0]])




```python
# é»˜è®¤æ¯ä¸€è¡Œæ˜¯ä¸€ä¸ªå˜é‡
# å¯¹è§’çº¿æ˜¯æ–¹å·®ï¼Œåå¯¹è§’çº¿æ˜¯åæ–¹å·®
np.cov(x)
```




    array([[ 1., -1.],
           [-1.,  1.]])




```python
# [0-1, 1-1, 2-1] * [2-1, 1-1, 0-1] = -1 + 0 + -1 = -2 
# -2 / (3-1) = -1
```


```python
# å†æ¥ä¸€ä¸ªä¾‹å­
x = np.array([-2.1, -1,  4.3])
y = np.array([3,  1.1,  0.12])
X = np.stack((x, y), axis=0)
X
```




    array([[-2.1 , -1.  ,  4.3 ],
           [ 3.  ,  1.1 ,  0.12]])




```python
np.cov(X), np.cov(x, y)
```




    (array([[11.71      , -4.286     ],
            [-4.286     ,  2.14413333]]),
     array([[11.71      , -4.286     ],
            [-4.286     ,  2.14413333]]))




```python
np.cov(x), np.cov(y)
```




    (array(11.71), array(2.14413333))




```python
np.sum((x - np.average(x)) * (y - np.average(y))) / (3-1)
```




    -4.2860000000000005



## æŸ±çŠ¶å›¾

æŸ±çŠ¶å›¾å…¶å®æ˜¯å¯¹ä¸åŒæ•°æ®åˆ†å¸ƒçš„ä¸€ç§æè¿°ã€‚


```python
from collections import Counter
```


```python
rng = np.random.default_rng(42)
a = rng.integers(0, 5, (3, 4))
a
```




    array([[0, 3, 3, 2],
           [2, 4, 0, 3],
           [1, 0, 2, 4]])



`histogram`æ¥å—å‡ ä¸ªå‚æ•°ï¼š

- æ•°ç»„ï¼Œä¼šæ‰“å¹³
- binsï¼šé»˜è®¤10ï¼Œä¸€ä¸ª`int`æˆ–ä¸€ç»„`int`æˆ–`str`ï¼Œä¸€ä¸ªè¡¨ç¤ºç­‰è·ï¼Œä¸€ç»„è¡¨ç¤ºå•è°ƒé€’å¢çš„è¾¹ç¼˜æ•°ç»„ï¼ŒåŒ…æ‹¬æœ€å³è¾¹çš„è¾¹ç¼˜ï¼Œå…è®¸ä¸å‡åŒ€çš„binå®½åº¦ã€‚`str`æ—¶å‚è§ä¸‹é¢çš„`histogram_bin_edges`æ¥å£ã€‚
- rangeï¼šä¸€ä¸ªTupleçš„æµ®ç‚¹æ•°ï¼Œbinçš„ä¸Šä¸‹ç•Œï¼Œä¸æä¾›æ—¶é»˜è®¤ä¸º`(a.min(), a.max())`ï¼Œè¶…å‡ºçš„ä¼šè¢«å¿½ç•¥ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ å¿…é¡»å°äºç¬¬äºŒä¸ªã€‚
- weightsï¼šä¸aåŒæ ·shapeçš„ä¸€ç»„æ•°ï¼Œå¦‚æœ`density=True`ï¼Œä¼šè¢«å½’ä¸€åŒ–ã€‚
- densityï¼šå¸ƒå°”å€¼ï¼ŒFalseæ—¶ç»“æœåŒ…å«æ¯ä¸ªbinçš„æ ·æœ¬æ•°ï¼ŒTrueæ—¶ç»“æœä¸ºæ¦‚ç‡å¯†åº¦å‡½æ•°ã€‚

è¿”å›histå’Œbinè¾¹ç•Œã€‚æ³¨æ„ï¼Œé™¤äº†æœ€åä¸€ç»„è¾¹ç•Œï¼Œå…¶ä»–çš„éƒ½æ˜¯ã€Œå·¦é—­å³å¼€ã€ã€‚


```python
sa = sorted(Counter(a.flatten()).items())
sa
```




    [(0, 3), (1, 1), (2, 3), (3, 3), (4, 2)]




```python
# æ³¨æ„ï¼š3ä¸ªæ•°å…¶å®æ˜¯2ä¸ªåŒºé—´
np.histogram(a, bins=[0, 3, 5]), np.sum([v[1] for v in sa if v[0] < 3]), np.sum([v[1] for v in sa if v[0] >= 3])
```




    ((array([7, 5]), array([0, 3, 5])), 7, 5)




```python
total = a.shape[0] * a.shape[1]
sa = [(v[0], v[1]/total) for v in sorted(Counter(a.flatten()).items())]
sa
```




    [(0, 0.25),
     (1, 0.08333333333333333),
     (2, 0.25),
     (3, 0.25),
     (4, 0.16666666666666666)]




```python
(
    np.histogram(a, bins=[0, 3, 5], density=True), 
    np.sum([v[1] for v in sa if v[0] < 3])/3, np.sum([v[1] for v in sa if v[0] >= 3])/2
)
```




    ((array([0.19444444, 0.20833333]), array([0, 3, 5])),
     0.19444444444444442,
     0.20833333333333331)




```python
# å¸¦æƒé‡çš„
np.histogram(a, bins=[0, 3, 5], weights=a,  density=True)
```




    (array([0.09722222, 0.35416667]), array([0, 3, 5]))




```python
a.flatten()
```




    array([0, 3, 3, 2, 2, 4, 0, 3, 1, 0, 2, 4])




```python
# 0ä¸ª0ï¼Œ3ä¸ª3 â€¦â€¦ 4ä¸ª4
b = [3, 3, 3, 3, 3, 3, 2, 2, 2, 2, 4, 4, 4, 4, 3, 3, 3, 1, 2, 2, 4, 4, 4, 4]
```


```python
np.histogram(b, bins=[0,3,5], density=True)
```




    (array([0.09722222, 0.35416667]), array([0, 3, 5]))



`histogram2d`æ˜¯ä¸Šä¸ªæ¥å£çš„äºŒç»´ç‰ˆæœ¬ï¼Œå¤„ç†ä¸¤ç»„æ•°ç»„ï¼ˆä¸€ç»´çš„ï¼‰ã€‚

- x,yï¼šxå’Œyä¸€ç»´æ•°ç»„
- binsï¼šå«ä¹‰åŒä¸Šï¼Œä½†æƒ…å†µæ›´å¤šï¼ˆä¸è¿‡ä¸æ”¯æŒstringï¼‰ï¼Œæ”¯æŒï¼š
  - xå’Œyå…±äº«ï¼š`int`, `array`
  - xå’Œyåˆ†åˆ«ï¼š`[int,int]`, `[array, array]`
  - `int`è¡¨ç¤ºbinçš„æ•°é‡ï¼Œ`array`è¡¨ç¤ºåˆ†ç»„è¾¹ç•Œï¼š`[int, array]`, `[array, int]`
- rangeï¼šåŒä¸Š
- densityï¼šåŒä¸Šï¼Œé»˜è®¤Falseï¼Œè¿”å›æ¯ä¸ªbinçš„æ ·æœ¬æ•°ï¼Œä¸ºTrueè¿”å›binçš„æ¦‚ç‡å¯†åº¦
- weightsï¼šåŒä¸Š

å¦‚æœxå’Œyå®Œå…¨æ— äº¤é›†ï¼Œå…¶å®å’Œåˆ†åˆ«ç®—æ˜¯ä¸€æ ·çš„ï¼Œä½†ä¸¤è€…æœ‰äº¤é›†æ˜¯ä¼šåœ¨äºŒç»´å¹³é¢ä¸Šç»Ÿè®¡ã€‚


```python
a
```




    array([[0, 3, 3, 2],
           [2, 4, 0, 3],
           [1, 0, 2, 4]])




```python
rng = np.random.default_rng(42)
c = rng.integers(5, 10, (3, 4))
c
```




    array([[5, 8, 8, 7],
           [7, 9, 5, 8],
           [6, 5, 7, 9]])




```python
rng = np.random.default_rng(42)
d = rng.integers(0, 5, (3, 4))
d
```




    array([[0, 3, 3, 2],
           [2, 4, 0, 3],
           [1, 0, 2, 4]])




```python
Hac,xe,ye =np.histogram2d(a.flatten(), c.flatten(), bins=[[0,3,5],[5,9,10]])
Hac
```




    array([[7., 0.],
           [3., 2.]])




```python
(a.flatten() < 3).sum(), (a.flatten() >=3).sum(), 7+0, 3+2
```




    (7, 5, 7, 5)




```python
(c.flatten()<9).sum(), (c.flatten()>=9).sum(), 7+3, 0+2
```




    (10, 2, 10, 2)




```python
Had, xe,ye = np.histogram2d(a.flatten(), d.flatten(), bins=[[0,3,4], [0,2,4]])
Had
```




    array([[4., 3.],
           [0., 5.]])




```python
(a.flatten() < 3).sum(), (a.flatten() >=3).sum(), 4+3, 0+5
```




    (7, 5, 7, 5)




```python
(d.flatten()<2).sum(), (d.flatten()>=2).sum(), 4+0,3+5
```




    (4, 8, 4, 8)




```python
import matplotlib.pyplot as plt
fig = plt.figure(figsize=(7, 3))
ax = fig.add_subplot(131, title='imshow: square bins')
plt.imshow(Had, interpolation='nearest', origin='lower', extent=[xe[0], xe[-1], ye[0], ye[-1]])
```




    <matplotlib.image.AxesImage at 0x1137c5af0>




    
![png](ch05-probability_statistics_files/ch05-probability_statistics_70_1.png)
    


`histogramdd`æ˜¯å¤šç»´ç‰ˆæœ¬ï¼Œé™¤äº†è¾“å…¥çš„æ•°ç»„å¤–ï¼Œå…¶ä»–å‚æ•°ä¸å‰é¢çš„åŸºæœ¬ä¸€è‡´ã€‚


```python
rng = np.random.default_rng(42)
a = rng.integers(0, 10, (100, 3))
```


```python
H, edges = np.histogramdd(a, bins=[5, 3, 4])
```


```python
H.shape
```




    (5, 3, 4)




```python
edges
```




    [array([0. , 1.8, 3.6, 5.4, 7.2, 9. ]),
     array([0., 3., 6., 9.]),
     array([0.  , 2.25, 4.5 , 6.75, 9.  ])]



`histogram_bin_edges`ç”¨æ¥è®¡ç®—binçš„è¾¹ç•Œï¼Œåªç®—è¾¹ç•Œã€‚

ä¸è¿‡è¿™é‡Œçš„binå‚æ•°æ”¯æŒstringï¼Œè¿™é‡Œå®šä¹‰äº†å¾ˆå¤šæ–¹æ³•ï¼š

- autoï¼šæŠ˜ä¸­çš„æ–¹æ³•è·å¾—ä¸é”™çš„æ•ˆæœï¼Œå°æ•°æ®é›†ä¸€èˆ¬ä¼šé‡‡ç”¨
- fdï¼šFreedam Diaconis Estimatorï¼Œå¤§æ•°æ®é›†ä¸€èˆ¬ä¼šé‡‡ç”¨

$$
2 \frac {IQR} {\sqrt[3] {n}}
$$

- scottï¼šä¸æ ‡å‡†å·®æˆæ­£æ¯”ï¼Œä¸æ•°æ®é›†sizeçš„ç«‹æ–¹æ ¹æˆåæ¯”ï¼Œå¯¹å°æ•°æ®é›†è¿‡äºä¿å®ˆï¼Œä½†æ˜¯å’Œå¤§æ•°æ®é›†ã€‚æ ‡å‡†å·®å¯¹å¼‚å¸¸å€¼ä¸æ˜¯å¾ˆé²æ£’ã€‚åœ¨æ²¡æœ‰å¼‚å¸¸å€¼æ—¶ï¼Œå®ƒçš„å€¼å’ŒFDå¾ˆç›¸ä¼¼ã€‚

$$
h = \sigma \sqrt[3]{\frac{24 * \sqrt{\pi}}{n}}
$$

- riceï¼šbinçš„æ•°é‡ä¸æ•°æ®é›†sizeçš„ç«‹æ–¹æ ¹æˆåæ¯”ï¼Œå®ƒå€¾å‘äºé«˜ä¼°æ¡æŸ±çš„æ•°é‡ï¼Œå¹¶ä¸”æ²¡æœ‰è€ƒè™‘æ•°æ®å¯å˜æ€§ã€‚

$$
n_h = 2 n^{1/3}
$$

- sturgesï¼šæ•°æ®é›†sizeçš„2ä¸ºåº•å¯¹æ•°ï¼Œæ­¤ä¼°è®¡å™¨å‡å®šæ•°æ®æ˜¯æ­£æ€çš„ï¼Œå¯¹äºè¾ƒå¤§çš„éæ­£æ€æ•°æ®é›†è¿‡äºä¿å®ˆã€‚Rè¯­è¨€çš„`hist`çš„é»˜è®¤æ–¹æ³•ã€‚

$$
n_h = \log_{2}{n} +1
$$

- doaneï¼šSturgesçš„æ”¹è¿›ç‰ˆæœ¬ï¼Œå¯ä¸ºéæ­£æ€æ•°æ®é›†ç”Ÿæˆæ›´å¥½çš„ä¼°è®¡å€¼ã€‚æ­¤ä¼°è®¡å™¨å°è¯•è§£é‡Šæ•°æ®çš„åæ–œã€‚

$$
n_h = 1 + \log_{2}(n) + \log_{2} (1 + \frac {|g_1|} {\sigma_{g_1}}) \\
g_1 = mean[(\frac{x - \mu}{\sigma})^3]\\
\sigma_{g_1} = \sqrt{\frac{6(n - 2)}{(n + 1)(n + 3)}}
$$

- sqrtï¼šæœ€ç®€å•å’Œå¿«é€Ÿçš„ä¼°è®¡å™¨ï¼Œåªè€ƒè™‘æ•°æ®é›†å¤§å°ã€‚

$$
n_h = \sqrt n
$$


```python
# éšæœºæ•°æœ¬æ¥å°±æ˜¯0-9
np.histogram_bin_edges(a, bins=3)
```




    array([0., 3., 6., 9.])




```python
rng = np.random.default_rng(42)
a = rng.integers(0, 10, 500)
```


```python
np.histogram_bin_edges(a, bins="auto")
```




    array([0. , 0.9, 1.8, 2.7, 3.6, 4.5, 5.4, 6.3, 7.2, 8.1, 9. ])



`fd`ï¼š


```python
IQR = np.percentile(a, 75) - np.percentile(a, 25)
```


```python
2 * IQR / (a.size ** (1/3))
```




    1.2599210498948732




```python
np.histogram_bin_edges(a, bins="fd")
```




    array([0.   , 1.125, 2.25 , 3.375, 4.5  , 5.625, 6.75 , 7.875, 9.   ])



`scott`:


```python
np.histogram_bin_edges(a, bins="scott")
```




    array([0.   , 1.125, 2.25 , 3.375, 4.5  , 5.625, 6.75 , 7.875, 9.   ])




```python
(24*np.sqrt(np.pi)/a.size)**(1/3)* np.std(a)
```




    1.2524886807479167



`rice`:


```python
# 16ä¸ªåŒºé—´ï¼ˆæŸ±å­ï¼‰
np.histogram_bin_edges(a, bins="rice").shape
```




    (17,)




```python
2 * (a.size**(1/3))
```




    15.874010519681994



`sturges`:


```python
np.histogram_bin_edges(a, bins="sturges")
```




    array([0. , 0.9, 1.8, 2.7, 3.6, 4.5, 5.4, 6.3, 7.2, 8.1, 9. ])




```python
np.histogram_bin_edges(a, bins="sturges").shape
```




    (11,)




```python
np.log2(a.size) + 1
```




    9.965784284662087



`doane`ï¼š


```python
np.histogram_bin_edges(a, bins="doane").shape
```




    (11,)




```python
(1+
 np.log2(a.size)+
 np.log2(1+abs(np.mean(((a - np.mean(a))/np.std(a))**3)) / np.sqrt(6*(a.size-2)/((a.size+1)*(a.size+3)))))
```




    9.970039609658638



`sqrt`:


```python
np.histogram_bin_edges(a, bins="sqrt").size
```




    24




```python
np.sqrt(a.size)
```




    22.360679774997898



`auto`ï¼šä¼šé€‰æ‹©`fd`å’Œ`sturges`çš„è¾ƒå¤§è€…ã€‚


```python
np.histogram_bin_edges(a, bins="fd").size, np.histogram_bin_edges(a, bins="sturges").size
```




    (9, 11)




```python
np.histogram_bin_edges(a, "auto").size
```




    11



`digitize`ä¼šå‘Šè¯‰æˆ‘ä»¬è¾“å…¥çš„æ•°ç»„éƒ½å±äºå“ªä¸ªbinã€‚


```python
x = np.array([0.2, 6.4, 3.0, 1.6])
bins = np.array([0.0, 1.0, 2.5, 4.0, 10.0])
inds = np.digitize(x, bins)
```


```python
# 0.0 <= 0.2 < 1.0
# 4.0 <= 6.4 < 10.0
# 2.5 <= 3.0 < 4.0
# 1.0 <= 1.6 < 2.5
inds
```




    array([1, 4, 3, 2])



## è®¡æ•°

`bincount`ç”¨æ¥ç»Ÿè®¡éè´Ÿæ•°ç»„ä¸­æ¯ä¸ªå€¼çš„å‡ºç°æ¬¡æ•°ã€‚å®ƒä¹Ÿå’ŒæŸ±çŠ¶å›¾æœ‰å…³ã€‚


```python
rng = np.random.default_rng(42)
a = rng.integers(0, 10, 100)
```


```python
sorted(Counter(a).items())
```




    [(0, 9),
     (1, 9),
     (2, 6),
     (3, 9),
     (4, 15),
     (5, 7),
     (6, 11),
     (7, 15),
     (8, 12),
     (9, 7)]




```python
np.bincount(a)
```




    array([ 9,  9,  6,  9, 15,  7, 11, 15, 12,  7])




```python
b = np.array([1, 1, 1, -1, -1, -1])
```


```python
# å¿…é¡»éè´Ÿ
np.bincount(b)
```


    ---------------------------------------------------------------------------

    ValueError                                Traceback (most recent call last)

    <ipython-input-765-54605025760c> in <module>
          1 # å¿…é¡»éè´Ÿ
    ----> 2 np.bincount(b)
    

    /usr/local/lib/python3.8/site-packages/numpy/core/overrides.py in bincount(*args, **kwargs)
    

    ValueError: 'list' argument must have no negative elements



```python
# å¿…é¡»ä¸€ç»´
np.bincount(np.array([[1],[2]]))
```


    ---------------------------------------------------------------------------

    ValueError                                Traceback (most recent call last)

    <ipython-input-758-f01c373d0299> in <module>
          1 # å¿…é¡»ä¸€ç»´
    ----> 2 np.bincount(np.array([[1],[2]]))
    

    /usr/local/lib/python3.8/site-packages/numpy/core/overrides.py in bincount(*args, **kwargs)
    

    ValueError: object too deep for desired array


å¦å¤–ï¼Œå®ƒè¿˜å¯ä»¥æŒ‡å®šæƒé‡ï¼š

`out[n] = out[n] + weight[i]`

é»˜è®¤æƒ…å†µä¸‹æ˜¯ï¼š

`out[n] = out[n] + 1`

æ³¨æ„ï¼šç»™å®šæ•°ç»„æ˜¯ä½ç½®ï¼Œæƒé‡å’Œè¿™äº›ä½ç½®å¯¹åº”ã€‚


```python
c = np.array([2,3,4,2,3,4])
```


```python
# åœ¨ç¬¬2 3 4 ä¸ªä½ç½®ä¸Š+1
# åœ¨ç¬¬2 3 4 ä¸ªä½ç½®ä¸Š+1
np.bincount(c)
```




    array([0, 0, 2, 2, 2])




```python
# åœ¨ç¬¬2 3 4 ä¸ªä½ç½®ä¸Š+2 3 4
# åœ¨ç¬¬2 3 4 ä¸ªä½ç½®ä¸Š+2 3 4
np.bincount(c, weights=[2,3,4,2,3,4])
```




    array([0., 0., 4., 6., 8.])




```python
# loc 0  0.3
# loc 1  0.5+0.2
# loc 2  0.7+1.0-0.6
w = np.array([0.3, 0.5, 0.2, 0.7, 1., -0.6])
x = np.array([0, 1, 1, 2, 2, 2])
np.bincount(x,  weights=w)
```




    array([0.3, 0.7, 1.1])



ä¹Ÿå¯ä»¥æŒ‡å®šè¿”å›çš„binæ•°é‡ï¼š


```python
np.bincount(a)
```




    array([ 9,  9,  6,  9, 15,  7, 11, 15, 12,  7])




```python
# å¤šå‡º2ä¸ªæ•°å­—
np.bincount(a, minlength=12)
```




    array([ 9,  9,  6,  9, 15,  7, 11, 15, 12,  7,  0,  0])



`count_nonzero`ç”¨æ¥ç»Ÿè®¡éé›¶çš„æ•°é‡ã€‚


```python
# ç»Ÿè®¡é0
np.count_nonzero(np.eye(4))
```




    4




```python
np.count_nonzero(a)
```




    453




```python
(a>0).sum()
```




    453



## éšæœºç”Ÿæˆå™¨

åœ¨è®¡ç®—æœºä¸Šçš„éšæœºæ•°éƒ½æ˜¯ä¼ªéšæœºæ•°ã€‚ä¼ªéšæœºæ˜¯ä¸€ä¸ªç”¨ç¡®å®šæ€§çš„ç®—æ³•ç”Ÿæˆçš„çœ‹èµ·æ¥éšæœºä½†å®é™…ä¸æ˜¯éšæœºçš„è¿‡ç¨‹ã€‚å¦‚æœå¼€å§‹å€¼ä¸å˜ï¼Œéšæœºæ•°çš„é¡ºåºä¹Ÿä¸ä¼šå˜ã€‚ä¼˜ç‚¹æ˜¯è®¡ç®—ç®€å•ï¼Œè€Œä¸”ç”¨å°‘é‡æ•°å€¼å¾ˆéš¾æ¨ç®—å‡ºå®ƒçš„ç®—æ³•ã€‚ä¸€èˆ¬ä¼šä½¿ç”¨ä¸€ä¸ªå‡çš„éšæœºæ•°ï¼Œæ¯”å¦‚ç”µè„‘ä¸Šçš„æ—¶é—´ä½œä¸ºè®¡ç®—ä¼ªéšæœºæ•°çš„å¼€å§‹å€¼ã€‚æœ‰æ—¶å€™æˆ‘ä»¬å¯èƒ½éœ€è¦çœŸæ­£çš„éšæœºï¼ˆæ¯”å¦‚åˆ›å»ºåŠ å¯†é’±åŒ…æ—¶ï¼‰ï¼Œè¿™æ—¶å€™ä¸€èˆ¬ä¼šè¢«è¦æ±‚éšä¾¿ç§»åŠ¨ä¸€ä¸‹é¼ æ ‡ï¼Œæ­¤æ—¶é¼ æ ‡åœæ­¢æ—¶çš„ä½ç½®ä¼šè¢«å½“åšã€Œéšæœºã€å¼€å§‹å€¼ã€‚

æˆ‘ä»¬å…ˆçœ‹ä¸‹ä»€ä¹ˆæ˜¯é¡ºåºä¸å˜ï¼š


```python
rng = np.random.default_rng(42)
rng.integers(1, 10, 2)
```




    array([1, 7])




```python
rng = np.random.default_rng(42)
rng.integers(1, 10, 5)
```




    array([1, 7, 6, 4, 4])




```python
rng = np.random.default_rng(42)
rng.integers(1, 10, 8)
```




    array([1, 7, 6, 4, 4, 8, 1, 7])



å½“æˆ‘ä»¬æŒ‡å®šéšæœºç§å­åï¼Œç”±æ­¤ç§å­ç”Ÿæˆçš„éšæœºæ•°åˆ—å°±ä¸ä¼šå‘ç”Ÿå˜åŒ–äº†ã€‚

å¸¸ç”¨çš„ä¼ªéšæœºæ•°ç”Ÿæˆç®—æ³•åŒ…æ‹¬ï¼šçº¿æ€§åŒä½™æ³•ã€å¹³æ–¹å–ä¸­æ³•ã€M-åºåˆ—ã€è¿›ä½ä¹˜æ•°æ³•ã€æ¢…æ£®æ—‹è½¬ç®—æ³•ã€ä¼ªä¹±æ•°äºŒè¿›åˆ¶æ•°åˆ—ç­‰ã€‚æˆ‘ä»¬ç®€å•ä»‹ç»ä¸€ä¸‹çº¿æ€§åŒä½™æ³•ï¼Œå®ƒæ˜¯C/C++çš„å†…ç½®ä¼ªéšæœºæ•°ç”Ÿæˆç®—æ³•ã€‚

$$
X_{n+1} = (aX_n + c)(\mod m)\\
m > 0, 0<a<m, 0<=x_0<=m
$$

mæ˜¯æ¨¡æ•°ï¼Œaæ˜¯ä¹˜æ³•å› å­ï¼Œcæ˜¯å¢é‡ï¼Œx0æ˜¯åˆå§‹å€¼ï¼ˆç§å­ï¼‰ã€‚

m a cä¸€èˆ¬ä¸ç”¨è‡ªå·±æƒ³ï¼Œå·²ç»æœ‰å¤§é‡ç ”ç©¶æ‰¾åˆ°äº†å„ç§æœ€ä¼˜å€¼ã€‚è¯¦è§ï¼š[ç»´åŸºç™¾ç§‘](https://en.wikipedia.org/wiki/Linear_congruential_generator)ã€‚æ¯”å¦‚æˆ‘ä»¬é‡‡ç”¨å…¶ä¸­ä¸€ç»„ï¼šm=2^16+1 a=75 c=74ã€‚


```python
def lcg(n=1, seed=42):
    for i in range(n):
        seed =  (75*seed + 74) % (2**16 + 1)
        yield seed
```


```python
list(lcg(5))
```




    [3224, 45263, 52412, 64291, 37698]



è¦è·å–å°æ•°ï¼Œå¯ä»¥ä½¿ç”¨è·å–çš„æ•´æ•°é™¤ä»¥äº§ç”Ÿçš„æœ€å¤§å€¼ï¼Œå°±å°†éšæœºæ•°æ˜ å°„åˆ°0-1åŒºé—´äº†ã€‚

NumPyç›®å‰æœ€æ–°çš„ç‰ˆæœ¬é‡‡ç”¨PCG-64ï¼ˆç½®æ¢åŒä½™ç”Ÿæˆå™¨ï¼‰ä¼ªéšæœºæ•°ç”Ÿæˆç®—æ³•ã€‚æ¨èä½¿ç”¨`Generator`æ˜¯éšæœºæ•°ç”Ÿæˆå™¨æ¨èçš„æ„é€ å‡½æ•°ï¼Œè€Œä¸æ˜¯ä½¿ç”¨`RandomState`ã€‚


æ³¨æ„ï¼šæ–°çš„ç‰ˆæœ¬æ¨èä½¿ç”¨å…ˆç”Ÿæˆ`Generator`ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œé‡‡æ ·ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»¬ä¸€ç›´ä»¥æ¥ä½¿ç”¨çš„æ–¹å¼ã€‚

ä¸è¿‡ï¼Œæœ‰æ—¶å€™ä¸€äº›è€ä»£ç è¿˜æ˜¯åœ¨ä½¿ç”¨æ—§çš„æ–¹å¼ï¼Œå…³äºæ—§çš„æ¥å£ï¼Œå¯ä»¥å‚é˜…ï¼š

- [Legacy Random Generation â€” NumPy v1.24.dev0 Manual](https://numpy.org/devdocs/reference/random/legacy.html)
- [Whatâ€™s New or Different â€” NumPy v1.24.dev0 Manual](https://numpy.org/devdocs/reference/random/new-or-different.html)

### Generator

NumPyçš„éšæœºæ•°ç”Ÿæˆä½¿ç”¨ä¸€ä¸ª`BitGenerator`ç”Ÿæˆåºåˆ—ï¼Œç„¶åä½¿ç”¨ä¸€ä¸ª`Generator`å°†éšæœºåºåˆ—è½¬æ¢ä¸ºç‰¹å®šçš„æ¦‚ç‡åˆ†å¸ƒã€‚

`Generator`ç”Ÿæˆçš„éšæœºå€¼æºè‡ª`BitGenerator`ã€‚ä½†`BitGenerators`ä¸ç›´æ¥æä¾›éšæœºæ•°ï¼Œä»…åŒ…å«ç”¨äºseedã€è·å–æˆ–è®¾ç½®çŠ¶æ€ã€è·³è½¬æˆ–æ¨è¿›çŠ¶æ€ä»¥åŠè®¿é—®ä½çº§åŒ…è£…å™¨ä»¥ä¾›å¯ä»¥æœ‰æ•ˆè®¿é—®æ‰€æä¾›åŠŸèƒ½çš„ä»£ç ä½¿ç”¨çš„æ–¹æ³•ã€‚


æ”¯æŒçš„BitGeneratorï¼š

- PCG64
- PCG64DXSM
- MT19937
- Philox
- SFC64

ä»¥ä¸‹ä»¥PCG64ä¸ºä¾‹è¯´æ˜ã€‚


```python
# æŒ‡å®šç§å­
bg = np.random.PCG64(seed=42)
```


```python
# ä½¿ç”¨æ“ä½œç³»ç»Ÿçš„ç†µä½œä¸ºç§å­
ss = np.random.SeedSequence()
ss
```




    SeedSequence(
        entropy=125958451863476122535671492956036760397,
    )




```python
bgr = np.random.PCG64(ss.entropy)
```

æ“ä½œç³»ç»Ÿæ”¶é›†çš„ç†µä½¿ç”¨128ä½æ•´æ•°ï¼Œæ˜¯é»˜è®¤çš„ç§å­ã€‚ä¸€èˆ¬ä¸å»ºè®®å°†32ä½ä»¥ä¸‹çš„å°ç§å­ç”¨äºä¸€èˆ¬ç”¨é€”ï¼Œå°ç§å­å®ä¾‹åŒ–å¤§çŠ¶æ€ç©ºé—´æ„å‘³ç€æœ‰äº›åˆå§‹çŠ¶æ€æ˜¯ä¸å¯è¾¾çš„ã€‚

ä½¿ç”¨Generatorï¼š


```python
pcg = np.random.PCG64()
pcg
```




    <numpy.random._pcg64.PCG64 at 0x117298720>




```python
rng = np.random.Generator(pcg)
rng
```




    Generator(PCG64) at 0x1172B33C0




```python
rng.standard_normal()
```




    -1.5260230207039922




```python
rng.bit_generator is pcg
```




    True



### å¹¶è¡Œ

NumPyå®ç°äº†ä¸‰ç§ç­–ç•¥ï¼Œå¯ç”¨äºè·¨å¤šä¸ªè¿›ç¨‹ï¼ˆæœ¬åœ°æˆ–åˆ†å¸ƒå¼ï¼‰ç”Ÿæˆå¯é‡å¤çš„ä¼ªéšæœºæ•°ã€‚

é¦–å…ˆæ˜¯SeedSequence spawningï¼ŒSeedSequenceå®ç°äº†ä¸€ç§ç®—æ³•æ¥å¤„ç†ç”¨æˆ·æä¾›çš„ç§å­ï¼Œé€šå¸¸ä½œä¸ºæŸç§å¤§å°çš„æ•´æ•°ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºBitGeneratorçš„åˆå§‹çŠ¶æ€ã€‚å®ƒä½¿ç”¨æ•£åˆ—æŠ€æœ¯æ¥ç¡®ä¿å°†ä½è´¨é‡çš„ç§å­å˜æˆé«˜è´¨é‡çš„åˆå§‹çŠ¶æ€ï¼ˆè‡³å°‘ï¼Œä»¥éå¸¸é«˜çš„æ¦‚ç‡ï¼‰ã€‚


```python
ss = np.random.SeedSequence(42)
```


```python
child_seeds = ss.spawn(10)
```


```python
bgs = [np.random.PCG64(s) for s in child_seeds]
bgs
```




    [<numpy.random._pcg64.PCG64 at 0x1199777d0>,
     <numpy.random._pcg64.PCG64 at 0x1173d9bf0>,
     <numpy.random._pcg64.PCG64 at 0x1173d9f60>,
     <numpy.random._pcg64.PCG64 at 0x1173d9040>,
     <numpy.random._pcg64.PCG64 at 0x119b7cf60>,
     <numpy.random._pcg64.PCG64 at 0x119b7c930>,
     <numpy.random._pcg64.PCG64 at 0x119b7cb40>,
     <numpy.random._pcg64.PCG64 at 0x119b7cbf0>,
     <numpy.random._pcg64.PCG64 at 0x119b7ce00>,
     <numpy.random._pcg64.PCG64 at 0x119b7ceb0>]




```python
streams = [np.random.Generator(bg) for bg in bgs]
```


```python
streams
```




    [Generator(PCG64) at 0x119BC69E0,
     Generator(PCG64) at 0x119BC6AC0,
     Generator(PCG64) at 0x119BC6BA0,
     Generator(PCG64) at 0x119BC6C80,
     Generator(PCG64) at 0x119BC6D60,
     Generator(PCG64) at 0x119BC6E40,
     Generator(PCG64) at 0x119BC6F20,
     Generator(PCG64) at 0x119B4E040,
     Generator(PCG64) at 0x119B4E120,
     Generator(PCG64) at 0x119B4E200]



å­SeedSequenceè¿˜å¯ä»¥ç»§ç»­ç”Ÿæˆå­™å­å¯¹è±¡ï¼š


```python
# default_rng = Generator(BitGenerator)
grandchildren_seeds = child_seeds[0].spawn(4)
grand_streams = [
    np.random.default_rng(s) for s in grandchildren_seeds]
```


```python
grand_streams
```




    [Generator(PCG64) at 0x117376F20,
     Generator(PCG64) at 0x1173BAC80,
     Generator(PCG64) at 0x1173BA580,
     Generator(PCG64) at 0x1173BA900]



ç„¶åæ˜¯`Philox`ï¼Œä¸€ç§åŸºäºè®¡æ•°å™¨çš„RNGï¼ˆRandom Number Generatorï¼‰ï¼Œå®ƒé€šè¿‡ä½¿ç”¨å¼±å¯†ç åŸè¯­åŠ å¯†é€’å¢è®¡æ•°å™¨æ¥ç”Ÿæˆå€¼ã€‚

ç§å­ç¡®å®šç”¨äºåŠ å¯†çš„å¯†é’¥ï¼Œå”¯ä¸€é”®åˆ›å»ºå”¯ä¸€ã€ç‹¬ç«‹çš„æµã€‚`Philox`å¯ä»¥ç»•è¿‡ç§å­ç›´æ¥è®¾ç½®128ä½å¯†é’¥ã€‚ç±»ä¼¼ä½†ä¸åŒçš„å¯†é’¥ä»å°†åˆ›å»ºç‹¬ç«‹çš„æµã€‚

æ³¨æ„ï¼Œ`Philox`çš„keyå’Œseedæ˜¯ä¸¤ä¸ªä¸åŒçš„ä¸œè¥¿ã€‚


```python
import secrets
```


```python
root_seed = secrets.randbits(128)
```


```python
bgs = [
    np.random.Philox(key=root_seed + stream_id) 
    for stream_id in range(10)
]
```


```python
bgs
```




    [<numpy.random._philox.Philox at 0x1173e4040>,
     <numpy.random._philox.Philox at 0x1173e4130>,
     <numpy.random._philox.Philox at 0x1173e4220>,
     <numpy.random._philox.Philox at 0x1173e4310>,
     <numpy.random._philox.Philox at 0x1173e4400>,
     <numpy.random._philox.Philox at 0x1173e44f0>,
     <numpy.random._philox.Philox at 0x1173e45e0>,
     <numpy.random._philox.Philox at 0x1173e46d0>,
     <numpy.random._philox.Philox at 0x1173e47c0>,
     <numpy.random._philox.Philox at 0x1173e48b0>]



æœ€åä¸€ç§æ˜¯ä½¿ç”¨jumpï¼Œjumpæ¨è¿›`BitGenerator`çš„çŠ¶æ€ï¼Œå¥½åƒæŠ½å–äº†å¤§é‡éšæœºæ•°ä¸€æ ·ï¼Œå¹¶è¿”å›å…·æœ‰æ­¤çŠ¶æ€çš„æ–°å®ä¾‹ã€‚


|BitGenerator|å‘¨æœŸ|jumpå¤§å°|ä½æ•°/æ¯æ¬¡æŠ½å–|
|-------------|----|------|-----------|
|PCG64|2^128|2^127|64|
|PCG64DXSM|2^128|2^127|64|
|MT19937|2^19937-1|2^128|32|
|Philox|2^256|2^128|64|

PCG64å’ŒPCG64DXSMçš„jumpå¤§å°å®é™…ä¸ºï¼š`(é»„é‡‘æ¯”ä¾‹-1)*2^128`

æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹å…·ä½“ä¾‹å­ï¼š


```python
bg = np.random.PCG64(42)
```


```python
bgs = [bg.jumped(i) for i in range(10)]
```


```python
bgs
```




    [<numpy.random._pcg64.PCG64 at 0x1199f2250>,
     <numpy.random._pcg64.PCG64 at 0x117209e00>,
     <numpy.random._pcg64.PCG64 at 0x1172db720>,
     <numpy.random._pcg64.PCG64 at 0x1173e2eb0>,
     <numpy.random._pcg64.PCG64 at 0x1173e2930>,
     <numpy.random._pcg64.PCG64 at 0x1173e21a0>,
     <numpy.random._pcg64.PCG64 at 0x1173e2ca0>,
     <numpy.random._pcg64.PCG64 at 0x1173e2040>,
     <numpy.random._pcg64.PCG64 at 0x1173e2a90>,
     <numpy.random._pcg64.PCG64 at 0x1173e23b0>]




```python
bg = np.random.PCG64(42)
bg.state
```




    {'bit_generator': 'PCG64',
     'state': {'state': 274674114334540486603088602300644985544,
      'inc': 332724090758049132448979897138935081983},
     'has_uint32': 0,
     'uinteger': 0}




```python
# ä¸€ä¸ªå‘¨æœŸ
bg.advance(2**128).state
```




    {'bit_generator': 'PCG64',
     'state': {'state': 274674114334540486603088602300644985544,
      'inc': 332724090758049132448979897138935081983},
     'has_uint32': 0,
     'uinteger': 0}




```python
# å‰è¿›ä¸€æ­¥
bg.jumped(1).state
```




    {'bit_generator': 'PCG64',
     'state': {'state': 246721301968239085263295379140720340427,
      'inc': 332724090758049132448979897138935081983},
     'has_uint32': 0,
     'uinteger': 0}




```python
# ç­‰äºå‰è¿›jump sizeçš„æ­¥æ•°
bg.advance(210306068529402873165736369884012333109).state
```




    {'bit_generator': 'PCG64',
     'state': {'state': 246721301968239085263295379140720340427,
      'inc': 332724090758049132448979897138935081983},
     'has_uint32': 0,
     'uinteger': 0}



å¦å¤–éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œ`PCG64 BitGenerator`åœ¨å¤§è§„æ¨¡å¹¶è¡Œç¯å¢ƒä¸­çš„ä½¿ç”¨å·²è¢«è¯æ˜å…·æœ‰ç»Ÿè®¡å¼±ç‚¹ï¼ŒNumPyå¼•å…¥äº†ä¸€ä¸ªæ–°çš„`PCG64DXSM BitGenerator`ï¼Œå®ƒæœ€ç»ˆå°†æˆä¸º`default_rng`åœ¨æœªæ¥ç‰ˆæœ¬ä¸­ä½¿ç”¨çš„æ–°çš„é»˜è®¤`BitGenerator`å®ç°ã€‚`PCG64DXSM`è§£å†³äº†ç»Ÿè®¡ä¸Šçš„å¼±ç‚¹ï¼ŒåŒæ—¶ä¿ç•™äº†`PCG64`çš„æ€§èƒ½å’Œç‰¹æ€§ã€‚

å¦‚æœä½ ï¼š

- åªä½¿ç”¨ä¸€ä¸ª`Generator`å®ä¾‹
- ä»…ä½¿ç”¨`RandomState`æˆ–`numpy.random`ä¸­çš„å‡½æ•°
- ä»…ä½¿ç”¨`PCG64.jumped`æ–¹æ³•ç”Ÿæˆå¹¶è¡Œæµ
- æ˜ç¡®ä½¿ç”¨`PCG64`ä»¥å¤–çš„`BitGenerator`

åˆ™è¿™ä¸ªå¼±ç‚¹å¹¶æ— å½±å“ã€‚

### å¤šçº¿ç¨‹


```python
from numpy.random import default_rng, SeedSequence
import multiprocessing
import concurrent.futures

"""
ä»£ç æ¥è‡ªï¼šhttps://numpy.org/devdocs/reference/random/multithreading.html
"""

class MultithreadedRNG:
    def __init__(self, n, seed=None, threads=None):
        if threads is None:
            threads = multiprocessing.cpu_count()
        # çº¿ç¨‹æ•°é‡
        self.threads = threads

        seq = SeedSequence(seed)
        # ä½¿ç”¨spawnç”Ÿæˆthreadsä¸ªGenerator
        self._random_generators = [default_rng(s)
                                   for s in seq.spawn(threads)]

        self.n = n
        # ç”Ÿæˆå¯¹åº”çš„çº¿ç¨‹executor
        self.executor = concurrent.futures.ThreadPoolExecutor(threads)
        # å­˜å‚¨value
        self.values = np.zeros(n)
        
        self.step = np.ceil(n / threads).astype(np.int_)

    def fill(self):
        # å¡«å……éšæœºå€¼
        # random, standard_normal, standard_exponential, standard_gammaæ”¯æŒ
        def _fill(random_state, out, first, last):
            # æ¯æ¬¡ç”Ÿæˆthreadsä¸ªéšæœºæ•°
#             print(f"first: {first}, last: {last}\n")
            random_state.standard_normal(out=out[first:last])

        futures = {}
        for i in range(self.threads):
            args = (_fill,
                    self._random_generators[i],
                    self.values,
                    i * self.step,
                    (i + 1) * self.step)
            futures[self.executor.submit(*args)] = i
        concurrent.futures.wait(futures)

    def __del__(self):
        self.executor.shutdown(False)
```


```python
N = 10000000
seed = 42
mrng = MultithreadedRNG(N, seed=42)
mrng.values
```




    array([0., 0., 0., ..., 0., 0., 0.])




```python
mrng.fill()
```


```python
mrng.values[:10]
```




    array([ 0.41832997,  0.60557617,  0.02878786, -1.084246  ,  1.46422098,
            0.29072736, -1.33075642, -0.03472346,  0.28041847,  0.10749307])




```python
%timeit mrng.fill()
```

    61.5 ms Â± 15.3 ms per loop (mean Â± std. dev. of 7 runs, 10 loops each)
    


```python
values = np.zeros(N)
rg = np.random.default_rng()
%timeit rg.standard_normal(out=values)
```

    117 ms Â± 8.35 ms per loop (mean Â± std. dev. of 7 runs, 1 loop each)
    

æ•°ç»„åˆ›å»ºä¹Ÿæœ‰å¼€é”€ï¼š


```python
rg = default_rng()
%timeit rg.standard_normal(N)
```

    126 ms Â± 7.04 ms per loop (mean Â± std. dev. of 7 runs, 1 loop each)
    

### æ€§èƒ½

å…³äºä¸åŒçš„`Generator`ï¼Œå®˜æ–¹ç»™å‡ºäº†å‚è€ƒå»ºè®®ï¼Œå¦‚ä¸‹ï¼š

- æ¨è`PCG64`æˆ–å®ƒçš„å‡çº§å˜ç§`PCG64DXSM`ï¼Œç”¨äºé«˜åº¦å¹¶è¡Œçš„ç”¨ä¾‹ã€‚åœ¨å¤§å¤šæ•°å¹³å°ä¸Šå…·æœ‰ç»Ÿè®¡ä¸Šçš„é«˜è´¨é‡ã€å…¨åŠŸèƒ½å’Œå¿«é€Ÿï¼Œä½†åœ¨ä¸º32ä½è¿›ç¨‹ç¼–è¯‘æ—¶ä¼šæœ‰äº›æ…¢ã€‚
- `Philox`æ¯”è¾ƒæ…¢ï¼Œä½†å®ƒçš„ç»Ÿè®¡å±æ€§è´¨é‡éå¸¸é«˜ï¼Œä½¿ç”¨å”¯ä¸€çš„keyå¾ˆå®¹æ˜“å¾—åˆ°ä¸€ä¸ªå¯é ç‹¬ç«‹çš„æµã€‚å¦‚æœå¸Œæœ›å¸Œæœ›è¿™æ ·å¹¶è¡Œå¯ä»¥é€‰æ‹©å®ƒã€‚
- `SFC64`å…·æœ‰ç»Ÿè®¡ä¸Šçš„é«˜è´¨é‡ä¸”éå¸¸å¿«ã€‚ä½†æ˜¯å®ƒä¸èƒ½jumpï¼Œå¦‚æœä¸éœ€è¦è¯¥åŠŸèƒ½å¹¶å¸Œæœ›è·å¾—é«˜é€Ÿåº¦ï¼ˆ32ä½è¿›ç¨‹ä¹Ÿæ˜¯è¿™æ ·ï¼‰å¯ä»¥é€‰æ‹©å®ƒã€‚
- `MT19937`æœªèƒ½é€šè¿‡ä¸€äº›ç»Ÿè®¡æµ‹è¯•ï¼Œè€Œä¸”ä¸ç°ä»£PRNGç›¸æ¯”å¹¶ä¸æ˜¯ç‰¹åˆ«å¿«ã€‚å¤§å¤šæ•°æ—¶å€™ä¸å»ºè®®å•ç‹¬ä½¿ç”¨ï¼Œç›®å‰ä¸»è¦ç”¨åœ¨æ—§çš„`RandomState`ç‰ˆæœ¬é‡Œã€‚

ä¸‹é¢çš„å¯¹æ¯”æ˜¯ä»¥nsä¸ºå•ä½ä»ç‰¹å®šåˆ†å¸ƒäº§ç”Ÿä¸€ä¸ªéšæœºæ•°çš„æ—¶é—´ã€‚


|  |RandomState|MT19937|PCG64|PCG64DXSM|Philox|SFC64|
|---|----------|-------|-----|---------|------|-----|
|32-bit Unsigned Ints|3.1|3.3|1.9|2.0|3.3|**1.8**|
|64-bit Unsigned Ints|5.5|5.6|3.2|2.9|4.9|**2.5**|
|Uniforms            |6.0|5.9|3.1|2.9|5.0|**2.6**|
|Normals             |56.8|13.9|10.8|10.5|12.0|**8.3**|
|Exponenitials       |63.9|9.1|6.0|5.8|8.1|**5.4**|


æ›´å¤šå¯¹æ¯”å¯å‚é˜…ï¼š[Performance â€” NumPy v1.24.dev0 Manual](https://numpy.org/devdocs/reference/random/performance.html)

### æ•´æ•°éšæœºåºåˆ—


```python
rng = np.random.default_rng(42)

rng.integers(1, 10, (2,3))
```




    array([[1, 7, 6],
           [4, 4, 8]])



`integers`çš„APIå¾ˆç›´è§‚ï¼š

- lowï¼šä¸‹ç•Œ
- highï¼šä¸Šç•Œ
- sizeï¼šshape
- dtypeï¼šæ•°æ®ç±»å‹
- endpointï¼šé»˜è®¤Falseï¼Œä¸åŒ…å«ä¸Šç•Œ


```python
rng.integers(0, 2, 3), rng.integers(0, 2, 3, endpoint=True)
```




    (array([1, 0, 1]), array([1, 0, 2]))



å½“ç„¶ï¼Œlowå’Œhighéƒ½å¯ä»¥æ˜¯æ•°ç»„ï¼Œè¡¨ç¤ºå¤šä¸ªä¸Šä¸‹ç•Œï¼š


```python
rng.integers(0, [2,5,10], size=(2,3))
```




    array([[1, 3, 7],
           [0, 1, 4]])




```python
rng.integers([2, 5, 10], [4, 10, 20], size=(2,3))
```




    array([[ 2,  7, 16],
           [ 3,  7, 18]])




```python
# ç¬¬ä¸€è¡Œ 2 ==> 8 10 20
# ç¬¬äºŒè¡Œ 5 ==> 8 10 20
rng.integers([[2],[5]], [8, 10, 20])
```




    array([[ 5,  2, 15],
           [ 6,  8, 13]])



### å‡åŒ€éšæœºåºåˆ—

`random`ç”¨äºç”Ÿæˆ0-1ï¼ˆå·¦é—­å³å¼€ï¼‰éšæœºæ•°ã€‚


```python
rng = np.random.default_rng(42)
rng.random((2, 3))
```




    array([[0.77395605, 0.43887844, 0.85859792],
           [0.69736803, 0.09417735, 0.97562235]])




```python
rng = np.random.default_rng(42)
rng.uniform(0, 1, (2,3))
```




    array([[0.77395605, 0.43887844, 0.85859792],
           [0.69736803, 0.09417735, 0.97562235]])



### éšæœºé‡‡æ ·

`choice`ç”¨äºä»ç»™å®šåºåˆ—ä¸­éšæœºé‡‡æ ·ã€‚ã€Šä»å°ç™½åˆ°å…¥é—¨ã€‹ä¸­æœ‰ä»‹ç»ï¼Œä¸å†èµ˜è¿°ã€‚

## éšæœºæ’åˆ—

é¦–å…ˆæ˜¯`shuffle`æ¥å£ï¼Œç”¨äºshuffleç»™å®šçš„æ•°ç»„ã€‚å®ƒæ¥å—ä¸€ä¸ªæ•°ç»„ï¼ˆä»»æ„ç»´åº¦ï¼‰ï¼Œè¿˜å¯ä»¥æŒ‡å®šshuffleçš„ç»´åº¦ï¼ˆç¬¬å‡ ç»´ï¼‰ã€‚

ğŸ“¢æ³¨æ„ï¼Œ`shuffle`æ˜¯`in-place`çš„ã€‚


```python
rng = np.random.default_rng(42)
a = rng.integers(1, 100, (5, 4))
a
```




    array([[ 9, 77, 65, 44],
           [43, 86,  9, 70],
           [20, 10, 53, 97],
           [73, 76, 72, 78],
           [51, 13, 84, 45]])




```python
rng.shuffle(a)
a
```




    array([[51, 13, 84, 45],
           [ 9, 77, 65, 44],
           [20, 10, 53, 97],
           [73, 76, 72, 78],
           [43, 86,  9, 70]])




```python
rng = np.random.default_rng(42)
a = rng.integers(1, 100, (5, 4))
a
```




    array([[ 9, 77, 65, 44],
           [43, 86,  9, 70],
           [20, 10, 53, 97],
           [73, 76, 72, 78],
           [51, 13, 84, 45]])



æ³¨æ„ï¼Œ`shuffle`æŒ‡å®šç»´åº¦æ—¶ï¼Œæ˜¯æŒ‰å—é‡æ’çš„ã€‚


```python
# æ¯ä¸€è¡Œé¡ºåºä¼šå˜ï¼Œä½†æ€»çš„å…ƒç´ ä¸å˜ï¼Œè€Œä¸”ï¼Œæ¯ä¸€åˆ—ä¹Ÿä¸å˜
# ä¹Ÿå°±æ˜¯ä»¥åˆ—/è¡Œï¼ˆé€šè¿‡axisæ§åˆ¶ï¼‰ä¸ºå•ä½åœ¨é‡æ’
rng.shuffle(a, axis=1)
a
```




    array([[44,  9, 65, 77],
           [70, 43,  9, 86],
           [97, 20, 53, 10],
           [78, 73, 72, 76],
           [45, 51, 84, 13]])



`permutation`éšæœºæ’åˆ—åºåˆ—ï¼Œå‚æ•°ï¼š

- æ•°ç»„æˆ–æ•´æ•°ï¼Œæ•°ç»„æ—¶ä¼šè¿”å›copyï¼Œæ•´æ•°æ—¶ç”Ÿæˆ`arange`çš„éšæœºã€‚
- ç»´åº¦


```python
rng.permutation(5)
```




    array([0, 3, 4, 2, 1])




```python
rng = np.random.default_rng(42)
a = rng.integers(1, 100, (5, 4))
a
```




    array([[ 9, 77, 65, 44],
           [43, 86,  9, 70],
           [20, 10, 53, 97],
           [73, 76, 72, 78],
           [51, 13, 84, 45]])




```python
b = rng.permutation(a)
b
```




    array([[43, 86,  9, 70],
           [ 9, 77, 65, 44],
           [20, 10, 53, 97],
           [51, 13, 84, 45],
           [73, 76, 72, 78]])



å®ƒçš„axiså’Œ`shuffle`çš„ä¸€æ ·ï¼Œä¹Ÿæ˜¯æŒ‰ä¸€è¡Œæˆ–ä¸€åˆ—ä¸ºå•ä½è¿›è¡Œé‡æ’ã€‚


```python
# è¡Œä¸å˜
rng.permutation(a, axis=0)
```




    array([[73, 76, 72, 78],
           [20, 10, 53, 97],
           [43, 86,  9, 70],
           [ 9, 77, 65, 44],
           [51, 13, 84, 45]])



`permuted`æ¯”`permutation`å¤šäº†ä¸€ä¸ª`out`å‚æ•°ï¼Œè¿™ä¸ªä¹‹å‰æåˆ°è¿‡å¤šæ¬¡ã€‚å¦å¤–ï¼Œå®ƒä¸å‰ä¸¤ä¸ªçš„ä¸åŒæ˜¯ï¼Œaxisæ˜¯ç‹¬ç«‹çš„ï¼Œä¸ä¼šå‡ºç°ä¸€è¡Œæˆ–ä¸€åˆ—æ•´ä½“é‡æ’ã€‚


```python
rng.permuted([2,3,1])
```




    array([2, 3, 1])




```python
a
```




    array([[ 9, 77, 65, 44],
           [43, 86,  9, 70],
           [20, 10, 53, 97],
           [73, 76, 72, 78],
           [51, 13, 84, 45]])




```python
b = rng.permuted(a)
b
```




    array([[97, 86, 20, 77],
           [53, 45, 73,  9],
           [13, 44, 65,  9],
           [10, 72, 70, 43],
           [84, 78, 51, 76]])




```python
rng = np.random.default_rng(42)
a = rng.integers(1, 100, (5, 4))
a
```




    array([[ 9, 77, 65, 44],
           [43, 86,  9, 70],
           [20, 10, 53, 97],
           [73, 76, 72, 78],
           [51, 13, 84, 45]])




```python
# è¡Œå…ƒç´ ä¸å˜ï¼Œä½†é¡ºåºéƒ½é‡æ’äº†ï¼Œç”±äºä¸æ˜¯æˆå—å˜ï¼Œæ‰€ä»¥åˆ—ä¹Ÿå˜äº†
# ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸€è¡Œéƒ½æ˜¯ç‹¬ç«‹çš„åœ¨é‡æ’
b = rng.permuted(a, axis=1)
b
```




    array([[44,  9, 65, 77],
           [43, 70,  9, 86],
           [10, 20, 53, 97],
           [73, 76, 78, 72],
           [13, 51, 84, 45]])



ä¸Šé¢ä¸‰ä¸ªAPIæ€»ç»“èµ·æ¥å¦‚ä¸‹ï¼š

|api|copy/in-place|axis|
|----|-------|--------|
|shuffle|in-place|è§†ä¸ºä¸€ç»´|
|permutation|copy|è§†ä¸ºä¸€ç»´|
|permuted|é€šè¿‡outå¯ä»¥å˜æˆin-place|ç»´åº¦ç‹¬ç«‹|

å½“ç„¶ï¼Œæˆ‘ä»¬å¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯ä¸éœ€è¦axisè¿™ä¸ªå‚æ•°çš„ï¼Œç›´æ¥shuffleå°±å®Œäº‹äº†ã€‚

## éšæœºåˆ†å¸ƒ

NumPyçš„`random`å†…ç½®äº†å¾ˆå¤šåˆ†å¸ƒï¼Œæˆ‘ä»¬ç®€å•è¿‡ä¸€ä¸‹ã€‚


```python
import matplotlib.pyplot as plt
```

`uniform`å‡åŒ€åˆ†å¸ƒï¼Œå·¦é—­å³å¼€çš„å‚æ•°lowå’Œhighï¼Œæ˜¯æœ€ç®€å•çš„è¿ç»­åˆ†å¸ƒã€‚

$$
p(x) = \frac{1}{b - a}
$$

ä¸è¿‡æœ€å¸¸è§/ç”¨çš„åº”è¯¥æ˜¯æ­£æ€åˆ†å¸ƒäº†ï¼š

`normal`è¿”å›é«˜æ–¯åˆ†å¸ƒï¼Œå‚æ•°åŒ…æ‹¬ï¼š

- locï¼šå‡å€¼ï¼Œé»˜è®¤0.0
- scaleï¼šæ ‡å‡†å·®ï¼Œé»˜è®¤1.0
- sizeï¼šé»˜è®¤Noneï¼ˆç”±äºè¿™ä¸ªå‚æ•°æ˜¯é€šç”¨çš„ï¼Œä¸‹é¢çš„ä»‹ç»å°†å¿½ç•¥è¯¥å‚æ•°ï¼‰

$$
p(x) = \frac{1}{\sqrt{ 2 \pi \sigma^2 }}
                 e^{ - \frac{ (x - \mu)^2 } {2 \sigma^2} }
$$


```python
# ä¸ç»™å…¥å‚æ—¶ï¼Œè¿”å›ä¸€ä¸ªæ ‡å‡†æ­£å¤ªçš„å€¼
rng = np.random.default_rng(42)
rng.normal()
```




    0.30471707975443135




```python
# æŒ‡å®šsize
rng = np.random.default_rng(42)
rng.normal(size=(2,3))
```




    array([[ 0.30471708, -1.03998411,  0.7504512 ],
           [ 0.94056472, -1.95103519, -1.30217951]])



æˆ‘ä»¬ç”¨å›¾åƒäº†è§£ä¸€ä¸‹ï¼ˆå…¶ä»–åˆ†å¸ƒç±»ä¼¼ï¼Œä¸å†é‡å¤ï¼‰ï¼š


```python
# æŒ‡å®šå‡å€¼ã€æ ‡å‡†å·®
rng = np.random.default_rng(42)
N  = 10000
a1 = rng.normal(0.0, 1.0, N)
a2 = rng.normal(0.0, 4.0, N)
a3 = rng.normal(0.0, 8.0, N)
```


```python
fig, axs = plt.subplots(1, 3, figsize=(12, 4), sharex=True, tight_layout=True)
n_bins=100
axs[0].hist(a1, bins=n_bins);
axs[1].hist(a2, bins=n_bins);
axs[2].hist(a3, bins=n_bins);
# æ ‡å‡†å·®è¶Šå¤§ï¼Œå›¾åƒè¶Šå®½
```


    
![png](ch05-probability_statistics_files/ch05-probability_statistics_227_0.png)
    


`standard_normal`æ ‡å‡†æ­£æ€åˆ†å¸ƒï¼ˆå°±æ˜¯`normal`é»˜è®¤å‡å€¼å’Œæ ‡å‡†å·®çš„æƒ…å†µï¼‰ï¼Œé™¤äº†sizeï¼Œè¿˜å¤šäº†dtypeå’Œoutï¼Œè¿™äº›å‚æ•°çš„å«ä¹‰ä¸å†èµ˜è¿°ã€‚

`multivarite_normal`å¤šå˜é‡æ­£æ€åˆ†å¸ƒå°†ä¸€ç»´æ­£æ€åˆ†å¸ƒæ¨å¹¿åˆ°é«˜ç»´ã€‚å‚æ•°åŒ…æ‹¬ï¼š

- meanï¼šNç»´åˆ†å¸ƒçš„å‡å€¼ï¼Œæ˜¯Nç»´ç©ºé—´ä¸­çš„åæ ‡ï¼Œè¡¨ç¤ºæœ€æœ‰å¯èƒ½ç”Ÿæˆçš„æ ·æœ¬ä½ç½®
- covï¼šåˆ†å¸ƒçš„åæ–¹å·®çŸ©é˜µï¼Œå¿…é¡»æ˜¯å¯¹ç§°ä¸”åŠæ­£å®šçš„ï¼Œè¡¨ç¤ºä¸¤ä¸ªå˜é‡ä¸€èµ·å˜åŒ–çš„æ°´å¹³
- sizeï¼šå¦‚æœä¸ºNoneï¼Œåˆ™ç”ŸæˆNä¸ªï¼Œå¦åˆ™ç”Ÿæˆ`shape+(N,)`ä¸ª
- check_validï¼šæ£€æŸ¥åæ–¹å·®çŸ©é˜µæ˜¯ä¸æ˜¯åŠæ­£å®šçš„ï¼Œé»˜è®¤warnï¼Œå¯é€‰warnï¼Œraiseå’Œignore
- tolï¼šæ£€æŸ¥åæ–¹å·®çŸ©é˜µä¸­çš„å¥‡å¼‚å€¼æ—¶çš„å…¬å·®ã€‚covåœ¨æ£€æŸ¥å‰åŠ å€ã€‚é»˜è®¤1e-8
- methodï¼šè®¡ç®—å› å­çŸ©é˜µAï¼ˆ`A@A.T = cov`ï¼‰ï¼Œé»˜è®¤svdï¼ˆæœ€æ…¢ï¼‰ï¼Œcholeskyæœ€å¿«ä½†ä¸å¤Ÿé²æ£’ï¼Œeighä½¿ç”¨ç‰¹å¾åˆ†è§£é€Ÿåº¦ä»‹äºäºŒè€…ä¹‹é—´


```python
(
    rng.multivariate_normal([0,0], [[1,0],[0,100]]).shape,
    rng.multivariate_normal([0,0], [[1,0],[0,100]], 3).shape,
    rng.multivariate_normal([0,0], [[1,0],[0,100]], (3, 4)).shape
)
```




    ((2,), (3, 2), (3, 4, 2))



### é«˜æ–¯ç›¸å…³

`lognormal`å¯¹æ•°æ­£æ€åˆ†å¸ƒï¼Œæ¥å—å‡å€¼meanå’Œæ ‡å‡†å·®sigmaã€‚

$$
p(x) = \frac{1}{\sigma x \sqrt{2\pi}}
e^{(-\frac{(ln(x)-\mu)^2}{2\sigma^2})}
$$

å¦‚æœ`log(x)`æ»¡è¶³æ­£æ€åˆ†å¸ƒï¼Œåˆ™xæ»¡è¶³å¯¹æ•°åˆ†å¸ƒã€‚

`laplace`æ‹‰æ™®æ‹‰æ–¯åˆ†å¸ƒï¼Œæ¥å—ä½ç½®å‚æ•°locå’Œå°ºåº¦å‚æ•°scaleï¼Œä¸é«˜æ–¯åˆ†å¸ƒç±»ä¼¼ï¼Œåœ¨å³°éƒ¨æ›´å°–ï¼Œåœ¨å°¾éƒ¨æ›´å¹³å¦ã€‚

$$
(x; \mu, \lambda) = \frac{1}{2\lambda}
                               \exp\left(-\frac{|x - \mu|}{\lambda}\right)
                               $$

`rayleigh`ç‘åˆ©åˆ†å¸ƒï¼Œå‚æ•°scaleè¡¨ç¤ºæ ‡å‡†å·®ã€‚

$$
P(x;scale) = \frac{x}{scale^2}e^{\frac{-x^2}{2 \cdotp scale^2}}
$$

å½“ä¸€ä¸ªéšæœºäºŒç»´å‘é‡çš„ä¸¤ä¸ªåˆ†é‡å‘ˆç°ç‹¬ç«‹çš„ã€æœ‰ç›¸åŒæ–¹å·®ã€å‡å€¼ä¸º0çš„æ­£æ€åˆ†å¸ƒæ—¶ï¼Œå‘é‡çš„æ¨¡å‘ˆç‘åˆ©åˆ†å¸ƒã€‚

`gumbel`è€¿è´å°”åˆ†å¸ƒéœ€æŒ‡å®šlocï¼ˆä¸­å¿ƒå‚æ•°Î¼å’Œå±•å®½å‚æ•°Ïƒï¼‰ã€‚

$$
p(x) = \frac{e^{-(x - \mu)/ \beta}}{\beta} e^{ -e^{-(x - \mu)/\beta}}\\
={\displaystyle {\frac {1}{\beta }}e^{-(z+e^{-z})}}\\
{\displaystyle z={\frac {x-\mu }{\beta }}}\\
$$

`standard_cauchy`æ ‡å‡†æŸ¯è¥¿åˆ†å¸ƒï¼ˆç‰©ç†å­¦ä¸Šäº¤æ´›ä¼¦å…¹åˆ†å¸ƒï¼‰ã€‚

$$
P(x; x_0, \gamma) = \frac{1}{\pi \gamma \bigl[ 1+(\frac{x-x_0}{\gamma})^2 \bigr] }
$$

æ ‡å‡†æŸ¯è¥¿åˆ†å¸ƒä¸‹ï¼ŒÎ³=1ï¼Œx0=0ã€‚æ¦‚ç‡å¯†åº¦å‡½æ•°å¯åŒ–ç®€ä¸ºï¼š

$$
P(x;0,1) = \frac{1}{\pi \bigl[ 1+x^2 \bigr] }
$$

åœ¨ç ”ç©¶å‡è®¾æ­£æ€æ€§çš„å‡è®¾æ£€éªŒæ—¶ï¼ŒæŸ¥çœ‹æ£€éªŒå¯¹æ¥è‡ªæŸ¯è¥¿åˆ†å¸ƒçš„æ•°æ®çš„æ‰§è¡Œæƒ…å†µæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æŒ‡æ ‡ã€‚å› ä¸ºæŸ¯è¥¿åˆ†å¸ƒçœ‹èµ·æ¥åƒé«˜æ–¯åˆ†å¸ƒï¼Œä½†å°¾å·´æ›´é‡ã€‚

`vonmises`å†¯Â·ç±³å¡æ€åˆ†å¸ƒæ˜¯ä¸€ç§åœ†ä¸Šçš„è¿ç»­æ¦‚ç‡åˆ†å¸ƒï¼Œå‚æ•°muè¡¨ç¤ºä¸­å¿ƒmodeï¼Œkappaæ˜¯æµ“åº¦çš„åº¦é‡ï¼Œå¦‚æœkappa=0è¡¨ç¤ºåˆ†å¸ƒæ˜¯å‡åŒ€çš„ï¼Œå¾ˆå°æ—¶æ¥è¿‘å‡åŒ€åˆ†å¸ƒï¼Œå¦‚æœkappaå¾ˆå¤§ï¼Œåˆ†å¸ƒä¼šåœ¨è§’åº¦Î¼å¤„å˜å¾—éå¸¸é›†ä¸­ã€‚

$$
p(x) = \frac{e^{\kappa cos(x-\mu)}}{2\pi I_0(\kappa)}
$$

I_0æ˜¯0é˜¶ä¿®æ­£çš„è´å¡å°”ï¼ˆBasselï¼‰å‡½æ•°ã€‚

`wald`é€†é«˜æ–¯åˆ†å¸ƒï¼Œscaleï¼ˆå‚æ•°Î»ï¼‰è¶‹è¿‘äºæ— ç©·å¤§æ—¶ï¼Œåˆ†å¸ƒæ›´åƒé«˜æ–¯åˆ†å¸ƒã€‚

$$
P(x;mean,scale) = \sqrt{\frac{scale}{2\pi x^3}}e^\frac{-scale(x-mean)^2}{2\cdotp mean^2x}
$$

`triangular`ä¸‰è§’åˆ†å¸ƒï¼Œéœ€æŒ‡å®šä¸‹é™leftã€ä¸Šé™rightå’Œä¼—æ•°modeã€‚

$$
P(x;l, m, r) = \begin{cases}
          \frac{2(x-l)}{(r-l)(m-l)}& \text{for $l \leq x \leq m$},\\
          \frac{2(r-x)}{(r-l)(r-m)}& \text{for $m \leq x \leq r$},\\
          0& \text{otherwise}.
          \end{cases}
$$

ä¸‰è§’åˆ†å¸ƒå¸¸ç”¨äºå®šä¹‰ä¸æ˜ç¡®çš„é—®é¢˜ï¼Œå…¶ä¸­æ½œåœ¨çš„åˆ†å¸ƒæœªçŸ¥ï¼Œä½†å­˜åœ¨ä¸€äº›å…³äºæé™å’Œä¼—æ•°çš„çŸ¥è¯†ã€‚

### ç¦»æ•£åˆ†å¸ƒ

`binomial`æ˜¯äºŒé¡¹åˆ†å¸ƒï¼Œå‚æ•°åŒ…æ‹¬ï¼šnå’Œpï¼Œnæ˜¯è¯•éªŒæ¬¡æ•°ï¼Œpæ˜¯æˆåŠŸæ¦‚ç‡ã€‚n=1æ—¶æ˜¯ä¼¯åŠªåˆ©åˆ†å¸ƒã€‚

næ¬¡å®éªŒå¾—åˆ°kæ¬¡æˆåŠŸçš„æ¦‚ç‡ï¼š

$$
{\displaystyle f(k,n,p)=\Pr(X=k)={n \choose k}p^{k}(1-p)^{n-k}}
$$


```python
# ä¸¢10æ¬¡ç¡¬å¸ï¼Œæ­£é¢å‘ä¸Šçš„ç»“æœ
rng.binomial(10, 0.5)
```




    5



`multinomial`å¤šé¡¹å¼åˆ†å¸ƒæ˜¯äºŒé¡¹åˆ†å¸ƒçš„æ¨å¹¿ï¼ŒæŠŠäºŒé¡¹æ¨å¹¿åˆ°å¤šç§çŠ¶æ€å°±æ˜¯å¤šé¡¹åˆ†å¸ƒã€‚å‚æ•°åŒ…æ‹¬è¯•éªŒæ¬¡æ•°nå’Œå„ç§ç»“æœçš„æ¦‚ç‡åˆ†å¸ƒï¼ˆå’Œå¿…é¡»ä¸º1ï¼‰ã€‚

$$
{\displaystyle {\begin{aligned}f(x_{1},\ldots ,x_{k};n,p_{1},\ldots ,p_{k})&{}=\Pr(X_{1}=x_{1}{\text{ and }}\dots {\text{ and }}X_{k}=x_{k})\\&{}={\begin{cases}{\displaystyle {n! \over x_{1}!\cdots x_{k}!}p_{1}^{x_{1}}\times \cdots \times p_{k}^{x_{k}}},\quad &{\text{when }}\sum _{i=1}^{k}x_{i}=n\\\\0&{\text{otherwise,}}\end{cases}}\end{aligned}}}
$$

æ›´å¤šå‚è§ï¼š[Multinomial distribution - Wikipedia](https://en.wikipedia.org/wiki/Multinomial_distribution)


```python
# æ¯”å¦‚ä¸¢ä¸€ä¸ªéª°å­20æ¬¡
# ç»“æœè¡¨ç¤ºæ¯ä¸ªç‚¹æ•°å‡ºç°çš„æ¬¡æ•°
rng.multinomial(20, [1/6] * 6)
```




    array([4, 6, 2, 1, 3, 4])



`negative_binomial`è´ŸäºŒé¡¹åˆ†å¸ƒï¼ˆæˆ–å¸•æ–¯å¡åˆ†å¸ƒï¼‰ï¼Œå‚æ•°nè¡¨ç¤ºæˆåŠŸæ¬¡æ•°ï¼Œpè¡¨ç¤ºæˆåŠŸæ¦‚ç‡ã€‚

$$
f(k;n,p) = \frac{\Gamma(n+k)}{k!\Gamma(n)}p^{n}(1-p)^{k}\\
\frac{\Gamma(n+k)}{N!\Gamma(n)} = \binom{k+n-1}{k}
$$

ä¸äºŒé¡¹åˆ†å¸ƒçš„åŒºåˆ«æ˜¯ï¼ŒäºŒé¡¹åˆ†å¸ƒæ˜¯å›ºå®šæ€»æ¬¡æ•°nçš„ç‹¬ç«‹å®éªŒä¸­ï¼ŒæˆåŠŸæ¬¡æ•°kçš„åˆ†å¸ƒï¼›è€Œè´ŸäºŒé¡¹åˆ†å¸ƒæ˜¯æ‰€æœ‰åˆ°næ¬¡æˆåŠŸæ—¶å³ç»ˆæ­¢çš„ç‹¬ç«‹è¯•éªŒä¸­ï¼Œå¤±è´¥æ¬¡æ•°kçš„åˆ†å¸ƒã€‚å³æˆåŠŸæ¬¡æ•°nï¼Œå¤±è´¥æ¬¡æ•°kã€‚



æ›´å¤šå‚è§ï¼š[Negative binomial distribution - Wikipedia](https://en.wikipedia.org/wiki/Negative_binomial_distribution#:~:text=In%20probability%20theory%20and%20statistics,failures%20(denoted%20r)%20occur.)

`poisson`æ³Šæ¾åˆ†å¸ƒä¹Ÿæ˜¯æ¯”è¾ƒå¸¸è§çš„ï¼Œå®ƒæ˜¯ä¸€ç§ç¦»æ•£åˆ†å¸ƒï¼Œæ˜¯äºŒé¡¹åˆ†å¸ƒçš„æé™ã€‚å‚æ•°lamè¡¨ç¤ºå‚æ•°Î»ã€‚

$$
f(k; \lambda)=\frac{\lambda^k e^{-\lambda}}{k!}
$$

æ³Šæ¾åˆ†å¸ƒé•¿ä¸è®¡æ•°è¿‡ç¨‹ç›¸è”ç³»ï¼Œæ¯”å¦‚æŸä¸€æ—¶æ®µç½‘ç«™ç‚¹å‡»é‡ç­‰ã€‚

æ³Šæ¾åˆ†å¸ƒä¹Ÿå¯ä»¥ä½œä¸ºäºŒé¡¹åˆ†å¸ƒçš„ä¸€ç§è¿‘ä¼¼ï¼ˆæ³Šæ¾å®šç†ï¼‰ï¼Œå½“nè¶‹è¿‘äºæ— ç©·å¤§æ—¶ï¼ŒäºŒé¡¹åˆ†å¸ƒçš„æé™ä¸ºæ³Šæ¾åˆ†å¸ƒã€‚

æ›´å¤šå‚è§ï¼š[Poisson distribution - Wikipedia](https://en.wikipedia.org/wiki/Poisson_distribution#:~:text=In%20probability%20theory%20and%20statistics,time%20since%20the%20last%20event.)

`geometric`å‡ ä½•åˆ†å¸ƒéœ€æŒ‡å®šæˆåŠŸæ¦‚ç‡pã€‚

å¦‚æœæ¯æ¬¡è¯•éªŒçš„æˆåŠŸæ¦‚ç‡æ˜¯ pï¼Œé‚£ä¹ˆ k æ¬¡è¯•éªŒä¸­ï¼Œç¬¬ k æ¬¡æ‰å¾—åˆ°æˆåŠŸçš„æ¦‚ç‡æ˜¯ï¼š

$$
f(k) = (1 - p)^{k - 1} p
$$

`hypergeometric`è¶…å‡ ä½•åˆ†å¸ƒéœ€æŒ‡å®šï¼šæ­£ç¡®é€‰æ‹©çš„æ–¹æ³•æ•°ngoodï¼Œé”™è¯¯é€‰æ‹©çš„æ–¹æ³•æ•°nbadå’Œé‡‡æ ·æ•°é‡ï¼Œnsample<=ngood+nbadã€‚

Nä¸ªæ ·æœ¬ï¼Œgä¸ªæ»¡è¶³æ¡ä»¶ï¼Œbä¸ªä¸æ»¡è¶³ï¼Œä»Nä¸ªä¸­æŠ½å‡ºnä¸ªï¼Œxæ»¡è¶³æ¡ä»¶çš„æ¦‚ç‡ï¼š

$$
P(x) = \frac{\binom{g}{x}\binom{b}{n-x}}{\binom{N}{n}}\\
g=\text{good}, b=\text{bad}
$$

æ›´å¤šå‚è§ï¼š[Hypergeometric distribution - Wikipedia](https://en.wikipedia.org/wiki/Hypergeometric_distribution)

`multivariate_hypergeometric`å¤šå…ƒè¶…å‡ ä½•åˆ†å¸ƒï¼Œä»Nä¸ªä¸åŒç±»å‹çš„é›†åˆä¸­éšæœºä¸æ›¿æ¢é€‰æ‹©nsampleä¸ªæ ·æœ¬ã€‚å‚æ•°åŒ…æ‹¬ï¼š

- colorsï¼šæ¯ä¸ªç±»å‹åœ¨é›†åˆä¸­çš„æ•°é‡
- nsampleï¼šé‡‡æ ·çš„æ•°é‡
- methodï¼šç”Ÿæˆç®—æ³•ï¼Œmarginalsï¼ˆé»˜è®¤ï¼‰æˆ–countã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼ˆæ¯”å¦‚colorsåŒ…æ‹¬ç›¸å¯¹å°çš„æ•°å­—ï¼‰ï¼Œcountæ–¹æ³•æ¯”marginalså¿«ã€‚


$$
f(x)=\frac{\left(\begin{array}{c}
D \\
x
\end{array}\right)\left(\begin{array}{c}
N-D \\
n-x
\end{array}\right)}{\left(\begin{array}{c}
N \\
n
\end{array}\right)}
$$


[Multivariate Hypergeometric distribution | Vose Software](https://www.vosesoftware.com/riskwiki/MultivariateHypergeometricdistribution.php#:~:text=The%20Multivariate%20Hypergeometric%20distribution%20is%20an%20array%20distribution%2C%20in%20this,%2C%20French%2C%20and%20Canadian)


```python
colors = [3,2,1,4]
nsample = 4
```


```python
# ä»ä¸€ç»„åˆ†åˆ«æœ‰ 3 2 1 4 ä¸ªä¸åŒç±»åˆ«çš„é›†åˆä¸­é€‰æ‹©4ä¸ª
rng.multivariate_hypergeometric(colors, nsample)
```




    array([0, 1, 1, 2])




```python
rng.multivariate_hypergeometric(colors, nsample, method="count")
```




    array([2, 1, 0, 1])



countæ–¹æ³•ä¸ä¸‹é¢çš„ç­‰ä»·ï¼š


```python
choices = np.repeat(np.arange(len(colors)), colors)
choices
```




    array([0, 0, 0, 1, 1, 2, 3, 3, 3, 3])




```python
selection = rng.choice(choices, nsample, replace=False)
selection
```




    array([2, 1, 1, 0])




```python
# 0 1 2 3 åˆ†åˆ«å‡ºç°çš„ã€Œæ¬¡æ•°ã€
variate = np.bincount(selection, minlength=len(colors))
variate
```




    array([1, 2, 1, 0])



marginalså…¶å®æ˜¯é‡å¤è¯·æ±‚å•å˜é‡è¶…å‡ ä½•åˆ†å¸ƒé‡‡æ ·å™¨ï¼š


```python
colors, nsample
```




    ([3, 2, 1, 4], 4)




```python
variate = np.zeros(len(colors), dtype=np.int64)
# æ¯æ¬¡é‡‡æ ·åå‰©ä¸‹çš„æ•°
remaining = np.cumsum(colors[::-1])[::-1]
remaining
```




    array([10,  7,  5,  4])




```python
for i in range(len(colors) - 1):
    if nsample < 1:
        break
    variate[i] = rng.hypergeometric(colors[i], remaining[i+1], nsample)
    nsample -= variate[i]
variate[-1] = nsample
variate
```




    array([2, 0, 0, 2])



### æŒ‡å¯¹æ•°ç›¸å…³

`power`å¹‚å¾‹åˆ†å¸ƒï¼Œæ¥å—è¾“å…¥å‚æ•°aã€‚

$$
P(x; a) = ax^{a-1}, 0 \le x \le 1, a>0
$$

å¹‚å¾‹åˆ†å¸ƒæ­£å¥½æ˜¯å¸•ç´¯æ‰˜çš„å€’æ•°ï¼Œä¹Ÿå¯ä»¥çœ‹ä½œæ˜¯Betaåˆ†å¸ƒçš„ä¸€ä¸ªç‰¹ä¾‹ã€‚ç”Ÿæ´»ä¸­å¾ˆå¤šç°è±¡éƒ½å‘ˆç°å‡ºå¹‚å¾‹åˆ†å¸ƒï¼Œæ¯”å¦‚åŸå¸‚è§„æ¨¡å’Œæ”¶å…¥ã€ç‰©ç§çš„è§…é£Ÿæ¨¡å¼ã€å¤§éƒ¨åˆ†è¯­è¨€çš„ç”¨è¯é¢‘ç‡ç­‰ã€‚

`pareto`å¸•ç´¯æ‰˜åˆ†å¸ƒï¼Œå¯ä»¥ä»Lomaxåˆ†å¸ƒä¸­è·å¾—ã€‚å‚æ•°aä¸ºå½¢çŠ¶å‚æ•°ï¼Œæ˜¯æ¦‚ç‡åˆ†å¸ƒå‚æ•°æ—ä¸­çš„ä¸€ç§æ•°å€¼å‚æ•°ï¼Œæ—¢ä¸æ˜¯ä½ç½®å‚æ•°ï¼Œä¹Ÿä¸æ˜¯å°ºåº¦å‚æ•°ã€‚

$$
p(x) = \frac{am^a}{x^{a+1}}
$$


å¸•ç´¯æ‰˜åˆ†å¸ƒæ˜¯å¹‚å¾‹æ¦‚ç‡åˆ†å¸ƒï¼Œåœ¨çœŸå®ä¸–ç•Œä¸­å¤§é‡å­˜åœ¨ï¼ˆç»æµå­¦å¤–ç§°ä¸ºå¸ƒæ‹‰å¾·ç¦åˆ†å¸ƒï¼‰ã€‚


æ›´å¤šè¯¦è§ï¼š[Pareto distribution - Wikipedia](https://en.wikipedia.org/wiki/Pareto_distribution)

`zipf`é½å¤«å®šå¾‹ï¼ˆä¹Ÿç§°ä¸ºzetaåˆ†å¸ƒï¼‰ï¼šä¸€ä¸ªå•è¯å‡ºç°çš„é¢‘ç‡ä¸å®ƒåœ¨é¢‘ç‡è¡¨é‡Œçš„æ’åæˆåæ¯”ã€‚å‚æ•°aè¡¨ç¤º

$$
p(k) = \frac{k^{-a}}{\zeta(a)}
$$

é½å¤«å®šå¾‹è¢«ä½œä¸ºä»»ä½•ä¸å¹‚å®šå¾‹æ¦‚ç‡åˆ†å¸ƒæœ‰å…³çš„äº‹ç‰©çš„å‚è€ƒã€‚

`beta`Betaï¼ˆæˆ–Bï¼‰åˆ†å¸ƒæ˜¯ç‹„åˆ©å…‹é›·åˆ†å¸ƒçš„ç‰¹æ®Šå½¢å¼ï¼Œä¸gammaåˆ†å¸ƒæœ‰å…³ã€‚å‚æ•°åŒ…æ‹¬ï¼šaå’Œbï¼Œåˆ†åˆ«è¡¨ç¤ºalphaå’Œbetaã€‚

$$
f(x; a,b) = \frac{1}{B(\alpha, \beta)} x^{\alpha - 1}
(1 - x)^{\beta - 1},\\
B(\alpha, \beta) = \int_0^1 t^{\alpha - 1}
                             (1 - t)^{\beta - 1} dt.
$$

`dirichlet`æ˜¯ç‹„åˆ©å…‹é›·åˆ†å¸ƒï¼Œæ¥å—é•¿åº¦ä¸ºkçš„åºåˆ—æµ®ç‚¹æ•°ä½œä¸ºåˆ†å¸ƒçš„å‚æ•°ã€‚

$$
{\displaystyle f(x_{1},\dots ,x_{K};\alpha _{1},\dots ,\alpha _{K})={\frac {1}{\mathrm {B} (\alpha )}}\prod _{i=1}^{K}x_{i}^{\alpha _{i}-1}}
$$

`gamma`åˆ†å¸ƒåŒ…å«ä»¥ä¸‹å‚æ•°ï¼š

- shapeï¼šgammaåˆ†å¸ƒçš„kå€¼
- scaleï¼šgammaåˆ†å¸ƒçš„thetaå€¼ï¼Œé»˜è®¤1.0

$$
p(x) = x^{k-1}\frac{e^{-x/\theta}}{\theta^k\Gamma(k)}
$$

`exponential`æ˜¯æŒ‡æ•°åˆ†å¸ƒï¼Œå‚æ•°ä¸ºï¼š

- scaleï¼š1/betaï¼Œé»˜è®¤1.0

$$
f(x; \frac{1}{\beta}) = \frac{1}{\beta} \exp(-\frac{x}{\beta})
$$


`weibull`éŸ¦ä¼¯åˆ†å¸ƒï¼Œå‚æ•°aè¡¨ç¤ºshapeï¼Œæ˜¯å¯é æ€§åˆ†æå’Œå¯¿å‘½æ£€éªŒçš„ç†è®ºåŸºç¡€ã€‚

$$
p(x) = \frac{a}{\lambda}(\frac{x}{\lambda})^{a-1}e^{-(x/\lambda)^a}
$$

å½“a=1æ—¶é€€åŒ–ä¸ºæŒ‡æ•°åˆ†å¸ƒã€‚

`logseries`å¯¹æ•°åˆ†å¸ƒä¹Ÿå«å¯¹æ•°çº§æ•°åˆ†å¸ƒï¼Œå‚æ•°pè¡¨ç¤ºæ¦‚ç‡ã€‚

$$
P(k) = \frac{-p^k}{k \ln(1-p)}
$$

è¯¦è§ï¼š[Logarithmic distribution - Wikipedia](https://en.wikipedia.org/wiki/Logarithmic_distribution)

`logistic`é€»è¾‘åˆ†å¸ƒä¹Ÿå«å¢é•¿åˆ†å¸ƒï¼Œæ¥å—ä½ç½®å‚æ•°locå’Œå°ºåº¦å‚æ•°scaleã€‚

$$
P(x) = \frac{e^{-(x-\mu)/s}}{s(1+e^{-(x-\mu)/s})^2}
$$

### æ£€éªŒç›¸å…³

`chisquare`å¡æ–¹åˆ†å¸ƒéœ€æŒ‡å®šä¸€ä¸ªæˆ–ä¸€ç»„æµ®ç‚¹æ•°ï¼Œè¡¨ç¤ºè‡ªç”±åº¦çš„æ•°é‡ã€‚

$$
p(x) = \frac{(1/2)^{k/2}}{\Gamma(k/2)}
                 x^{k/2 - 1} e^{-x/2}
$$

`noncentral_chisquare`éä¸­å¿ƒå¡æ–¹åˆ†å¸ƒï¼Œå‚æ•°é™¤äº†å¡æ–¹åˆ†å¸ƒçš„è‡ªç”±åº¦å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªnoncå‚æ•°è¡¨ç¤ºéä¸­å¿ƒå‚æ•°Î»ã€‚

$$
P(x;df,nonc) = \sum^{\infty}_{i=0} \frac{e^{-nonc/2}(nonc/2)^{i}}{i!} P_{Y_{df+2i}}(x)
$$

Y_qæ˜¯è‡ªç”±åº¦ä¸ºqçš„å¡æ–¹åˆ†å¸ƒã€‚

`f`Fåˆ†å¸ƒåŒ…å«ä¸¤ä¸ªå‚æ•°ï¼šdfnumæ˜¯åˆ†å­çš„è‡ªç”±åº¦ï¼Œdfdenæ˜¯åˆ†æ¯çš„è‡ªç”±åº¦ï¼š

$$
{\begin{aligned}f(x;d_{1},d_{2})&={\frac  {{\sqrt  {{\frac  {(d_{1}\,x)^{{d_{1}}}\,\,d_{2}^{{d_{2}}}}{(d_{1}\,x+d_{2})^{{d_{1}+d_{2}}}}}}}}{x\,{\mathrm  {B}}\!\left({\frac  {d_{1}}{2}},{\frac  {d_{2}}{2}}\right)}}\\&={\frac  {1}{{\mathrm  {B}}\!\left({\frac  {d_{1}}{2}},{\frac  {d_{2}}{2}}\right)}}\left({\frac  {d_{1}}{d_{2}}}\right)^{{{\frac  {d_{1}}{2}}}}x^{{{\frac  {d_{1}}{2}}-1}}\left(1+{\frac  {d_{1}}{d_{2}}}\,x\right)^{{-{\frac  {d_{1}+d_{2}}{2}}}}\end{aligned}}
$$

æ›´å¤šè¯¦è§ï¼š[F-distribution - Wikipedia](https://en.wikipedia.org/wiki/F-distribution)

`noncentral_f`éä¸­å¿ƒFåˆ†å¸ƒæ¯”Fåˆ†å¸ƒå¤šäº†ä¸€ä¸ªnoncå‚æ•°ï¼Œè¡¨ç¤ºéä¸­å¿ƒå‚æ•°Î»ã€‚

$$
p(f)=\sum \limits _{{k=0}}^{\infty }{\frac  {e^{{-\lambda /2}}(\lambda /2)^{k}}{B\left({\frac  {\nu _{2}}{2}},{\frac  {\nu _{1}}{2}}+k\right)k!}}\left({\frac  {\nu _{1}}{\nu _{2}}}\right)^{{{\frac  {\nu _{1}}{2}}+k}}\left({\frac  {\nu _{2}}{\nu _{2}+\nu _{1}f}}\right)^{{{\frac  {\nu _{1}+\nu _{2}}{2}}+k}}f^{{\nu _{1}/2-1+k}}\\
B(x,y)={\frac  {\Gamma (x)\Gamma (y)}{\Gamma (x+y)}}.
$$

æ›´å¤šè¯¦è§ï¼š[Noncentral F-distribution - Wikipedia](https://en.wikipedia.org/wiki/Noncentral_F-distribution)

`standard_t`æ˜¯å­¦ç”Ÿtåˆ†å¸ƒï¼Œå‚æ•°dfä¸ºè‡ªç”±åº¦ã€‚


$$
P(x, df) = \frac{\Gamma(\frac{df+1}{2})}{\sqrt{\pi df} \Gamma(\frac{df}{2})}\Bigl( 1+\frac{x^2}{df} \Bigr)^{-(df+1)/2}
$$

ä¸»è¦ç”¨äºæ£€éªŒæ˜¯å¦å±äºæ­£æ€åˆ†å¸ƒï¼Œä»¥æ–‡æ¡£ä¸­å¥³æ€§å¡è·¯é‡Œæ‘„å…¥ä¸ºä¾‹ï¼š


```python
# 11 ä¸ªå¥³æ€§æ—¥å¡è·¯é‡Œæ‘„å…¥
intake = np.array([5260., 5470, 5640, 6180, 6390, 
                   6515, 6805, 7515, 7515, 8230, 8770])
```

ä¸Šé¢çš„ç»“æœæ˜¯å¦ç³»ç»Ÿåœ°åç¦»äº†æ¨èçš„7725KJï¼Ÿæˆ‘ä»¬éœ€è¦å…ˆæ¥ä¸€ä¸ªé›¶å‡è®¾ï¼šå³å‡è®¾æ²¡æœ‰åå·®ï¼Œæ›¿ä»£å‡è®¾æ˜¯å­˜åœ¨æ­£é¢æˆ–è´Ÿé¢å½±å“ï¼Œæ˜¯ä¸€ä¸ªåŒå°¾çš„åˆ†å¸ƒã€‚

11ä¸ªå€¼å¯¹åº”10ä¸ªè‡ªç”±åº¦ï¼Œæ˜¾è‘—æ°´å¹³è®¾ä¸º95%ï¼Œè®¡ç®—æ ‡å‡†å·®ï¼š


```python
np.std(intake, ddof=1)
```




    1142.1232221373727




```python
# Tç»Ÿè®¡é‡
t = (np.mean(intake) - 7725) / \
(np.std(intake, ddof=1) / np.sqrt(len(intake)))
t 
```




    -2.8207540608310198




```python
# ç”Ÿæˆå­¦ç”Ÿtåˆ†å¸ƒï¼ˆè‡ªç”±åº¦10ï¼‰
s = rng.standard_t(10, 10000)
```


```python
# è®¡ç®—på€¼ï¼Œè¿œå°äº0.05ï¼Œæ‰€ä»¥æ‹’ç»åŸå‡è®¾ï¼Œè®¤ä¸ºå®ƒä»¬æ˜¯æœ‰åå·®çš„
np.sum(np.abs(t) < np.abs(s)) / len(s)
```




    0.0185



## å°ç»“

## å‚è€ƒ

- [Random Generator â€” NumPy v1.24.dev0 Manual](https://numpy.org/devdocs/reference/random/generator.html)


```python

```
