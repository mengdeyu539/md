<h1>Table of Contents<span class="tocSkip"></span></h1>
<div class="toc"><ul class="toc-item"><li><span><a href="#å¹¿æ’­" data-toc-modified-id="å¹¿æ’­-1"><span class="toc-item-num">1&nbsp;&nbsp;</span>å¹¿æ’­</a></span></li><li><span><a href="#é€šå‡½æ•°" data-toc-modified-id="é€šå‡½æ•°-2"><span class="toc-item-num">2&nbsp;&nbsp;</span>é€šå‡½æ•°</a></span></li><li><span><a href="#åŸºæœ¬æ“ä½œ" data-toc-modified-id="åŸºæœ¬æ“ä½œ-3"><span class="toc-item-num">3&nbsp;&nbsp;</span>åŸºæœ¬æ“ä½œ</a></span><ul class="toc-item"><li><span><a href="#Shape" data-toc-modified-id="Shape-3.1"><span class="toc-item-num">3.1&nbsp;&nbsp;</span>Shape</a></span></li><li><span><a href="#è½´å˜æ¢" data-toc-modified-id="è½´å˜æ¢-3.2"><span class="toc-item-num">3.2&nbsp;&nbsp;</span>è½´å˜æ¢</a></span></li><li><span><a href="#ç»´åº¦" data-toc-modified-id="ç»´åº¦-3.3"><span class="toc-item-num">3.3&nbsp;&nbsp;</span>ç»´åº¦</a></span></li><li><span><a href="#æ„é€ " data-toc-modified-id="æ„é€ -3.4"><span class="toc-item-num">3.4&nbsp;&nbsp;</span>æ„é€ </a></span></li><li><span><a href="#å¢åˆ å…ƒç´ " data-toc-modified-id="å¢åˆ å…ƒç´ -3.5"><span class="toc-item-num">3.5&nbsp;&nbsp;</span>å¢åˆ å…ƒç´ </a></span></li><li><span><a href="#é‡æ’å…ƒç´ " data-toc-modified-id="é‡æ’å…ƒç´ -3.6"><span class="toc-item-num">3.6&nbsp;&nbsp;</span>é‡æ’å…ƒç´ </a></span></li></ul></li><li><span><a href="#æ’åºæœç´¢" data-toc-modified-id="æ’åºæœç´¢-4"><span class="toc-item-num">4&nbsp;&nbsp;</span>æ’åºæœç´¢</a></span><ul class="toc-item"><li><span><a href="#æå€¼" data-toc-modified-id="æå€¼-4.1"><span class="toc-item-num">4.1&nbsp;&nbsp;</span>æå€¼</a></span></li><li><span><a href="#æœç´¢" data-toc-modified-id="æœç´¢-4.2"><span class="toc-item-num">4.2&nbsp;&nbsp;</span>æœç´¢</a></span></li><li><span><a href="#æ’åº" data-toc-modified-id="æ’åº-4.3"><span class="toc-item-num">4.3&nbsp;&nbsp;</span>æ’åº</a></span></li></ul></li><li><span><a href="#é›†åˆæ“ä½œ" data-toc-modified-id="é›†åˆæ“ä½œ-5"><span class="toc-item-num">5&nbsp;&nbsp;</span>é›†åˆæ“ä½œ</a></span><ul class="toc-item"><li><span><a href="#åŒ…å«" data-toc-modified-id="åŒ…å«-5.1"><span class="toc-item-num">5.1&nbsp;&nbsp;</span>åŒ…å«</a></span></li><li><span><a href="#äº¤é›†" data-toc-modified-id="äº¤é›†-5.2"><span class="toc-item-num">5.2&nbsp;&nbsp;</span>äº¤é›†</a></span></li><li><span><a href="#å¹¶é›†" data-toc-modified-id="å¹¶é›†-5.3"><span class="toc-item-num">5.3&nbsp;&nbsp;</span>å¹¶é›†</a></span></li><li><span><a href="#å·®é›†" data-toc-modified-id="å·®é›†-5.4"><span class="toc-item-num">5.4&nbsp;&nbsp;</span>å·®é›†</a></span></li><li><span><a href="#å¼‚æˆ–é›†" data-toc-modified-id="å¼‚æˆ–é›†-5.5"><span class="toc-item-num">5.5&nbsp;&nbsp;</span>å¼‚æˆ–é›†</a></span></li></ul></li><li><span><a href="#å‡½æ•°å¼ç¼–ç¨‹" data-toc-modified-id="å‡½æ•°å¼ç¼–ç¨‹-6"><span class="toc-item-num">6&nbsp;&nbsp;</span>å‡½æ•°å¼ç¼–ç¨‹</a></span></li><li><span><a href="#æµ‹è¯•" data-toc-modified-id="æµ‹è¯•-7"><span class="toc-item-num">7&nbsp;&nbsp;</span>æµ‹è¯•</a></span><ul class="toc-item"><li><span><a href="#ç›¸ç­‰" data-toc-modified-id="ç›¸ç­‰-7.1"><span class="toc-item-num">7.1&nbsp;&nbsp;</span>ç›¸ç­‰</a></span></li><li><span><a href="#ç›¸è¿‘" data-toc-modified-id="ç›¸è¿‘-7.2"><span class="toc-item-num">7.2&nbsp;&nbsp;</span>ç›¸è¿‘</a></span></li><li><span><a href="#å°äº" data-toc-modified-id="å°äº-7.3"><span class="toc-item-num">7.3&nbsp;&nbsp;</span>å°äº</a></span></li><li><span><a href="#å¼‚å¸¸" data-toc-modified-id="å¼‚å¸¸-7.4"><span class="toc-item-num">7.4&nbsp;&nbsp;</span>å¼‚å¸¸</a></span></li></ul></li><li><span><a href="#å°ç»“" data-toc-modified-id="å°ç»“-8"><span class="toc-item-num">8&nbsp;&nbsp;</span>å°ç»“</a></span></li><li><span><a href="#å‚è€ƒ" data-toc-modified-id="å‚è€ƒ-9"><span class="toc-item-num">9&nbsp;&nbsp;</span>å‚è€ƒ</a></span></li></ul></div>


```python
import numpy as np
np.__version__
```




    '1.22.3'



æ–‡æ¡£é˜…è¯»è¯´æ˜ï¼š

- ğŸ§ è¡¨ç¤º Tip
- âš ï¸ è¡¨ç¤ºæ³¨æ„äº‹é¡¹

## å¹¿æ’­

å¹¿æ’­æè¿°äº†NumPyåœ¨æ•°å€¼è®¡ç®—å¦‚ä½•å¤„ç†ä¸åŒå½¢çŠ¶çš„æ•°ç»„ã€‚åœ¨ä¸€å®šé™åˆ¶æ¡ä»¶ä¸‹ï¼Œå°æ•°ç»„ä¼šå¹¿æ’­åˆ°å¤§æ•°ç»„ä»¥é€‚é…å…¶å½¢çŠ¶ã€‚


```python
# æœ€ç®€å•çš„ä¾‹å­
a = np.array([1., 2., 3.])
a
```




    array([1., 2., 3.])




```python
a * 2
```




    array([2., 4., 6.])




```python
# ä¸Šé¢çš„ä¾‹å­ç­‰ä»·äº
b = np.array([2, 2, 2])
a * b
```




    array([2., 4., 6.])



å¹¿æ’­çš„è§„åˆ™å¦‚ä¸‹ï¼š

- ä»å³åˆ°å·¦æ¯”è¾ƒ
- å…¼å®¹æ—¶ç›¸ç­‰æˆ–æŸä¸ªç»´åº¦ä¸º1
- æ•°ç»„å¯ä»¥ä¸åŒç»´åº¦


```python
a = np.ones((8, 1, 6, 1))
b = np.ones((7, 1, 5))
```


```python
# b ç­‰ä»·äºå˜æˆäº† (1, 7, 1, 5) çš„shape
c = a + b
c.shape
```




    (8, 7, 6, 5)




```python
# ä¸èƒ½å¹¿æ’­çš„ä¾‹å­
a = np.ones((2, 3, 4))
b = np.ones((2, 3))
a + b
```


    ---------------------------------------------------------------------------

    ValueError                                Traceback (most recent call last)

    <ipython-input-475-796f45d71953> in <module>
          2 a = np.ones((2, 3, 4))
          3 b = np.ones((2, 3))
    ----> 4 a + b
    

    ValueError: operands could not be broadcast together with shapes (2,3,4) (2,3) 



```python
# å½“ç„¶ä¸€ç»´å‘é‡æ•°å­—çš„æ•°é‡å°±æ˜¯ç»´åº¦
# è¿™æ ·æ˜¯ä¸è¡Œçš„
a = np.ones((2, 3))
b = np.ones((2, ))
b.shape
```




    (2,)




```python
a + b
```


    ---------------------------------------------------------------------------

    ValueError                                Traceback (most recent call last)

    <ipython-input-472-bd58363a63fc> in <module>
    ----> 1 a + b
    

    ValueError: operands could not be broadcast together with shapes (2,3) (2,) 



```python
# è¿™æ ·å°±å¯ä»¥
b = np.ones((3, ))
a + b
```




    array([[2., 2., 2.],
           [2., 2., 2.]])



å¤§éƒ¨åˆ†æ—¶å€™æˆ‘ä»¬å¯ä»¥æ— ä¼¤åœ°ä½¿ç”¨å®ƒï¼Œä½†å½“æ•°æ®é‡å¾ˆå¤§æ—¶ï¼Œå¹¿æ’­ä¼šå¤åˆ¶æ•°ç»„ï¼Œå¯èƒ½ä¼šå¯¼è‡´å†…å­˜æº¢å‡ºã€‚


```python
rng = np.random.default_rng(42)
a = rng.random((102400, 256, 64))
b = rng.random((102400, 256))
c = rng.random((256, 64))
```


```python
# a=12.5G
102400*256*64*8/1024/1024/1024
```




    12.5




```python
# å¦‚æœå†…å­˜å°äº25Gï¼Œè¿™é‡Œä¼šè¶…å‡ºå†…å­˜ï¼Œå› ä¸ºå·®çš„ç»“æœè¿˜æ˜¯ä¼šå­˜åœ¨ä¸´æ—¶ç©ºé—´
a[:] = b[:, :, np.newaxis] - c
```


```python
# å¯ä»¥ç”¨ä¹‹å‰æåˆ°çš„ out å‚æ•°ï¼Œä¸ä¼šé¢å¤–å¢åŠ å†…å­˜
d = np.subtract(b[:, :, np.newaxis], c, out=a)
```

ä¸è¿‡ï¼Œä¸€èˆ¬ä¼šä½¿ç”¨è™šæ‹Ÿå†…å­˜ï¼Œä¸ç”¨è¿‡äºæ‹…å¿ƒã€‚

## é€šå‡½æ•°

é€šå‡½æ•°ï¼ˆufuncï¼‰æ˜¯ä»¥é€ä¸ªå…ƒç´ çš„æ–¹å¼å¯¹ndarrayè¿›è¡Œæ“ä½œçš„å‡½æ•°ï¼Œæ”¯æŒæ•°ç»„å¹¿æ’­ã€ç±»å‹è½¬æ¢ç­‰ã€‚åœ¨NumPyä¸­ï¼Œé€šç”¨å‡½æ•°éƒ½æ˜¯`np.ufunc`çš„å®ä¾‹ã€‚


```python
isinstance(np.add, np.ufunc)
```




    True



`+`æ˜¯`np.add`çš„å¿«æ·æ–¹å¼ï¼Œå…¶ä»–çš„å‡½æ•°ä¹Ÿç±»ä¼¼ï¼š


```python
x1 = np.arange(9).reshape((3, 3))
x2 = np.arange(3)
```


```python
x1 + x2
```




    array([[ 0,  2,  4],
           [ 3,  5,  7],
           [ 6,  8, 10]])




```python
np.add(x1, x2)
```




    array([[ 0,  2,  4],
           [ 3,  5,  7],
           [ 6,  8, 10]])




```python
x1 * x2
```




    array([[ 0,  1,  4],
           [ 0,  4, 10],
           [ 0,  7, 16]])




```python
np.multiply(x1, x2)
```




    array([[ 0,  1,  4],
           [ 0,  4, 10],
           [ 0,  7, 16]])



out å‚æ•°ä¸»è¦æ˜¯ç”¨æ¥å­˜å‚¨è®¡ç®—ç»“æœï¼š


```python
x3 = np.zeros((3, 3), dtype=np.int8)
x3
```




    array([[0, 0, 0],
           [0, 0, 0],
           [0, 0, 0]], dtype=int8)




```python
np.add(x1, x2, out=x3)
```




    array([[ 0,  2,  4],
           [ 3,  5,  7],
           [ 6,  8, 10]], dtype=int8)




```python
x3
```




    array([[ 0,  2,  4],
           [ 3,  5,  7],
           [ 6,  8, 10]], dtype=int8)



where å‚æ•°ç¡®å®šå“ªäº›å¯ä»¥å­˜å‚¨ï¼š


```python
x4 = np.zeros((3, 3), dtype=np.int8)
x4
```




    array([[0, 0, 0],
           [0, 0, 0],
           [0, 0, 0]], dtype=int8)




```python
np.add(x1, x2, out=x4, where=[True, False, False])
```




    array([[0, 0, 0],
           [3, 0, 0],
           [6, 0, 0]], dtype=int8)




```python
x4
```




    array([[0, 0, 0],
           [3, 0, 0],
           [6, 0, 0]], dtype=int8)



NumPyä¸­çš„ufuncæ•°é‡å¾ˆå¤šï¼ŒåŒ…æ‹¬æ•°å­¦è¿ç®—ã€ä¸‰è§’å‡½æ•°ã€ä½æ“ä½œã€é€»è¾‘å‡½æ•°ã€æµ®ç‚¹å‡½æ•°ç­‰ï¼Œå…·ä½“å¯æŸ¥çœ‹ï¼š

- https://numpy.org/devdocs/reference/ufuncs.html#available-ufuncs

ufuncå¯ä»¥è¢«`__array_ufunc__`æ–¹æ³•è¦†ç›–ï¼Œå…·ä½“å¯å‚è€ƒç¬¬ä¸€ç« ã€Šæ ¸å¿ƒæ¦‚å¿µï¼šè‡ªå®šä¹‰æ•°ç»„å®¹å™¨ã€‹ã€‚

ufuncæ”¯æŒä»¥ä¸‹æ–¹æ³•ï¼š

- reduceï¼šæ²¿ç€æŸä¸ªç»´åº¦ç´¯ç§¯
- accumulateï¼šæ‰€æœ‰å…ƒç´ ç´¯ç§¯
- reduceatï¼šæ²¿ç€æŸä¸ªç»´åº¦æŒ‡å®šçš„sliceç´¯ç§¯
- outerï¼šå¯¹Aå’ŒBä¸­æ‰€æœ‰å…ƒç´ å¯¹è¿ç®—
- atï¼šå¯¹æŒ‡å®šç´¢å¼•çš„å…ƒç´ çš„æ‰§è¡Œæ— ç¼“å†²çš„å°±åœ°è¿ç®—


```python
a = np.arange(12).reshape(4, 3)
a
```




    array([[ 0,  1,  2],
           [ 3,  4,  5],
           [ 6,  7,  8],
           [ 9, 10, 11]])



`reduce`çš„å‚æ•°å’Œåˆçº§è¯¾ç¨‹ä»‹ç»çš„å¾ˆå¤šæ¥å£å·®ä¸å¤šï¼š

- arrayï¼šæ•°ç»„
- axisï¼šç»´åº¦
- dtypeï¼šæ•°æ®ç±»å‹
- outï¼šåŒä¸Š
- whereï¼šåŒä¸Š
- keepdimsï¼šæ˜¯å¦ä¿æŒç»´åº¦ï¼Œã€ŠåŸºç¡€æ•™ç¨‹ã€‹ä¸­æœ‰ä»‹ç»
- initialï¼šåˆå§‹å€¼


```python
np.add.reduce(a, axis=0, initial=10)
```




    array([28, 32, 36])




```python
np.add.reduce(a, axis=1, initial=10, keepdims=True)
```




    array([[13],
           [22],
           [31],
           [40]])



`accumulate`çš„å‚æ•°å°‘å¾ˆå¤šï¼š

- arrayï¼šæ•°ç»„
- axisï¼šç»´åº¦
- dtypeï¼šæ•°æ®ç±»å‹
- outï¼šåŒä¸Š


```python
a
```




    array([[ 0,  1,  2],
           [ 3,  4,  5],
           [ 6,  7,  8],
           [ 9, 10, 11]])




```python
# æ²¿ç€è¡Œ
np.multiply.accumulate(a, axis=1)
```




    array([[  0,   0,   0],
           [  3,  12,  60],
           [  6,  42, 336],
           [  9,  90, 990]])




```python
np.multiply.accumulate(a)
```




    array([[  0,   1,   2],
           [  0,   4,  10],
           [  0,  28,  80],
           [  0, 280, 880]])



`reduceat`ç›¸æ¯”`accumulate`å¢åŠ äº†ç´¢å¼•ä½ç½®ï¼š

- indicesï¼šindexçš„å¤æ•°
- å…¶ä»–å‚æ•°åŒ`accumulate`


è®¡ç®— `array[indices[i]:indices[i+1]]`ï¼Œi è¡¨ç¤ºç¬¬iè¡Œ/åˆ—ï¼Œè®¡ç®—è§„åˆ™å¦‚ä¸‹ï¼š

- å½“`i = len(indices) - 1`ï¼ˆæœ€åä¸€ä¸ªindexï¼‰ï¼š`indices[i+1] = array.shape[axis]`
- å½“`indices[i] >= indices[i + 1]`ï¼Œç¬¬iä¸ªå°±æ˜¯ `array[indices[i]]`
- å½“`indices[i] >= len(array)` æˆ– `indices[i] < 0`ï¼Œé”™è¯¯


```python
a
```




    array([[ 0,  1,  2],
           [ 3,  4,  5],
           [ 6,  7,  8],
           [ 9, 10, 11]])




```python
np.add.reduceat(a, [1,2])
```




    array([[ 3,  4,  5],
           [15, 17, 19]])




```python
# å››åˆ—
# ç¬¬0åˆ—ï¼šindices[0]: indices[1]ï¼Œå³ç¬¬0:2ç´¯ç§¯ï¼ˆ0+1åˆ—ï¼‰
# ç¬¬1åˆ—ï¼šindices[1] > indices[2]ï¼Œç­‰äºç¬¬2åˆ—
# ç¬¬2åˆ—ï¼šindices[2] > indices[3]ï¼Œç­‰äºç¬¬1åˆ—
# ç¬¬3åˆ—ï¼šæœ€åä¸€ä¸ªï¼Œindices[3]: indices[a.shape[1]=3]ï¼Œç­‰äº0:3ç´¯ç§¯ï¼ˆ0,1,2åˆ—ï¼‰
np.add.reduceat(a, [0, 2, 1, 0], axis=1)
```




    array([[ 1,  2,  1,  3],
           [ 7,  5,  4, 12],
           [13,  8,  7, 21],
           [19, 11, 10, 30]])



`outer`æ¥å—ä¸¤ä¸ªæ•°ç»„ï¼Œç­‰ä»·äºä»¥ä¸‹ç»“æœï¼š

```python
r = empty(len(A),len(B))
for i in range(len(A)):
    for j in range(len(B)):
        r[i,j] = op(A[i], B[j])
```


```python
np.add.outer(a, a).shape
```




    (4, 3, 4, 3)




```python
np.add.outer([1,2,3], [4,5,6])
```




    array([[5, 6, 7],
           [6, 7, 8],
           [7, 8, 9]])



`at` å‚æ•°å¦‚ä¸‹ï¼š

- aï¼šæ•°ç»„
- indicesï¼šç´¢å¼•
- bï¼šä¸¤ä¸ªæ“ä½œå¯¹è±¡æ—¶å¦ä¸€ä¸ªæ“ä½œå¯¹è±¡


```python
a = np.arange(12).reshape(4, 3)
a
```




    array([[ 0,  1,  2],
           [ 3,  4,  5],
           [ 6,  7,  8],
           [ 9, 10, 11]])




```python
# å¯¹ç¬¬0å’Œ1è¡ŒåŠ 1
np.add.at(a, [0, 1], [1])
```


```python
a
```




    array([[ 1,  2,  3],
           [ 4,  5,  6],
           [ 6,  7,  8],
           [ 9, 10, 11]])




```python
# 4x3 å’Œ 1x3 å¯ä»¥é€šè¿‡å¹¿æ’­è¿ç®—
a = np.arange(12).reshape(4, 3)
a
```




    array([[ 0,  1,  2],
           [ 3,  4,  5],
           [ 6,  7,  8],
           [ 9, 10, 11]])




```python
np.add.at(a, [0, 1], np.array([[1, 2, 3]]))
a
```




    array([[ 1,  3,  5],
           [ 4,  6,  8],
           [ 6,  7,  8],
           [ 9, 10, 11]])



å¯ä»¥ä½¿ç”¨`np.frompyfunc`æ¥ç”Ÿæˆé€šå‡½æ•°å®ä¾‹ã€‚æœ¬ç« åé¢ä¼šè¿›ä¸€æ­¥ä»‹ç»ï¼Œä¸å†èµ˜è¿°ã€‚

## åŸºæœ¬æ“ä½œ

å…¶ä¸­ä¸å°‘å¸¸ç”¨çš„æ“ä½œæˆ‘ä»¬åœ¨ã€Šä»å…¥é—¨åˆ°å°ç™½ã€‹ä¸­å·²æœ‰ä»‹ç»ï¼Œæ¯”å¦‚`shape`, `reshape`, `squeeze`, `expand_dims`, `stack`, `concatenate`, `split`, `repeat`ç­‰ï¼Œæ¥ä¸‹æ¥å°±ä»‹ç»ä¸‹å‰©ä¸‹çš„ä¸€äº›ä½¿ç”¨é¢‘ç‡ç¨ä½ä½†ä¹Ÿæ¯”è¾ƒé‡è¦çš„æ“ä½œã€‚

### Shape


```python
rng = np.random.default_rng(42)
a = rng.integers(0, 10, (3, 4))
a
```




    array([[0, 7, 6, 4],
           [4, 8, 0, 6],
           [2, 0, 5, 9]])




```python
# flat
list(a.flat)
```




    [0, 7, 6, 4, 4, 8, 0, 6, 2, 0, 5, 9]




```python
# è¿”å›copy
a.flatten()
```




    array([0, 7, 6, 4, 4, 8, 0, 6, 2, 0, 5, 9])




```python
# ä¸åŒçš„Style
a.flatten("F")
```




    array([0, 4, 2, 7, 8, 0, 6, 0, 5, 4, 6, 9])




```python
# è¿”å›view
np.ravel(a)
```




    array([0, 7, 6, 4, 4, 8, 0, 6, 2, 0, 5, 9])




```python
np.ravel(a, "F")
```




    array([0, 4, 2, 7, 8, 0, 6, 0, 5, 4, 6, 9])



### è½´å˜æ¢


```python
a = np.ones((3, 4, 5))
```


```python
np.moveaxis(a, 0, 1).shape
```




    (4, 3, 5)




```python
# åæ ‡è½´çš„å€¼å¯ä»¥æ˜¯æ•°ç»„
np.moveaxis(a, [0, 2], [1, 0]).shape
```




    (5, 3, 4)




```python
# åæ ‡è½´çš„å€¼å¿…é¡»æ˜¯æ•´æ•°
np.swapaxes(a, 0, 1).shape
```




    (4, 3, 5)



### ç»´åº¦


```python
np.atleast_1d(1)
```




    array([1])




```python
np.atleast_1d(1, 2)
```




    [array([1]), array([2])]




```python
np.atleast_2d(1, 2)
```




    [array([[1]]), array([[2]])]




```python
a = np.ones((2, 3))
```


```python
np.atleast_3d(a).shape
```




    (2, 3, 1)



### æ„é€ 

`block`ç»å¸¸è¢«ç”¨äºæ„å»ºblockçŸ©é˜µã€‚


```python
a = np.eye(2)*2
b = np.eye(3)*3
```


```python
np.block([
    [a, np.zeros((2, 3))],
    [np.ones((3, 2)), b]
])
```




    array([[2., 0., 0., 0., 0.],
           [0., 2., 0., 0., 0.],
           [1., 1., 3., 0., 0.],
           [1., 1., 0., 3., 0.],
           [1., 1., 0., 0., 3.]])



å¦å¤–ï¼Œblockåœ¨æŸäº›æƒ…å†µä¸‹ç­‰ä»·äºå…¶ä»–å‡ ä¸ªAPIï¼š

- depth=1æ—¶ï¼Œå¯ä»¥ä½œä¸º`hstack`
- depth=2æ—¶ï¼Œå¯ä»¥ä½œä¸º`vstack`
- å¯ä»¥æ›¿æ¢`atleast_1d`å’Œ`atleast_2d`

ã€Šä»å°ç™½åˆ°å…¥é—¨ã€‹ä¸­æˆ‘ä»¬æè¿‡ï¼Œ`concatenate`å’Œ`hstack`, `vstack`, `dstack`æ˜¯å¯ä»¥é€šç”¨çš„ï¼Œå‰è€…åŠ ä¸Šä¸åŒçš„ç»´åº¦å°±å¯ä»¥è¾¾åˆ°åå‡ è€…çš„æ•ˆæœã€‚

ä¸è¿‡åå‡ ä¸ªæ˜¯å¯ä»¥å¤„ç†0ç»´çš„ï¼ˆä¹Ÿå°±æ˜¯æ•´æ•°ï¼‰ï¼Œå‰è€…ä¸å¯ä»¥ï¼›å¤„ç†å‘é‡æ—¶ä¹Ÿæœ‰ä¸€äº›ä¸åŒã€‚å¦‚æœæ˜¯äºŒç»´ä»¥ä¸Šçš„ï¼Œå»ºè®®è¿˜æŒ‰ç…§ä¹‹å‰çš„åšæ³•ï¼›å¯¹äºä¸€ç»´æˆ–é›¶ç»´çš„ï¼Œä¹Ÿå¯ä»¥å…ˆå¤„ç†ä¸€ä¸‹å†æŒ‰ä¹‹å‰çš„åšæ³•ã€‚


```python
a = np.array([0, 1, 2])
```


```python
np.hstack((a, 3))
```




    array([0, 1, 2, 3])




```python
# è¿™æ ·æ–¹å¯ä»¥
np.concatenate((a, [3]))
```




    array([0, 1, 2, 3])




```python
np.vstack((a, (3,4,5)))
```




    array([[0, 1, 2],
           [3, 4, 5]])




```python
np.concatenate((np.atleast_2d(a), [[3,4,5]]))
```




    array([[0, 1, 2],
           [3, 4, 5]])



`tile`ç”¨äºæ„å»ºå¯¹è¾“å…¥æ•°ç»„å€¼é‡å¤ç»™å®šæ¬¡æ•°çš„æ•°ç»„ã€‚


```python
a = np.array([0, 1, 2])
```


```python
np.tile(a, 2)
```




    array([0, 1, 2, 0, 1, 2])



æ³¨æ„ä¸`repeat`çš„åŒºåˆ«ï¼š


```python
np.repeat(a, 2)
```




    array([0, 0, 1, 1, 2, 2])



å¯ä»¥æŒ‡å®šé‡å¤å¤šä¸ªç»´åº¦ï¼š


```python
np.tile(a, (2, 2, 2)).shape
```




    (2, 2, 6)



å¯¹äºå¤šç»´æ•°ç»„ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼š


```python
b = np.array([[1,2], [3,4]])
```


```python
np.tile(b, 2)
```




    array([[1, 2, 1, 2],
           [3, 4, 3, 4]])




```python
np.repeat(b, 2, axis=1)
```




    array([[1, 1, 2, 2],
           [3, 3, 4, 4]])




```python
np.tile(b, (4, 1)).shape
```




    (8, 2)



### å¢åˆ å…ƒç´ 

`delte`ç”¨æ¥åˆ é™¤å…ƒç´ ï¼Œå¦‚æœä¸æŒ‡å®šaxisï¼Œåˆ™ä¼šè¢«æ‰“å¹³ï¼›å¦åˆ™ä¼šåˆ é™¤å¯¹åº”indexçš„æ‰€æœ‰å…ƒç´ ã€‚


```python
a = np.arange(6).reshape(3, 2)
a
```




    array([[0, 1],
           [2, 3],
           [4, 5]])




```python
np.delete(a, 5)
```




    array([0, 1, 2, 3, 4])




```python
np.delete(a, [3, 5])
```




    array([0, 1, 2, 4])




```python
# æŒ‡å®šaxis=0ï¼Œåˆ é™¤è¡Œ
np.delete(a, 1, 0)
```




    array([[0, 1],
           [4, 5]])



`insert`ç”¨æ¥æ’å…¥å…ƒç´ ï¼Œä¸åˆ é™¤ç±»ä¼¼ã€‚


```python
a
```




    array([[0, 1],
           [2, 3],
           [4, 5]])




```python
# åœ¨index=1çš„ä½ç½®æ’å…¥-1ï¼Œä¸æŒ‡å®šaxis
np.insert(a, 1, -1)
```




    array([ 0, -1,  1,  2,  3,  4,  5])




```python
# åœ¨index=[1,2]çš„ä½ç½®æ’å…¥-1ï¼Œä¸æŒ‡å®šaxis
np.insert(a, [1,2], -1)
```




    array([ 0, -1,  1, -1,  2,  3,  4,  5])




```python
# åœ¨index=1çš„ä½ç½®æ’å…¥[-1, -2]ï¼Œä¸æŒ‡å®šaxis
np.insert(a, 1, [-1, -2])
```




    array([ 0, -1, -2,  1,  2,  3,  4,  5])




```python
# åœ¨index=[1,2]çš„ä½ç½®æ’å…¥[-1, -2]ï¼Œä¸æŒ‡å®šaxis
np.insert(a, [1,2], [-1, -2])
```




    array([ 0, -1,  1, -2,  2,  3,  4,  5])




```python
# æŒ‡å®šaxisï¼Œindex=1çš„ä½ç½®æ’å…¥
np.insert(a, 1, -1, axis=0)
```




    array([[ 0,  1],
           [-1, -1],
           [ 2,  3],
           [ 4,  5]])




```python
# index=1çš„ä½ç½®æ’å…¥ä¸åŒå€¼
np.insert(a, 1, [-1, -2], axis=0)
```




    array([[ 0,  1],
           [-1, -2],
           [ 2,  3],
           [ 4,  5]])




```python
np.insert(a, [1,2], -1, axis=0)
```




    array([[ 0,  1],
           [-1, -1],
           [ 2,  3],
           [-1, -1],
           [ 4,  5]])




```python
np.insert(a, [1,2], [-1, -2], axis=0)
```




    array([[ 0,  1],
           [-1, -2],
           [ 2,  3],
           [-1, -2],
           [ 4,  5]])




```python
np.insert(a, [1,2], [[-1, -2]], axis=0)
```




    array([[ 0,  1],
           [-1, -2],
           [ 2,  3],
           [-1, -2],
           [ 4,  5]])



`append`ç±»ä¼¼äºPythonçš„appendã€‚


```python
np.append(a, 1)
```




    array([0, 1, 2, 3, 4, 5, 1])




```python
np.append(a, [1,2])
```




    array([0, 1, 2, 3, 4, 5, 1, 2])




```python
a
```




    array([[0, 1],
           [2, 3],
           [4, 5]])




```python
np.append(a, [[6,7]], axis=0)
```




    array([[0, 1],
           [2, 3],
           [4, 5],
           [6, 7]])




```python
np.append(a, [[6],[7],[8]], axis=1)
```




    array([[0, 1, 6],
           [2, 3, 7],
           [4, 5, 8]])



`trim_zeros`ç”¨äºæ¸…ç†ä¸€ç»´æ•°ç»„æˆ–åºåˆ—çš„é›¶å€¼ã€‚


```python
a = np.array((0, 0, 0, 1, 2, 3, 0, 2, 1, 0))
np.trim_zeros(a)
```




    array([1, 2, 3, 0, 2, 1])




```python
np.trim_zeros(a, "b")
```




    array([0, 0, 0, 1, 2, 3, 0, 2, 1])




```python
np.trim_zeros(a, "f")
```




    array([1, 2, 3, 0, 2, 1, 0])



### é‡æ’å…ƒç´ 

`flip`ä¸»è¦æ˜¯ç¿»è½¬å…ƒç´ ï¼š


```python
a = np.arange(8).reshape((2,2,2))
```


```python
np.flip(a)
```




    array([[[7, 6],
            [5, 4]],
    
           [[3, 2],
            [1, 0]]])




```python
np.flip(a, [0,1,2])
```




    array([[[7, 6],
            [5, 4]],
    
           [[3, 2],
            [1, 0]]])




```python
np.flip(a, 0)
```




    array([[[4, 5],
            [6, 7]],
    
           [[0, 1],
            [2, 3]]])




```python
np.flip(a, 1)
```




    array([[[2, 3],
            [0, 1]],
    
           [[6, 7],
            [4, 5]]])




```python
np.flip(a, 2)
```




    array([[[1, 0],
            [3, 2]],
    
           [[5, 4],
            [7, 6]]])




```python
np.flip(a, [0,1])
```




    array([[[6, 7],
            [4, 5]],
    
           [[2, 3],
            [0, 1]]])



`roll`å’Œ`rot90`ç”¨äºæ—‹è½¬å…ƒç´ ï¼Œä¸è¿‡ä¸¤è€…å¹¶ä¸ä¸€æ ·ã€‚

`roll`ç”¨äºæ—‹è½¬ç»™å®šè½´çš„å…ƒç´ ï¼Œå‚æ•°åŒ…æ‹¬ï¼š

- æ•°ç»„
- shiftï¼šæ•´æ•°æˆ–å…ƒç»„æ•´æ•°ï¼Œæ—‹è½¬çš„æ•°é‡ï¼Œå¦‚æœæ˜¯tupleï¼Œè¦å’Œå¯¹åº”çš„axisä¸€æ ·é•¿
- axisï¼šåæ ‡è½´ï¼Œæ•´æ•°æˆ–å…ƒç»„æ•´æ•°ï¼Œé»˜è®¤ä¼šæ‰“å¹³åshiftï¼Œç„¶åå†reshapeå›å»


```python
a = np.arange(10)
```


```python
np.roll(a, 3)
```




    array([7, 8, 9, 0, 1, 2, 3, 4, 5, 6])




```python
np.roll(a, -2)
```




    array([2, 3, 4, 5, 6, 7, 8, 9, 0, 1])




```python
np.roll(a, (1, 2))
```




    array([7, 8, 9, 0, 1, 2, 3, 4, 5, 6])




```python
a = np.arange(10).reshape(2, 5)
a
```




    array([[0, 1, 2, 3, 4],
           [5, 6, 7, 8, 9]])




```python
np.roll(a, 1, axis=0)
```




    array([[5, 6, 7, 8, 9],
           [0, 1, 2, 3, 4]])




```python
np.roll(a, 1, axis=1)
```




    array([[4, 0, 1, 2, 3],
           [9, 5, 6, 7, 8]])




```python
np.roll(a, 1)
```




    array([[9, 0, 1, 2, 3],
           [4, 5, 6, 7, 8]])




```python
# ç­‰ä»·äº
np.roll(a.flatten(), 1).reshape((2, 5))
```




    array([[9, 0, 1, 2, 3],
           [4, 5, 6, 7, 8]])




```python
np.roll(a, -1)
```




    array([[1, 2, 3, 4, 5],
           [6, 7, 8, 9, 0]])




```python
# ä¸¤ä¸ªtupleç­‰é•¿
np.roll(a, (1, 1), axis=(1, 0))
```




    array([[9, 5, 6, 7, 8],
           [4, 0, 1, 2, 3]])




```python
# ä¸Šå¼ç­‰ä»·äº
np.roll(a, 1, axis=(1, 0))
```




    array([[9, 5, 6, 7, 8],
           [4, 0, 1, 2, 3]])




```python
np.roll(a, (2, 1), axis=(1, 0))
```




    array([[8, 9, 5, 6, 7],
           [3, 4, 0, 1, 2]])



`rot90`è¡¨ç¤ºæŒ‰æŒ‡å®šè½´æ—‹è½¬90Â°ï¼Œæ–¹å‘æ˜¯ä»ç¬¬ä¸€ä¸ªè½´åˆ°ç¬¬äºŒä¸ªè½´ã€‚å‚æ•°åŒ…æ‹¬ï¼š

- æ•°ç»„ï¼šäºŒç»´æˆ–æ›´é«˜ç»´
- kï¼šæ•´æ•°ï¼Œæ—‹è½¬æ¬¡æ•°ï¼Œé»˜è®¤1
- axesï¼šä¸¤ä¸ªä»¥ä¸Šå…ƒç´ çš„tupleï¼Œä¸”å…ƒç´ å¿…é¡»ä¸åŒï¼Œé»˜è®¤ï¼ˆ0,1ï¼‰


```python
a
```




    array([[0, 1, 2, 3, 4],
           [5, 6, 7, 8, 9]])




```python
np.rot90(a)
```




    array([[4, 9],
           [3, 8],
           [2, 7],
           [1, 6],
           [0, 5]])




```python
# 180Â°
np.rot90(a, 2)
```




    array([[9, 8, 7, 6, 5],
           [4, 3, 2, 1, 0]])




```python
# è½¬å›æ¥
np.rot90(a, 4)
```




    array([[0, 1, 2, 3, 4],
           [5, 6, 7, 8, 9]])




```python
# é¡ºæ—¶é’ˆ
np.rot90(a, 1, (1, 0))
```




    array([[5, 0],
           [6, 1],
           [7, 2],
           [8, 3],
           [9, 4]])



## æ’åºæœç´¢

### æå€¼

å…³äºæœ€å¤§æœ€å°å€¼çš„æ–¹æ³•ä¸å°‘ï¼Œæˆ‘ä»¬çœ‹çœ‹ã€‚

`np.maximum`å’Œ`np.minimum`æ˜¯é€šå‡½æ•°ï¼Œä»¥maxä¸ºä¾‹ï¼Œå…¶ä»–ç›¸å…³çš„è¿˜æœ‰`np.max`ï¼ˆç­‰ä»·çš„`np.amax`ï¼‰ï¼Œ`np.fmax`å’Œ`np.nanmax`ã€‚åŒºåˆ†å¦‚ä¸‹ï¼š

- `minimum`ï¼šä¸¤ä¸ªæ•°ç»„é€å…ƒç´ æ¯”è¾ƒ
- `fmax`ï¼šåŒä¸Šï¼Œä½†å¿½ç•¥ç¼ºå¤±å€¼
- `amax`ï¼šæ²¿ç€ç»™å®šç»´åº¦
- `nanmax`ï¼šåŒä¸Šï¼Œä½†å¿½ç•¥ç¼ºå¤±å€¼

æˆ‘ä»¬ä»¥æå¤§å€¼ä¸ºä¾‹ã€‚


```python
# ç­‰ä»·äº np.where(x1 >= x2, x1, x2)
np.fmax([np.nan, 2, 3], [1, 5, np.nan])
```




    array([1., 5., 3.])




```python
np.nanmax([[np.nan, 3, 5], [2, 1, np.nan]], axis=0)
```




    array([2., 3., 5.])



### æœç´¢

`argmax/argmin`æˆ‘ä»¬åœ¨ã€Šä»å°ç™½åˆ°å…¥é—¨ã€‹ä¸­å·²ç»åšäº†ä»‹ç»ï¼Œè¿™é‡Œä¸»è¦ä»‹ç»å¸¦éæ•°å€¼ï¼ˆNaNï¼‰çš„ç‰ˆæœ¬ï¼Œä»¥æå°å€¼ä¸ºä¾‹ã€‚


```python
a = np.array([
    [np.nan, 2, 3],
    [1, np.nan, 4]
])
```


```python
np.argmin(a, axis=0)
```




    array([0, 1, 0])




```python
np.nanargmin(a, axis=0)
```




    array([1, 0, 0])



`argwhere`å’Œã€Šä»å°ç™½åˆ°å…¥é—¨ã€‹ä¸­ä»‹ç»çš„`where`æœ‰æ‰€ä¸åŒï¼Œå®ƒè¿”å›æ‰€æœ‰é0å…ƒç´ çš„indexï¼Œæ˜¯`where`çš„å¼±åŒ–ç‰ˆæœ¬ã€‚


```python
a = np.arange(6).reshape(2, 3)
a
```




    array([[0, 1, 2],
           [3, 4, 5]])




```python
# é»˜è®¤è¿”å›é0çš„å…ƒç´ index
np.argwhere(a)
```




    array([[0, 1],
           [0, 2],
           [1, 0],
           [1, 1],
           [1, 2]])




```python
# è¿™ä¸ªä¸æ˜¯æŒ‡å®šæ¡ä»¶ï¼Œè€Œæ˜¯a>3æœ¬èº«æ˜¯ä¸ªæ•°ç»„
np.argwhere(a>3)
```




    array([[1, 1],
           [1, 2]])



å¯¹äºé0ä½ç½®çš„ç´¢å¼•ï¼Œè¿˜æœ‰ä¸¤ä¸ªAPIï¼š


```python
# è¿”å›é0å…ƒç´ çš„ç´¢å¼•
np.nonzero(a>2)
```




    (array([1, 1, 1]), array([0, 1, 2]))




```python
# è¿”å›æ‰“å¹³åçš„ç´¢å¼•
np.flatnonzero(a>2)
```




    array([3, 4, 5])



æœ€åæ˜¯`searchsorted`ï¼Œè¿”å›ç»™å®šå€¼åº”è¯¥æ’å…¥çš„ä½ç½®ç´¢å¼•ã€‚ç»™å®šçš„æ•°ç»„åº”ä¸ºä¸€ç»´ï¼Œä½†æ’å…¥çš„å€¼å¯ä»¥æ˜¯æ•°ç»„ã€‚å‚æ•°å¦‚ä¸‹ï¼š

- è¢«æ’å…¥çš„ä¸€ç»´æ•°ç»„ã€‚
- è¦æ’å…¥çš„å€¼ï¼Œæ•°ç»„ã€‚
- sideï¼šé»˜è®¤leftï¼Œç¬¬ä¸€ä¸ªåˆé€‚çš„ä½ç½®ï¼›rightä¸ºæœ€åä¸€ä¸ªåˆé€‚çš„ä½ç½®ã€‚
- sorterï¼šä¸€ç»´æ•°ç»„ï¼Œå¯é€‰çš„ç´¢å¼•ï¼Œå°†è¦æ’å…¥çš„æ•°ç»„æ’åºä¸ºå‡åºã€‚


```python
a = np.arange(1, 6)
b = np.array([3, 2, 1, 5, 4])
a
```




    array([1, 2, 3, 4, 5])




```python
np.searchsorted(a, 2)
```




    1




```python
np.searchsorted(b, 2)
```




    3




```python
# è¦æ’å…¥çš„å€¼å¯ä»¥æ˜¯å¤šç»´æ•°ç»„
np.searchsorted(a, [[2,2],[2,2]])
```




    array([[1, 1],
           [1, 1]])



sideæ§åˆ¶åœ¨æ‰€æœ‰åˆé€‚ä½ç½®ä¸­æ’å…¥ä½ç½®çš„indexï¼š


```python
np.searchsorted([1,1,1,1,1], 1, "right")
```




    5




```python
np.searchsorted([1,1,1,1,1], 1, "left")
```




    0



sorterè¡¨ç¤ºè¢«æ’å…¥æ•°ç»„å…ƒç´ çš„ç´¢å¼•ï¼Œè¯¥ç´¢å¼•å°†æ•°ç»„æŒ‰å‡åºæ’åˆ—ã€‚


```python
b
```




    array([3, 2, 1, 5, 4])




```python
np.searchsorted(b, 2)
```




    3




```python
# 1 2 3 4 5
np.searchsorted(b, 2, sorter=[2,1,0,4,3])
```




    1




```python
np.searchsorted([1,2,3,4,5],2)
```




    1




```python
# 5 4 3 2 1
np.searchsorted(b, 2, sorter=[3,4,0,1,2])
```




    0




```python
np.searchsorted([5,4,3,2,1],2)
```




    0



### æ’åº

`argsort`åœ¨ã€Šä»å°ç™½åˆ°å…¥é—¨ã€‹ä¸­å·²æœ‰ä»‹ç»ï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ã€‚è¿™é‡Œä»‹ç»å…¶ä»–å‡ ä¸ªå’Œæ’åºç›¸å…³çš„APIï¼š

- `sort/lexsort/ndarray.sort`ï¼šæ•°ç»„æ’åº
- `msort`ï¼šæ’åºç¬¬ä¸€è½´
- `sort_complex`ï¼šå¤æ•°æ’åº
- `prtition/argpartition/ndarray.partition`ï¼šéƒ¨åˆ†æ’åº


```python
rng = np.random.default_rng(42)
a = rng.integers(0, 10, (3, 4))
a
```




    array([[0, 7, 6, 4],
           [4, 8, 0, 6],
           [2, 0, 5, 9]])



`sort`åŒ…æ‹¬ä»¥ä¸‹å‚æ•°ï¼š

- æ•°ç»„
- axisï¼šé»˜è®¤æœ€åä¸€ä¸ªè½´ï¼ˆ-1ï¼‰
- kindï¼škindæ˜¯æ’åºç®—æ³•ï¼Œæ”¯æŒï¼šquicksortã€mergesortã€heapsortå’Œstableï¼Œé»˜è®¤quicksort
- orderï¼šç”¨æ¥æ’åºçš„fieldï¼ˆæ•°ç»„æœ‰fieldæ—¶ï¼‰

æ²¿ç€æœ€åä¸€ä¸ªç»´åº¦ï¼ˆé»˜è®¤ï¼‰æ’åºæ—¶ä¸åˆ›å»ºä¸´æ—¶å¤åˆ¶ï¼Œå› æ­¤é€Ÿåº¦æœ€å¿«ï¼Œä¸å ç”¨é¢å¤–ç©ºé—´ã€‚

stableä¼šæ ¹æ®è¢«æ’åºçš„æ•°æ®ç±»å‹è‡ªåŠ¨é€‰æ‹©æœ€ç¨³å®šçš„æ’åºç®—æ³•ã€‚


```python
# é»˜è®¤axis=-1
np.sort(a)
```




    array([[0, 4, 6, 7],
           [0, 4, 6, 8],
           [0, 2, 5, 9]])




```python
# æŒ‡å®šè½´
np.sort(a, axis=0)
```




    array([[0, 0, 0, 4],
           [2, 7, 5, 6],
           [4, 8, 6, 9]])




```python
# æŒ‡å®šæ’åºç®—æ³•
np.sort(a, kind="stable")
```




    array([[0, 4, 6, 7],
           [0, 4, 6, 8],
           [0, 2, 5, 9]])




```python
# æŒ‡å®šorder
# String, float16, int32
dtype = [("name", "U10"), ("height", "f2"), ("age", "i4")]
values = [
    ("Arthur", 1.8, 41), 
    ("Lancelot", 1.9, 38), 
    ("Galahad", 1.7, 38)
]
b = np.array(values, dtype=dtype)
np.sort(b, order=["height"])
```




    array([('Galahad', 1.7, 38), ('Arthur', 1.8, 41), ('Lancelot', 1.9, 38)],
          dtype=[('name', '<U10'), ('height', '<f2'), ('age', '<i4')])



`lexsort`ï¼Œåé¢çš„keyä¼˜å…ˆã€‚


```python
surnames =    ('Zertz',    'Halilei', 'Halilei')
first_names = ('Heinrich', 'Gzlileo', 'Gustav')
# å…ˆsurnameï¼Œåœ¨æŒ‰firstname
ind = np.lexsort((first_names, surnames))
ind
```




    array([2, 1, 0])




```python
[surnames[i] + ", " + first_names[i] for i in ind]
```




    ['Halilei, Gustav', 'Halilei, Gzlileo', 'Zertz, Heinrich']



`ndarray.sort`æ˜¯in-placeæ’åºã€‚å…¶ä½™å‚æ•°ä¸`np.sort`ä¸€æ ·ã€‚


```python
rng = np.random.default_rng(42)
a = rng.integers(0, 10, (3, 4))
a
```




    array([[0, 7, 6, 4],
           [4, 8, 0, 6],
           [2, 0, 5, 9]])




```python
a.sort()
```


```python
a
```




    array([[0, 4, 6, 7],
           [0, 4, 6, 8],
           [0, 2, 5, 9]])



`msort`ä¸`np.sort(a, axis=0)`ç­‰ä»·ã€‚


```python
rng = np.random.default_rng(42)
a = rng.integers(0, 10, (3, 4))
a
```




    array([[0, 7, 6, 4],
           [4, 8, 0, 6],
           [2, 0, 5, 9]])




```python
np.msort(a)
```




    array([[0, 0, 0, 4],
           [2, 7, 5, 6],
           [4, 8, 6, 9]])



`sort_complex`å…ˆç”¨å®éƒ¨æ’ï¼Œå†ç”¨è™šéƒ¨ã€‚


```python
np.sort_complex([1 + 2j, 1+1j, 2 - 1j, 3 - 2j, 3 - 3j, 3 + 5j])
```




    array([1.+1.j, 1.+2.j, 2.-1.j, 3.-3.j, 3.-2.j, 3.+5.j])



`partition`å’Œ`argpartition`çš„å…³ç³»å’Œ`sort`ä¸`argsort`ç±»ä¼¼ã€‚å‚æ•°åŒ…æ‹¬ï¼š

- æ•°ç»„
- kthï¼šåˆ‡åˆ†çš„ä½ç½®ï¼Œæ•´æ•°æˆ–æ•´æ•°åºåˆ—
- axisï¼šè½´ï¼Œé»˜è®¤-1
- kindï¼šé€‰æ‹©ç®—æ³•ï¼Œé»˜è®¤`introselect`
- orderï¼šstræˆ–List[str]ï¼Œå’Œå‰é¢ä»‹ç»çš„`sort`ä¸­çš„å‚æ•°ç”¨æ³•ä¸€æ ·ã€‚

æ³¨æ„ï¼Œè¿”å›çš„ç»“æœä¸­ï¼Œç¬¬kä¸ªå…ƒç´ çš„ä½ç½®æ˜¯æ’å¥½åºæ—¶çš„ä½ç½®ï¼ˆä¸æ˜¯åŸå§‹æ•°ç»„ä¸­çš„indexï¼‰ã€‚


```python
a = [100, 99, 87, 101, 88, 78, 98]
# 88 æ’å¥½æ—¶åœ¨index=2çš„æ•°å­—
# æ¯”88å°çš„åœ¨å·¦è¾¹ï¼Œæ¯”88å¤§æˆ–ç›¸ç­‰çš„åœ¨å³è¾¹
np.partition(a, 2)
```




    array([ 78,  87,  88, 101,  99, 100,  98])




```python
np.argpartition(a, 2)
```




    array([5, 2, 4, 3, 1, 0, 6])




```python
a = [3, 4, 2, 1]
# 4 æ˜¯æ’å¥½åºæ—¶index=3çš„æ•°å­—
np.partition(a, 3)
```




    array([2, 1, 3, 4])




```python
np.argpartition(a, 3)
```




    array([2, 3, 0, 1])




```python
rng = np.random.default_rng(42)
a = rng.integers(0, 10, (3, 8))
a
```




    array([[0, 7, 6, 4, 4, 8, 0, 6],
           [2, 0, 5, 9, 7, 7, 7, 7],
           [5, 1, 8, 4, 5, 3, 1, 9]])




```python
# æ³¨æ„ç¬¬ä¸€è¡Œï¼Œæ¯”4å¤§æˆ–ç›¸ç­‰çš„åœ¨å³è¾¹ 
np.partition(a, 2)
```




    array([[0, 0, 4, 6, 4, 8, 7, 6],
           [0, 2, 5, 9, 7, 7, 7, 7],
           [1, 1, 3, 4, 5, 8, 5, 9]])




```python
np.argpartition(a, 2)
```




    array([[0, 6, 3, 2, 4, 5, 1, 7],
           [1, 0, 2, 3, 4, 5, 6, 7],
           [1, 6, 5, 3, 4, 2, 0, 7]])



## é›†åˆæ“ä½œ

### åŒ…å«

ç¬¬ä¸€ä¸ªæ•°ç»„çš„å…ƒç´ æ˜¯å¦åœ¨ç¬¬äºŒä¸ªæ•°ç»„ï¼š


```python
a = np.array([[1, 2], [2, 3]])
np.unique(a)
```




    array([1, 2, 3])




```python
np.in1d([1,2,3,4], a)
```




    array([ True,  True,  True, False])




```python
# ç¿»è½¬
np.in1d([1,2,3,4], a, invert=True)
```




    array([False, False, False,  True])




```python
# ä¸¤ä¸ªæ•°ç»„é‡Œçš„å€¼å‡unique
# å¯ä»¥åŠ é€Ÿè®¡ç®—
np.in1d([1,2,3,4], a, assume_unique=True)
```




    array([ True,  True,  True, False])




```python
# æ‰“å¹³
np.in1d([[1,2],[3,4]], a)
```




    array([ True,  True,  True, False])




```python
# ä¸æ‰“å¹³
np.isin([1,2,3,4], a)
```




    array([ True,  True,  True, False])




```python
np.isin([[1,2],[3,4]], a)
```




    array([[ True,  True],
           [ True, False]])



å…¶ä½™å‚æ•°å’Œ`in1d`ä¸€æ ·ã€‚

### äº¤é›†

äº¤é›†ï¼Œè¾“å…¥çš„æ•°ç»„ä¼šæ‰“å¹³ï¼š


```python
a
```




    array([[1, 2],
           [2, 3]])




```python
b = np.array([[2, 4, 1]])
```


```python
np.intersect1d(a, b)
```




    array([1, 2])




```python
# å¦‚æœå‡è®¾ä¸ºuniqueï¼Œå…¶å®ä¸æ˜¯ï¼Œç»“æœä¼šæœ‰è¯¯
np.intersect1d(a, b, assume_unique=True)
```




    array([1, 2, 2])




```python
# è¿”å›ç´¢å¼•ï¼Œå¦‚æœæœ‰å¤šä¸ªï¼Œè¿”å›ç¬¬ä¸€ä¸ª
np.intersect1d(a, b, return_indices=True)
```




    (array([1, 2]), array([0, 1]), array([2, 0]))



### å¹¶é›†

å¹¶é›†ï¼Œè¾“å…¥çš„æ•°ç»„ä¼šæ‰“å¹³ï¼š


```python
a
```




    array([[1, 2],
           [2, 3]])




```python
b
```




    array([[2, 4, 1]])




```python
np.union1d(a, b)
```




    array([1, 2, 3, 4])



### å·®é›†

å·®é›†ï¼Œè¿”å›åœ¨æ•°ç»„1ä¸åœ¨æ•°ç»„2çš„ï¼š


```python
np.setdiff1d(a, b)
```




    array([3])




```python
np.setdiff1d(b, a)
```




    array([4])



### å¼‚æˆ–é›†

å¼‚æˆ–é›†ï¼š


```python
np.setxor1d(a, b)
```




    array([3, 4])



å¯¹äºå¤šä¸ªæ•°ç»„ï¼Œå¯ä»¥ä½¿ç”¨`reduce`æ–¹æ³•ï¼š


```python
from functools import reduce
```


```python
reduce(
    np.union1d, 
    ([1, 3, 4, 3], [3, 1, 2, 1], [6, 3, 4, 2])
)
```




    array([1, 2, 3, 4, 6])



## å‡½æ•°å¼ç¼–ç¨‹

NumPyçš„å‘é‡åŒ–è®¡ç®—ä¹Ÿå¯ä»¥è¢«è‡ªå®šä¹‰ä½¿ç”¨ã€‚ä¸‹é¢æˆ‘ä»¬å°±çœ‹çœ‹å¦‚ä½•åœ¨NumPyä¸Šä½¿ç”¨è‡ªå®šä¹‰æ–¹æ³•ã€‚

`apply_along_axis`æ˜¯æ²¿ç€æŸä¸ªç»´åº¦åº”ç”¨ä¸€ä¸ªå‡½æ•°ï¼Œç­‰äºæ˜¯æ²¿ç€æŸä¸ªç»´åº¦å¯¹åŸæ•°ç»„å€¼è¿›è¡Œæ˜ å°„ã€‚


```python
def func(a):
    return (a[0] + a[-1]) / 2
```


```python
b = np.arange(1, 10).reshape(3, 3)
b
```




    array([[1, 2, 3],
           [4, 5, 6],
           [7, 8, 9]])




```python
np.apply_along_axis(func, 0, b)
```




    array([4., 5., 6.])




```python
np.apply_along_axis(func, 1, b)
```




    array([2., 5., 8.])




```python
b = np.array([[8,1,7], [4,3,9], [5,2,6]])
b
```




    array([[8, 1, 7],
           [4, 3, 9],
           [5, 2, 6]])




```python
np.apply_along_axis(sorted, 1, b)
```




    array([[1, 7, 8],
           [3, 4, 9],
           [2, 5, 6]])




```python
np.apply_along_axis(sorted, 0, b)
```




    array([[4, 1, 6],
           [5, 2, 7],
           [8, 3, 9]])




```python
np.apply_along_axis(np.diag, 1, b)
```




    array([[[8, 0, 0],
            [0, 1, 0],
            [0, 0, 7]],
    
           [[4, 0, 0],
            [0, 3, 0],
            [0, 0, 9]],
    
           [[5, 0, 0],
            [0, 2, 0],
            [0, 0, 6]]])




```python
np.apply_along_axis(np.diag, 0, b).T
```




    array([[[8, 0, 0],
            [0, 4, 0],
            [0, 0, 5]],
    
           [[1, 0, 0],
            [0, 3, 0],
            [0, 0, 2]],
    
           [[7, 0, 0],
            [0, 9, 0],
            [0, 0, 6]]])



`apply_over_axes`ä¼šå°†ä¸€ä¸ªå‡½æ•°é‡å¤å¤šæ¬¡åº”ç”¨åˆ°å¤šä¸ªè½´ã€‚

æ³¨æ„ï¼šå‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°ï¼ˆå’Œ`apply_along_axis`çš„ä¸€ä¸ªå‚æ•°åŒºåˆ«ï¼‰ï¼Œåˆ†åˆ«æ˜¯æ•°ç»„å’Œç»´åº¦ã€‚


```python
b
```




    array([[8, 1, 7],
           [4, 3, 9],
           [5, 2, 6]])




```python
np.apply_over_axes(np.sum, b, 1)
```




    array([[16],
           [16],
           [13]])




```python
np.apply_over_axes(np.sum, b, 0)
```




    array([[17,  6, 22]])




```python
np.apply_over_axes(np.sum, b, [0, 1])
```




    array([[45]])



`vectorize`æ˜¯é€šç”¨ç±»ï¼Œå°†è‡ªå®šä¹‰å‡½æ•°å‘é‡åŒ–ï¼Œä¸»è¦æ˜¯æ–¹ä¾¿ï¼Œè€Œä¸æ˜¯ä¸ºäº†æé«˜æ€§èƒ½ï¼Œå†…éƒ¨å®é™…æ˜¯ä¸€ä¸ªforå¾ªç¯ã€‚


```python
def func(a, b):
    if a > b:
        return a - b
    else:
        return a + b
```


```python
vfunc = np.vectorize(func)
```


```python
vfunc(np.arange(10), 3)
```




    array([3, 4, 5, 6, 1, 2, 3, 4, 5, 6])



å¯ä»¥æŒ‡å®šè¾“å‡ºçš„ç±»å‹ï¼š


```python
vfunc = np.vectorize(func, otypes=[np.float16])
```


```python
vfunc(np.arange(10), 3)
```




    array([3., 4., 5., 6., 1., 2., 3., 4., 5., 6.], dtype=float16)



æˆ–è€…æŒ‡å®šä¸è¿›è¡Œå‘é‡åŒ–çš„å‚æ•°ï¼š


```python
def func(a, b):
    res = np.zeros_like(b)
    for i in a:
        res += i * b
    return res
```


```python
func([1,2,3], np.array([2,4]))
```




    array([12, 24])




```python
vfunc = np.vectorize(func, excluded=["a"])
```


```python
vfunc(a=[1,2,3], b=[2,4])
```




    array([12, 24])



æˆ–äº‹åæŒ‡å®šï¼š


```python
vfunc = np.vectorize(func)
# ç¬¬ä¸€ä¸ªå‚æ•°æ’é™¤
vfunc.excluded.add(0)
```


```python
vfunc([1,2,3], [2,4])
```




    array([12, 24])



å¦‚æœè¾“å…¥çš„å‚æ•°ä¸èƒ½ç›´æ¥æ‰§è¡Œï¼Œåˆ™éœ€è¦ç­¾åï¼š


```python
conv = np.vectorize(np.convolve, signature="(n),(m)->(k)")
```


```python
conv([[1,2,3],[4,5,6],[7,8,9]], [1, 0.5])
```




    array([[ 1. ,  2.5,  4. ,  1.5],
           [ 4. ,  7. ,  8.5,  3. ],
           [ 7. , 11.5, 13. ,  4.5]])




```python
np.convolve([1,2,3,4,5,6,7,8,9], [1, 0.5])
```




    array([ 1. ,  2.5,  4. ,  5.5,  7. ,  8.5, 10. , 11.5, 13. ,  4.5])



ç›¸æ¯”`vectorize`ï¼Œ`frompyfunc`æ›´åŠ é€šç”¨ï¼Œå®ƒå¯ä»¥å°†ä»»æ„çš„Pythonå‡½æ•°è½¬ä¸ºé€šå‡½æ•°ã€‚


```python
def func(x):
    return str(x)
```


```python
ufunc = np.frompyfunc(func, 1, 1)
```


```python
ufunc(np.arange(5))
```




    array(['0', '1', '2', '3', '4'], dtype=object)



`piecewise`ä¼šæ‰§è¡Œä¸€ç»„æ¡ä»¶å’Œå¯¹åº”çš„å‡½æ•°ï¼Œå½“æ¡ä»¶ä¸ºçœŸæ—¶æ‰§è¡Œè¯¥å‡½æ•°ã€‚


```python
a = np.arange(10)
```


```python
np.piecewise(a, [a<5, a==5, a>5], [-1, 0, 1])
```




    array([-1, -1, -1, -1, -1,  0,  1,  1,  1,  1])




```python
def func(a, b):
    return a + b
```


```python
# æ³¨æ„åé¢çš„å‚æ•°æ˜¯æ‰€æœ‰å‡½æ•°é€šç”¨çš„
np.piecewise(a, [a<5, a==5, a>5], [func, 0, lambda x, b: x**2], b=5)
```




    array([ 5,  6,  7,  8,  9,  0, 36, 49, 64, 81])



## æµ‹è¯•

ä¸»è¦ä»‹ç»ä¸Assertsç›¸å…³çš„APIï¼Œä¸ç¬¬ä¸‰èŠ‚ä¸­çš„ã€Šé€»è¾‘è¿ç®—ã€‹æœ‰ä¸€å®šè”ç³»ã€‚

### ç›¸ç­‰

ç›¸ç­‰çš„Assertsï¼š

- `assert_equal`
- `assert_array_equal`
- `assert_string_equal`

ä¸‰è€…APIæœ‰ç‚¹ç±»ä¼¼ï¼Œå‰ä¸¤ä¸ªé™¤äº†å®é™…å€¼å’ŒæœŸæœ›å€¼ï¼Œè¿˜å¤šäº†ï¼š

- `err_msg`ï¼šå¤±è´¥æ—¶æ‰“å°çš„æ¶ˆæ¯
- `verbose`ï¼šä¸ºTrueæ—¶ï¼Œå†²çªçš„å€¼ä¼šappendåˆ°æ¶ˆæ¯åé¢

`assert_equal`æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡ï¼ˆæ ‡é‡ï¼Œæ•°ç»„ï¼Œå…ƒç»„ï¼Œå­—å…¸ï¼ŒNumPyæ•°ç»„ç­‰ï¼‰ã€‚å¦‚æœå…¶ä¸­ä¸€ä¸ªæ˜¯æ ‡é‡ï¼Œå¦ä¸€ä¸ªæ˜¯æ•°ç»„ï¼Œåˆ™ä¼šæ¯”è¾ƒæ ‡é‡ä¸æ•°ç»„çš„æ¯ä¸€ä¸ªå…ƒç´ ã€‚å¦‚æœåŒæ ·ä½ç½®éƒ½æ˜¯éæ•°å€¼ï¼ˆNaNï¼‰ï¼Œä¹Ÿç®—ç›¸ç­‰ã€‚


```python
np.testing.assert_equal([1,2], [1,4], "msg: not equal")
```


    ---------------------------------------------------------------------------

    AssertionError                            Traceback (most recent call last)

    <ipython-input-750-bfa692ba2952> in <module>
    ----> 1 np.testing.assert_equal([1,2], [1,4], "msg: not equal")
    

        [... skipping hidden 1 frame]
    

    /usr/local/lib/python3.8/site-packages/numpy/testing/_private/utils.py in assert_equal(actual, desired, err_msg, verbose)
        423         # Explicitly use __eq__ for comparison, gh-2552
        424         if not (desired == actual):
    --> 425             raise AssertionError(msg)
        426 
        427     except (DeprecationWarning, FutureWarning) as e:
    

    AssertionError: 
    Items are not equal:
    item=1
    msg: not equal
     ACTUAL: 2
     DESIRED: 4



```python
# æ ‡é‡ä¸NumPy array_like æ•°ç»„
np.testing.assert_equal(3, np.array([3, 3, 3]))
```


```python
# å«æœ‰éæ•°å€¼ï¼ˆNaNï¼‰çš„æƒ…å†µ
np.testing.assert_equal([1, np.nan], [1, np.nan])
```

`assert_array_equal`çš„èŒƒå›´æ¯”`assert_equal`å°ï¼Œåè€…å†…éƒ¨è°ƒç”¨äº†å‰è€…ã€‚å¦‚æœè¾“å…¥æ˜¯array_likeï¼Œåˆ™ä¸¤è€…æ— åŒºåˆ«ã€‚åè€…åœ¨å¤æ•°ã€æ—¶é—´ã€éæ•°å€¼ï¼ˆNaNï¼‰ç­‰æ–¹é¢æœ‰æ‰€ä¸åŒã€‚


```python
np.testing.assert_array_equal(np.nan, [np.nan])
```


```python
np.testing.assert_equal(np.nan, [np.nan])
```


    ---------------------------------------------------------------------------

    AssertionError                            Traceback (most recent call last)

    <ipython-input-9-ff23e2edb3c8> in <module>
    ----> 1 np.testing.assert_equal(np.nan, [np.nan])
    

    /usr/local/lib/python3.8/site-packages/numpy/testing/_private/utils.py in assert_equal(actual, desired, err_msg, verbose)
        375     # isscalar test to check cases such as [np.nan] != np.nan
        376     if isscalar(desired) != isscalar(actual):
    --> 377         raise AssertionError(msg)
        378 
        379     try:
    

    AssertionError: 
    Items are not equal:
     ACTUAL: nan
     DESIRED: [nan]


`assert_string_equal`ç”¨ä»¥æ¯”è¾ƒå­—ç¬¦ä¸²ï¼Œè¾“å…¥ä¸¤ä¸ªå­—ç¬¦ä¸²å³å¯ã€‚


```python
np.testing.assert_string_equal("abc", "abc")
```


```python
np.testing.assert_string_equal("abc", "abC")
```


    ---------------------------------------------------------------------------

    AssertionError                            Traceback (most recent call last)

    <ipython-input-20-c25a53711d83> in <module>
    ----> 1 np.testing.assert_string_equal("abc", "abC")
    

    /usr/local/lib/python3.8/site-packages/numpy/testing/_private/utils.py in assert_string_equal(actual, desired)
       1204     msg = f"Differences in strings:\n{''.join(diff_list).rstrip()}"
       1205     if actual != desired:
    -> 1206         raise AssertionError(msg)
       1207 
       1208 
    

    AssertionError: Differences in strings:
    - abc+ abC


### ç›¸è¿‘

ç›¸è¿‘çš„Assertsï¼š

- `assert_allclose`ï¼šä½¿ç”¨æœ€å¤š
- `assert_array_almost_equal_nulp`
- `assert_array_max_ulp`

`assert_allclose`åŒ…å«ä»¥ä¸‹å‚æ•°ï¼š

- å®é™…å€¼
- æœŸæœ›å€¼
- rtol=1e-07
- atol=0
- equal_nan=True
- err_msg=""
- verbose=True

åä¸¤ä¸ªå‚æ•°å’Œå‰é¢ä¸€æ ·ï¼Œä¸å†èµ˜è¿°ã€‚`equal_nan`ä¸ºTrueè¡¨ç¤ºéæ•°å€¼ï¼ˆNaNï¼‰ä¼šè®¤ä¸ºæ˜¯ä¸€æ ·çš„ã€‚rtolå’Œatolç”¨äºè¯„ä¼°ç²¾åº¦ï¼Œå¦‚æœä¸¤è€…ç›¸å·®å°äºï¼š`atol + rtol*|desired|`å°±è®¤ä¸ºè¶³å¤Ÿæ¥è¿‘ã€‚


```python
np.testing.assert_allclose(1+1e-7, 1+1e-8)
```


```python
1e-7-1e-8 < (1+1e-8)*1e-7
```




    True




```python
np.testing.assert_allclose(5, 4, atol=1)
```


```python
np.testing.assert_allclose([5, np.nan], [4, np.nan], 
                           atol=1, equal_nan=True)
```

`assert_array_almost_equal_nulp`å¯ç”¨äºæ¯”è¾ƒä¸¤ä¸ªå¹…åº¦å¯å˜é˜Ÿåˆ—ç›¸å¯¹ç¨³å¥ã€‚

- x
- y
- nulp=1ï¼Œæœ€åä¸€ä½å…¬å·®çš„æœ€å¤§å•ä½æ•°ï¼Œæ»¡è¶³ä¸‹å¼æ—¶ï¼š

`|x-y| <= nulps * spacing(max(|x|, |y|))`

ç®—å‡ ä¹ç›¸ç­‰ã€‚


```python
np.spacing(np.float64(1)) == np.finfo(np.float64).eps
```




    True




```python
x = np.array([1, 0.1, 1e-10, 1e-20])
x.dtype
```




    dtype('float64')




```python
eps = np.finfo(x.dtype).eps
eps
```




    2.220446049250313e-16




```python
x * eps <= 1 * np.spacing(x + x*eps)
```




    array([ True, False, False, False])




```python
np.testing.assert_array_almost_equal_nulp(
    x, x + x*eps, nulp=1
)
```


    ---------------------------------------------------------------------------

    AssertionError                            Traceback (most recent call last)

    <ipython-input-91-4807c4e32d47> in <module>
    ----> 1 np.testing.assert_array_almost_equal_nulp(
          2     x, x + x*eps, nulp=1
          3 )
    

    /usr/local/lib/python3.8/site-packages/numpy/testing/_private/utils.py in assert_array_almost_equal_nulp(x, y, nulp)
       1592             max_nulp = np.max(nulp_diff(x, y))
       1593             msg = "X and Y are not equal to %d ULP (max is %g)" % (nulp, max_nulp)
    -> 1594         raise AssertionError(msg)
       1595 
       1596 
    

    AssertionError: X and Y are not equal to 1 ULP (max is 2)



```python
np.testing.assert_array_almost_equal_nulp(
    .1, .1+eps, nulp=1
)
```


    ---------------------------------------------------------------------------

    AssertionError                            Traceback (most recent call last)

    <ipython-input-93-7d1275786d24> in <module>
    ----> 1 np.testing.assert_array_almost_equal_nulp(
          2     .1, .1+eps, nulp=1
          3 )
    

    /usr/local/lib/python3.8/site-packages/numpy/testing/_private/utils.py in assert_array_almost_equal_nulp(x, y, nulp)
       1592             max_nulp = np.max(nulp_diff(x, y))
       1593             msg = "X and Y are not equal to %d ULP (max is %g)" % (nulp, max_nulp)
    -> 1594         raise AssertionError(msg)
       1595 
       1596 
    

    AssertionError: X and Y are not equal to 1 ULP (max is 16)



```python
np.testing.assert_array_almost_equal_nulp(
    1, 1+eps, nulp=1
)
```


```python
np.testing.assert_array_almost_equal_nulp(
    4, 8, nulp=1e16
)
```


```python
1e16 * np.spacing(8)
```




    17.763568394002505



`assert_array_max_ulp`ç”¨äºæ£€æŸ¥æ•°ç»„ä¸­æ‰€æœ‰å…ƒç´ æœ€å¤šç›¸å·®Nä¸ªå•ä½ã€‚


```python
np.testing.assert_array_max_ulp(1, 1)
```




    array([0.])




```python
a = np.linspace(0., 1., 10)
np.testing.assert_array_max_ulp(a, np.arcsin(np.sin(a)))
```




    array([[0., 0., 0., 0., 0., 0., 0., 0., 1., 0.]])




```python
np.testing.assert_array_max_ulp(1, 2, maxulp=1e16)
```




    array([4.50359963e+15])




```python
# NaNä¸åŒºåˆ†
np.testing.assert_array_max_ulp(np.nan, np.nan)
```




    array([0.])



### å°äº

å°äºï¼š

- `assert_array_less`ï¼šå‚æ•°ä¸`assert_array_equal`ä¸€æ ·ï¼Œç”¨æ¥æ¯”è¾ƒæ˜¯å¦å°äºï¼ŒNaNä¹Ÿä¼šæ¯”è¾ƒï¼Œå¦‚æœåŒæ ·ä½ç½®éƒ½æ˜¯NaNï¼Œåˆ™è·³è¿‡ï¼ˆä¸æŠ›å‡ºå¼‚å¸¸ï¼‰ã€‚


```python
np.testing.assert_array_less(
    [1, 1, np.nan],
    [2, 2, np.nan]
)
```


```python
np.testing.assert_array_less(
    3, [1, 4]
)
```


    ---------------------------------------------------------------------------

    AssertionError                            Traceback (most recent call last)

    <ipython-input-148-4b4915dff584> in <module>
    ----> 1 np.testing.assert_array_less(
          2     3, [1, 4]
          3 )
    

        [... skipping hidden 1 frame]
    

    /usr/local/lib/python3.8/site-packages/numpy/testing/_private/utils.py in assert_array_compare(comparison, x, y, err_msg, verbose, header, precision, equal_nan, equal_inf)
        842                                 verbose=verbose, header=header,
        843                                 names=('x', 'y'), precision=precision)
    --> 844             raise AssertionError(msg)
        845     except ValueError:
        846         import traceback
    

    AssertionError: 
    Arrays are not less-ordered
    
    Mismatched elements: 1 / 2 (50%)
    Max absolute difference: 2
    Max relative difference: 2.
     x: array(3)
     y: array([1, 4])


### å¼‚å¸¸

å¼‚å¸¸ï¼š

- `assert_raises`
- `assert_raises_regex`
- `assert_warns`

è¿™ä¸‰ä¸ªAPIéƒ½å¯ä»¥ä½œä¸ºä¸Šä¸‹æ–‡ç®¡ç†å™¨ä½¿ç”¨ã€‚

`assert_raises`æœ‰ä¸¤ç§ä½¿ç”¨æ–¹æ³•ï¼š

- `assert_raises(exception_class, callable, *args, **kwargs)`
- `assert_raises(exception_class)`


```python
1/0
```


    ---------------------------------------------------------------------------

    ZeroDivisionError                         Traceback (most recent call last)

    <ipython-input-158-9e1622b385b6> in <module>
    ----> 1 1/0
    

    ZeroDivisionError: division by zero



```python
with np.testing.assert_raises(ZeroDivisionError):
    1/0
```


```python
def div(a,b):a/b
np.testing.assert_raises(ZeroDivisionError, div, 1, 0)
```


```python
with np.testing.assert_raises(ZeroDivisionError):
    1/1
```


    ---------------------------------------------------------------------------

    AssertionError                            Traceback (most recent call last)

    <ipython-input-164-3bd112b16131> in <module>
          1 with np.testing.assert_raises(ZeroDivisionError):
    ----> 2     1/1
    

    /usr/local/Cellar/python@3.8/3.8.10/Frameworks/Python.framework/Versions/3.8/lib/python3.8/unittest/case.py in __exit__(self, exc_type, exc_value, tb)
        225                                                                 self.obj_name))
        226             else:
    --> 227                 self._raiseFailure("{} not raised".format(exc_name))
        228         else:
        229             traceback.clear_frames(tb)
    

    /usr/local/Cellar/python@3.8/3.8.10/Frameworks/Python.framework/Versions/3.8/lib/python3.8/unittest/case.py in _raiseFailure(self, standardMsg)
        162     def _raiseFailure(self, standardMsg):
        163         msg = self.test_case._formatMessage(self.msg, standardMsg)
    --> 164         raise self.test_case.failureException(msg)
        165 
        166 class _AssertRaisesBaseContext(_BaseTestCaseContext):
    

    AssertionError: ZeroDivisionError not raised


`assert_raises_regex`ç›¸æ¯”å‰è€…å¯ä»¥æŒ‡å®šæ­£åˆ™ã€‚


```python
with np.testing.assert_raises_regex(
    ZeroDivisionError, "division by zero"
):
    1/0
```


```python
with np.testing.assert_raises_regex(
    ZeroDivisionError, "[a-z]+"
):
    1/0
```

`assert_warns`å’Œ`assert_raises`ä¸€æ ·çš„ä½¿ç”¨æ–¹å¼ï¼Œåªä¸è¿‡ä¼šè­¦å‘Šè€Œä¸æ˜¯æŠ›å‡ºå¼‚å¸¸ã€‚


```python
import warnings
```


```python
def func(n):
    warnings.warn("msg", UserWarning)
    return n * n
```


```python
np.testing.assert_warns(UserWarning, func, 2)
```




    4




```python
func(2)
```

    <ipython-input-187-23e97a00966d>:2: UserWarning: msg
      warnings.warn("msg", UserWarning)
    




    4



å…³äºè­¦å‘Šçš„ç±»å‹ï¼Œå¯ä»¥å‚è€ƒæ–‡æ¡£ï¼š

- [warnings â€” Warning control â€” Python 3.10.4 documentation](https://docs.python.org/3/library/warnings.html)

## å°ç»“

## å‚è€ƒ

- [NumPy documentation â€” NumPy v1.23.dev0 Manual](https://numpy.org/devdocs/index.html)


```python

```
